"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[9486],{9486:(ut,v,l)=>{l.r(v),l.d(v,{ProyectoModule:()=>pt});var r=l(1180),N=l(7246),C=l(1380),d=l(805),Z=l(7579),g=l(2722),k=l(4004),u=l(5698),t=l(4650),I=l(2340),J=l(529),y=l(629);let T=(()=>{class n{constructor(e,o,i){(0,r.Z)(this,"http",void 0),(0,r.Z)(this,"authS",void 0),(0,r.Z)(this,"router",void 0),(0,r.Z)(this,"_prefix",I.H+"/api/proyectos"),this.http=e,this.authS=o,this.router=i}getAll(e=[1]){return this.http.post(this._prefix+"/getall",{proy_nsts:e,sucu_nids:this.authS.getSucursalSelected()})}save(e,o=null){const i={...e,...this.authS.getUsuarioLog(),img:o};return this.http.post(this._prefix+"/save",i)}setSts(e){return this.http.post(this._prefix+"/setsts/"+e.proy_nid,{proy_nsts:e.proy_nsts,...this.authS.getUsuarioLog()})}setBulkSts(e){return this.http.post(this._prefix+"/setbullksts",{data:e,...this.authS.getUsuarioLog()})}getSucursales(){const e={cia_nids:this.authS.isValidCia(!1)};return this.http.post("/api/sucursales/getall",e)}getImg(e){return this.http.post(this._prefix+"/getimg",{file:e,proy_nid:e})}}return(0,r.Z)(n,"\u0275fac",function(e){return new(e||n)(t.LFG(J.eN),t.LFG(y.e),t.LFG(C.F0))}),(0,r.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})),n})();var x=l(1168),h=l(6895),p=l(4006),m=l(99),A=l(3388),S=l(5593),F=l(5362),P=l(1795),U=l(2453),M=l(1383),D=l(1740),q=l(1493),f=l(2661),R=l(2210);function B(n,a){1&n&&t._UZ(0,"div")}function E(n,a){1&n&&t._UZ(0,"div")}function O(n,a){if(1&n&&t._UZ(0,"img",23),2&n){const e=t.oxw();t.Q6J("src","data:image/png;base64,"+e.img,t.LSH)}}function H(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.finishDrawing())}),t.qZA()}}function L(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.clearPolygon())}),t.qZA()}}let Q=(()=>{class n{constructor(e,o,i,s){(0,r.Z)(this,"dbapi",void 0),(0,r.Z)(this,"_builder",void 0),(0,r.Z)(this,"authS",void 0),(0,r.Z)(this,"skNsCore",void 0),(0,r.Z)(this,"map",void 0),(0,r.Z)(this,"createForm",void 0),(0,r.Z)(this,"sucursales",[]),(0,r.Z)(this,"guardando",!1),(0,r.Z)(this,"itemDialog",!1),(0,r.Z)(this,"submitted",!1),(0,r.Z)(this,"center",{lat:14.5934,lng:-87.8336}),(0,r.Z)(this,"options",{}),(0,r.Z)(this,"uploadedFiles",[]),(0,r.Z)(this,"img",void 0),(0,r.Z)(this,"geocercaCoordinates",[]),(0,r.Z)(this,"isDrawing",!0),(0,r.Z)(this,"polygon",void 0),(0,r.Z)(this,"polygonOptions",{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0,draggable:!0}),(0,r.Z)(this,"$destroy",new Z.x),(0,r.Z)(this,"proyecto",{}),(0,r.Z)(this,"edit",new t.vpe),this.dbapi=e,this._builder=o,this.authS=i,this.skNsCore=s,this.createForm=o.group({proy_nid:[0],sucu_nid:["",p.kI.required],proy_vgeopath:["",p.kI.required],proy_vnombre:["",p.kI.required],proy_vdescripcion:["",p.kI.required],proy_nsts:[""]}),i.\u00f8bserverCompanySelected.pipe((0,g.R)(this.$destroy)).subscribe(c=>{this.getSucursales()}),this.options={zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1,mapTypeId:"terrain",maxZoom:20,minZoom:4,tilt:45,mapTypeControl:!0}}ngOnChanges(){this.clearPolygon(),this.proyecto&&this.proyecto?.proy_nid&&this.proyecto?.proy_nid>0&&(this.proy_nid?.setValue(this.proyecto?.proy_nid),this.sucu_nid?.setValue(this.searchById(this.proyecto?.sucu_nid,this.sucursales)),this.geocercaCoordinates=JSON.parse(this.proyecto?.proy_vgeopath),this.center=this.geocercaCoordinates[0],this.proy_vgeopath?.setValue(this.proyecto?.proy_vgeopath),this.proy_vnombre?.setValue(this.proyecto?.proy_vnombre),this.proy_vdescripcion?.setValue(this.proyecto?.proy_vdescripcion),this.proy_nsts?.setValue(this.proyecto?.proy_nsts),this.updatePolygon(),this.img=null,this.dbapi.getImg(this.proyecto?.proy_nid).pipe((0,u.q)(1)).subscribe(e=>{e&&(this.img=e)}))}getSucursales(){this.sucursales=[],this.sucu_nid?.setValue(""),this.dbapi.getSucursales().pipe((0,u.q)(1)).subscribe({next:e=>{if(e&&null!=e&&""!==e){for(const o in e)this.sucursales=[...this.sucursales,{id:e[o].sucu_nid,text:e[o].sucu_vnombre,obj:e[o]}];1==this.sucursales.length&&this.sucu_nid?.setValue(this.sucursales[0])}else console.log("Error consultando compa\xf1\xedas")},error:e=>{console.log(e),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:e})}})}onMapClick(e){if(e.latLng&&this.isDrawing){const o=e.latLng.toJSON();this.geocercaCoordinates=[...this.geocercaCoordinates,o],this.updatePolygon()}}onPolygonComplete(e){this.polygon=e,google.maps.event.addListener(e.getPath(),"set_at",()=>this.updatePolygonCoordinates()),google.maps.event.addListener(e.getPath(),"insert_at",()=>this.updatePolygonCoordinates()),google.maps.event.addListener(e.getPath(),"remove_at",()=>this.updatePolygonCoordinates())}updatePolygonCoordinates(){this.polygon&&(this.geocercaCoordinates=this.polygon.getPath().getArray().map(e=>e.toJSON()))}finishDrawing(){this.isDrawing=!1,this.geocercaCoordinates.length>2&&(this.geocercaCoordinates=[...this.geocercaCoordinates,this.geocercaCoordinates[0]]);const e=JSON.stringify(this.geocercaCoordinates);this.proy_vgeopath?.setValue(e)}updatePolygon(){if(this.geocercaCoordinates.length>1)if(this.polygon)this.polygon.setPath(this.geocercaCoordinates.map(e=>new google.maps.LatLng(e.lat,e.lng)));else{const e=this.map?.googleMap;e&&(this.polygon=new google.maps.Polygon({...this.polygonOptions,paths:this.geocercaCoordinates.map(o=>new google.maps.LatLng(o.lat,o.lng))}),this.polygon.setMap(e),this.onPolygonComplete(this.polygon))}}clearPolygon(){this.polygon&&(this.polygon.setMap(null),this.polygon=void 0),this.geocercaCoordinates=[],this.proy_vgeopath?.setValue(""),this.isDrawing=!0}save(){if(this.createForm.valid&&!this.guardando){this.guardando=!0;const e={proy_nid:this.proy_nid?.value>0?this.proy_nid?.value:null,sucu_nid:this.sucu_nid?.value.id,proy_vgeopath:this.proy_vgeopath?.value,proy_vnombre:this.proy_vnombre?.value.trim().toUpperCase(),proy_vdescripcion:this.proy_vdescripcion?.value.trim().toUpperCase(),proy_nsts:1};this.dbapi.save(e,this.img).pipe((0,u.q)(1)).subscribe({next:o=>{"success"==o.type&&(this.skNsCore.notificarUpsert("/proyectos/sucursales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.limpiarForm()),this.guardando=!1,this.edit.emit(o)},error:o=>{console.log(o),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:o})}})}}limpiarForm(){this.createForm.reset(),this.proy_nid?.setValue(0),this.clearPolygon()}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(e,o){for(let i=0;i<o.length;i++){const s=o[i];if(s.id==e)return s}return""}onSelect(e){for(const o of e.files)this.uploadedFiles.push(o),this.convertirArchivoABase64(o).then(s=>{this.img=s}).catch(s=>{console.error("Error al convertir archivo a base64:",s)});console.log("onSelect",this.uploadedFiles)}onRemove(e){this.uploadedFiles=[],this.img=null}convertirArchivoABase64(e){return new Promise((o,i)=>{const s=new FileReader;s.onload=()=>{o(s.result.split(",")[1])},s.onerror=c=>i(c),s.readAsDataURL(e)})}convertirBase64AFile(e,o){const i=atob(e),s=new Array(i.length);for(let _=0;_<i.length;_++)s[_]=i.charCodeAt(_);const c=new Uint8Array(s),ct=new Blob([c],{type:"application/octet-stream"});return new File([ct],o)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get proy_nid(){return this.createForm.get("proy_nid")}get sucu_nid(){return this.createForm.get("sucu_nid")}get proy_vgeopath(){return this.createForm.get("proy_vgeopath")}get proy_vnombre(){return this.createForm.get("proy_vnombre")}get proy_vdescripcion(){return this.createForm.get("proy_vdescripcion")}get proy_nsts(){return this.createForm.get("proy_nsts")}}return(0,r.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(T),t.Y36(p.qu),t.Y36(y.e),t.Y36(x.pP))}),(0,r.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-create-proyecto"]],viewQuery:function(e,o){if(1&e&&t.Gf(f.b6,5),2&e){let i;t.iGM(i=t.CRH())&&(o.map=i.first)}},inputs:{proyecto:"proyecto"},outputs:{edit:"edit"},features:[t.TTD],decls:35,vars:19,consts:[[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["slot","width: 200px;","optionLabel","text","formControlName","sucu_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","proy_vnombre","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","proy_vdescripcion","type","text","required","",2,"text-transform","uppercase"],["accept","image/*","chooseLabel","Seleccionar...",3,"multiple","showUploadButton","maxFileSize","fileLimit","customUpload","onSelect","onRemove","onClear"],["fileUpload",""],["pTemplate","file","style","display: none;"],["pTemplate","content","style","display: none;"],["style","max-width: 300px; margin-left: auto; margin-right: auto; margin-top: 5px;",3,"src",4,"ngIf"],[1,"col-12"],[1,"map-container",2,"height","300px"],[1,"map-wrapper",2,"height","100%"],["height","100%","width","100%",3,"zoom","center","options","mapClick"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","label","Finalizar Geocerca","icon","pi pi-pencil","class","p-button-warning mr-1 btn-sm","type","button",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times","class","p-button-info mr-1 btn-sm","type","button",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"],[2,"max-width","300px","margin-left","auto","margin-right","auto","margin-top","5px",3,"src"],["pButton","","pRipple","","label","Finalizar Geocerca","icon","pi pi-pencil","type","button",1,"p-button-warning","mr-1","btn-sm",3,"click"],["pButton","","pRipple","","icon","pi pi-times","type","button",1,"p-button-info","mr-1","btn-sm",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return o.save()}),t.TgZ(2,"div",2)(3,"label",3),t._uU(4,"Sucursal"),t.qZA(),t.TgZ(5,"div",4),t._UZ(6,"p-dropdown",5),t.qZA()(),t.TgZ(7,"div",2)(8,"label",3),t._uU(9,"Nombre"),t.qZA(),t.TgZ(10,"div",4),t._UZ(11,"input",6),t.qZA()(),t.TgZ(12,"div",2)(13,"label",3),t._uU(14,"Descripcion"),t.qZA(),t.TgZ(15,"div",4),t._UZ(16,"input",7),t.qZA()(),t.TgZ(17,"p-fileUpload",8,9),t.NdJ("onSelect",function(s){return o.onSelect(s)})("onRemove",function(s){return o.onRemove(s)})("onClear",function(s){return o.onRemove(s)}),t.YNc(19,B,1,0,"ng-template",10),t.YNc(20,E,1,0,"ng-template",11),t.qZA(),t.YNc(21,O,1,1,"img",12),t._UZ(22,"hr"),t.TgZ(23,"div",13)(24,"div",14)(25,"div",15)(26,"google-map",16),t.NdJ("mapClick",function(s){return o.onMapClick(s)}),t.qZA()()()(),t._UZ(27,"hr"),t.TgZ(28,"div",2)(29,"div",17)(30,"span",18),t.YNc(31,H,1,0,"button",19),t.YNc(32,L,1,0,"button",20),t._UZ(33,"button",21),t.TgZ(34,"button",22),t.NdJ("click",function(){return o.limpiarForm()}),t.qZA()()()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.createForm),t.xp6(5),t.Q6J("options",o.sucursales)("filter",!0)("virtualScroll",o.sucursales.length>5)("virtualScrollItemSize",38),t.xp6(11),t.Q6J("multiple",!0)("showUploadButton",!1)("maxFileSize",1e6)("fileLimit",1)("customUpload",!0),t.xp6(4),t.Q6J("ngIf",o.img&&""!==o.img),t.xp6(5),t.Q6J("zoom",15)("center",o.center)("options",o.options),t.xp6(5),t.Q6J("ngIf",o.geocercaCoordinates.length>0),t.xp6(1),t.Q6J("ngIf",o.geocercaCoordinates.length>0),t.xp6(1),t.Q6J("disabled",!o.createForm.valid)("loading",o.guardando)("label",o.proyecto&&o.proyecto.sucu_nid?"Editar":"Guardar"))},dependencies:[h.O5,p._Y,p.Fj,p.JJ,p.JL,p.Q7,p.sg,p.u,d.jx,A.p,S.Hq,P.H,D.o,R.Lt,f.b6],styles:[".map-containerGrand[_ngcontent-%COMP%]{flex:1;width:800px;padding:15px;display:flex}.map-wrapper[_ngcontent-%COMP%]{flex:1;height:500px}.ng-valid[_ngcontent-%COMP%]{border-color:#2ecc71!important}"]})),n})();function G(n,a){1&n&&(t.TgZ(0,"div",22)(1,"h3",23),t._uU(2,"Listado de residenciales"),t.qZA()())}function Y(n,a){if(1&n){const e=t.EpF();t._UZ(0,"p-fileUpload",24),t.TgZ(1,"button",25),t.NdJ("click",function(){t.CHM(e),t.oxw();const i=t.MAs(8);return t.KtG(i.exportCSV())}),t.qZA()}2&n&&t.Q6J("maxFileSize",1e6)}const V=function(){return{float:"right"}};function z(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",26)(1,"span",27)(2,"input",28),t.NdJ("input",function(i){t.CHM(e);const s=t.oxw(),c=t.MAs(8);return t.KtG(s.onGlobalFilter(c,i))}),t.qZA(),t.TgZ(3,"button",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.getData())}),t.qZA(),t.TgZ(4,"button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openNew())}),t.qZA(),t.TgZ(5,"p-selectButton",31),t.NdJ("ngModelChange",function(i){t.CHM(e);const s=t.oxw();return t.KtG(s.dataValue=i)})("click",function(){t.CHM(e);const i=t.oxw();return i.getData(),t.KtG(i.clearDataSelected())}),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(5),t.Q6J("options",e.dataOptions)("ngModel",e.dataValue)("ngStyle",t.DdM(3,V))}}function K(n,a){if(1&n&&(t.TgZ(0,"th",34),t._uU(1),t._UZ(2,"p-sortIcon",35),t.qZA()),2&n){const e=a.$implicit;t.ekj("rowStyle","ID"!==e.header)("rowStyleId","ID"===e.header),t.Q6J("pSortableColumn",e.field),t.xp6(1),t.hij(" ",e.header," "),t.xp6(1),t.Q6J("field",e.field)}}function $(n,a){if(1&n&&(t.TgZ(0,"tr")(1,"th",32),t._UZ(2,"p-tableHeaderCheckbox"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Acciones"),t.qZA(),t.YNc(5,K,3,7,"th",33),t.qZA()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.cols)}}function j(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",42),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw();return t.KtG(s.editRow(i))}),t.qZA()}}function X(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw();return t.KtG(s.deleteRow(i))}),t.qZA()}}function W(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",44),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw();return t.KtG(s.restartRow(i))}),t.qZA()}}function tt(n,a){if(1&n&&(t.TgZ(0,"td")(1,"span",45),t._uU(2),t.qZA(),t._uU(3),t.qZA()),2&n){const e=a.$implicit,o=t.oxw().$implicit;t.xp6(2),t.Oqu(e.header),t.xp6(1),t.hij(" ",o[e.field]," ")}}function et(n,a){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-tableCheckbox",36),t.qZA(),t.TgZ(3,"td")(4,"div",37),t.YNc(5,j,1,0,"button",38),t.YNc(6,X,1,0,"button",39),t.YNc(7,W,1,0,"button",40),t.qZA()(),t.YNc(8,tt,4,2,"td",41),t.qZA()),2&n){const e=a.$implicit,o=t.oxw();t.xp6(2),t.Q6J("value",e),t.xp6(3),t.Q6J("ngIf",e.proy_nsts>0),t.xp6(1),t.Q6J("ngIf",e.proy_nsts>0),t.xp6(1),t.Q6J("ngIf",e.proy_nsts<1),t.xp6(1),t.Q6J("ngForOf",o.cols)}}function ot(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1,"Estas seguro que quieres eliminar "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4,"?"),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.item.proy_vnombre)}}function it(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteItemDialog=!1)}),t.qZA(),t.TgZ(1,"button",47),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmDelete())}),t.qZA()}}function nt(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1,"Estas seguro que quieres restaurar "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4,"?"),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.item.proy_vnombre)}}function rt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.restartItemDialog=!1)}),t.qZA(),t.TgZ(1,"button",48),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmRestart())}),t.qZA()}}function st(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteItemsDialog=!1)}),t.qZA(),t.TgZ(1,"button",47),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmDeleteSelected())}),t.qZA()}}const at=function(){return[10,20,30]},w=function(){return{width:"950px"}},b=function(){return{width:"450px"}},lt=[{path:"",component:(()=>{class n{constructor(e,o,i,s){(0,r.Z)(this,"dbapi",void 0),(0,r.Z)(this,"messageService",void 0),(0,r.Z)(this,"authS",void 0),(0,r.Z)(this,"skNsCore",void 0),(0,r.Z)(this,"createDialog",!1),(0,r.Z)(this,"editDialog",!1),(0,r.Z)(this,"deleteItemDialog",!1),(0,r.Z)(this,"deleteItemsDialog",!1),(0,r.Z)(this,"restartItemDialog",!1),(0,r.Z)(this,"restartItemsDialog",!1),(0,r.Z)(this,"isLoadingTable",!1),(0,r.Z)(this,"data",[]),(0,r.Z)(this,"item",{}),(0,r.Z)(this,"sucursalSelected",[]),(0,r.Z)(this,"selectedData",[]),(0,r.Z)(this,"submitted",!1),(0,r.Z)(this,"cols",[]),(0,r.Z)(this,"statuses",[]),(0,r.Z)(this,"dataOptions",[]),(0,r.Z)(this,"dataValue",[1]),(0,r.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,r.Z)(this,"$destroy",new Z.x),this.dbapi=e,this.messageService=o,this.authS=i,this.skNsCore=s,i.\u00f8bserverCompanySelected.pipe((0,g.R)(this.$destroy)).subscribe(c=>{this.getData()}),s.fromEvent("/proyectos/proyecto+"+this.authS.isValidCia(!1).toString()).pipe((0,g.R)(this.$destroy)).subscribe(c=>{this.skNsCore.socketId!=c&&(console.log("Event socket: proyecto"),this.getData())}),i.\u00f8bserverSucursalSelected.pipe((0,g.R)(this.$destroy)).subscribe(()=>{this.getData()}),this.cols=[{field:"proy_nid",header:"ID"},{field:"proy_vnombre",header:"Nombre"},{field:"proy_vdescripcion",header:"Descripcion"},{field:"sucu_vnombre",header:"Sucursal"},{field:"proy_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}]}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,k.U)(e=>(e.forEach(o=>{o.proy_vsts=1==o.proy_nsts?"ACTIVO":"ELIMINADO",o.sucu_vnombre=o._tsucursales?o._tsucursales.sucu_vnombre:""}),e)),(0,u.q)(1)).subscribe({next:e=>{this.data=[...e],this.isLoadingTable=!1},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}editRow(e){this.item={...e},this.editDialog=!0}deleteRow(e){this.deleteItemDialog=!0,this.item={...e}}restartRow(e){this.restartItemDialog=!0,this.item={...e}}confirmDeleteSelected(){const e=[];this.selectedData.forEach(o=>{e.push({proy_nid:o.proy_nid,proy_nsts:0})}),this.dbapi.setBulkSts(e).pipe((0,u.q)(1)).subscribe({next:o=>{this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),"success"==o.type&&(this.skNsCore.notificarUpsert("/proyectos/proyecto",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmDelete(){this.dbapi.setSts({proy_nid:this.item.proy_nid,proy_nsts:0}).pipe((0,u.q)(1)).subscribe({next:o=>{this.skNsCore.notificarUpsert("/proyectos/proyecto",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmRestart(){this.dbapi.setSts({proy_nid:this.item.proy_nid,proy_nsts:1}).pipe((0,u.q)(1)).subscribe({next:o=>{this.skNsCore.notificarUpsert("/proyectos/proyecto",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmRestartSelected(){const e=[];this.selectedData.forEach(o=>{e.push({proy_nid:o.proy_nid,proy_nsts:1})}),this.dbapi.setBulkSts(e).pipe((0,u.q)(1)).subscribe({next:o=>{this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),"success"==o.type&&(this.skNsCore.notificarUpsert("/proyectos/proyecto",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}findIndexById(e){let o=-1;for(let i=0;i<this.data.length;i++)if(this.data[i].proy_nid===e){o=i;break}return o}onGlobalFilter(e,o){e.filterGlobal(o.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}restartSelectedItems(){this.restartItemsDialog=!0}editEvent(e){this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),"success"==e.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}clearDataSelected(){this.selectedData=[]}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,r.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(T),t.Y36(d.ez),t.Y36(y.e),t.Y36(x.pP))}),(0,r.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["ng-component"]],features:[t._Bn([d.ez])],decls:32,vars:40,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","cia_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear residencial",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar residencial",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"proyecto","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1",3,"click"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],[2,"width","3rem"],[3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"p-toast",3),t.TgZ(4,"p-toolbar",4),t.YNc(5,G,3,0,"ng-template",5),t.YNc(6,Y,2,1,"ng-template",6),t.qZA(),t.TgZ(7,"p-table",7,8),t.NdJ("selectionChange",function(s){return o.selectedData=s}),t.YNc(9,z,6,4,"ng-template",9),t.YNc(10,$,6,1,"ng-template",10),t.YNc(11,et,9,5,"ng-template",11),t.qZA()(),t.TgZ(12,"p-dialog",12),t.NdJ("visibleChange",function(s){return o.createDialog=s}),t.TgZ(13,"app-create-proyecto",13),t.NdJ("edit",function(s){return o.editEvent(s)}),t.qZA()(),t.TgZ(14,"p-dialog",14),t.NdJ("visibleChange",function(s){return o.editDialog=s}),t.TgZ(15,"app-create-proyecto",15),t.NdJ("edit",function(s){return o.editEvent(s)}),t.qZA()(),t.TgZ(16,"p-dialog",16),t.NdJ("visibleChange",function(s){return o.deleteItemDialog=s}),t.TgZ(17,"div",17),t._UZ(18,"i",18),t.YNc(19,ot,5,1,"span",19),t.qZA(),t.YNc(20,it,2,0,"ng-template",20),t.qZA(),t.TgZ(21,"p-dialog",16),t.NdJ("visibleChange",function(s){return o.restartItemDialog=s}),t.TgZ(22,"div",17),t._UZ(23,"i",18),t.YNc(24,nt,5,1,"span",19),t.qZA(),t.YNc(25,rt,2,0,"ng-template",20),t.qZA(),t.TgZ(26,"p-dialog",21),t.NdJ("visibleChange",function(s){return o.deleteItemsDialog=s}),t.TgZ(27,"div",17),t._UZ(28,"i",18),t.TgZ(29,"span"),t._uU(30,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),t.qZA()(),t.YNc(31,st,2,0,"ng-template",20),t.qZA()()()),2&e&&(t.xp6(7),t.Q6J("value",o.data)("columns",o.cols)("rows",10)("globalFilterFields",o.cols)("rows",10)("paginator",!0)("loading",o.isLoadingTable)("rowsPerPageOptions",t.DdM(34,at))("showCurrentPageReport",!0)("selection",o.selectedData)("rowHover",!0),t.xp6(5),t.Akn(t.DdM(35,w)),t.Q6J("visible",o.createDialog)("modal",!0),t.xp6(2),t.Akn(t.DdM(36,w)),t.Q6J("visible",o.editDialog)("modal",!0),t.xp6(1),t.Q6J("proyecto",o.item),t.xp6(1),t.Akn(t.DdM(37,b)),t.Q6J("visible",o.deleteItemDialog)("modal",!0),t.xp6(3),t.Q6J("ngIf",o.item),t.xp6(2),t.Akn(t.DdM(38,b)),t.Q6J("visible",o.restartItemDialog)("modal",!0),t.xp6(3),t.Q6J("ngIf",o.item),t.xp6(2),t.Akn(t.DdM(39,b)),t.Q6J("visible",o.deleteItemsDialog)("modal",!0))},dependencies:[h.sg,h.O5,h.PC,p.JJ,p.On,m.iA,d.jx,m.lQ,m.fz,m.UA,m.Mo,A.p,S.Hq,F.UN,P.H,U.FN,M.o,D.o,q.V,Q]})),n})()}];let pt=(()=>{class n{}return(0,r.Z)(n,"\u0275fac",function(e){return new(e||n)}),(0,r.Z)(n,"\u0275mod",t.oAB({type:n})),(0,r.Z)(n,"\u0275inj",t.cJS({imports:[N.m,f.Y4,C.Bz.forChild(lt)]})),n})()}}]);