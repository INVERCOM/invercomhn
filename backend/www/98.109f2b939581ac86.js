"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[98],{98:(ct,b,a)=>{a.r(b),a.d(b,{LotesModule:()=>pt});var l=a(1180),k=a(7246),I=a(1380),g=a(805),C=a(7579),v=a(2722),Z=a(4004),c=a(5698),t=a(4650),y=a(2162),T=a(629),A=a(1168),_=a(6895),p=a(433),m=a(99),L=a(3388),x=a(5593),N=a(5362),S=a(1795),q=a(2453),J=a(1383),w=a(1740),F=a(1493),u=a(2661),U=a(2210);function M(n,r){1&n&&t._UZ(0,"div")}function P(n,r){1&n&&t._UZ(0,"div")}function R(n,r){if(1&n&&t._UZ(0,"img",32),2&n){const e=t.oxw();t.Q6J("src","data:image/png;base64,"+e.img,t.LSH)}}function E(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",33),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.finishDrawing())}),t.qZA()}}function O(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",34),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.clearPolygon())}),t.qZA()}}const B=function(n){return{position:n}};let H=(()=>{class n{constructor(e,o,i,s){(0,l.Z)(this,"dbapi",void 0),(0,l.Z)(this,"_builder",void 0),(0,l.Z)(this,"authS",void 0),(0,l.Z)(this,"skNsCore",void 0),(0,l.Z)(this,"map",void 0),(0,l.Z)(this,"infoWindow",void 0),(0,l.Z)(this,"infoContent",""),(0,l.Z)(this,"dataOriginal",[]),(0,l.Z)(this,"data",[]),(0,l.Z)(this,"createForm",void 0),(0,l.Z)(this,"primeraCons",!1),(0,l.Z)(this,"guardando",!1),(0,l.Z)(this,"itemDialog",!1),(0,l.Z)(this,"submitted",!1),(0,l.Z)(this,"proyectos",[]),(0,l.Z)(this,"unimeds",[]),(0,l.Z)(this,"uploadedFiles",[]),(0,l.Z)(this,"img",void 0),(0,l.Z)(this,"infoWindowPosition",void 0),(0,l.Z)(this,"polygons",[]),(0,l.Z)(this,"center",{lat:14.5934,lng:-87.8336}),(0,l.Z)(this,"options",{}),(0,l.Z)(this,"geocercaCoordinates",[]),(0,l.Z)(this,"isDrawing",!0),(0,l.Z)(this,"polygon",void 0),(0,l.Z)(this,"polygonOptions",{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0,draggable:!0}),(0,l.Z)(this,"$destroy",new C.x),(0,l.Z)(this,"Lote",{}),(0,l.Z)(this,"edit",new t.vpe),this.dbapi=e,this._builder=o,this.authS=i,this.skNsCore=s,this.createForm=o.group({lote_nid:[0],proy_nid:["",p.kI.required],unimed_nid:["",p.kI.required],lote_vnombre:["",p.kI.required],lote_vcodigo:["",p.kI.required],lote_vgeopath:["",p.kI.required],lote_fmedida:["",p.kI.required],lote_flargo:["",p.kI.required],lote_fancho:["",p.kI.required],lote_fprecio_unidad:["",p.kI.required],lote_fprecio:["",p.kI.required],lote_nsts:[""]}),this.options={zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1,mapTypeId:"hybrid",maxZoom:20,minZoom:4,tilt:45,mapTypeControl:!0},i.\u00f8bserverCompanySelected.pipe((0,v.R)(this.$destroy)).subscribe(d=>{})}consultas(){this.getProyectos(),this.getUnimeds(),this.getData()}ngOnChanges(){this.consultas(),this.Lote&&this.Lote?.lote_nid&&this.Lote?.lote_nid>0&&(this.geocercaCoordinates=JSON.parse(this.Lote?.lote_vgeopath),this.lote_nid?.setValue(this.Lote?.lote_nid),this.proy_nid?.setValue(this.Lote?.proy_nid),this.unimed_nid?.setValue(this.Lote?.unimed_nid),this.center=this.geocercaCoordinates[0],this.lote_vnombre?.setValue(this.Lote?.lote_vnombre),this.lote_vcodigo?.setValue(this.Lote?.lote_vcodigo),this.lote_fmedida?.setValue(this.Lote?.lote_fmedida),this.lote_fancho?.setValue(this.Lote?.lote_fancho),this.lote_flargo?.setValue(this.Lote?.lote_flargo),this.lote_fprecio?.setValue(this.Lote?.lote_fprecio),this.lote_fprecio_unidad?.setValue(this.Lote?.lote_fprecio_unidad),this.lote_vgeopath?.setValue(this.Lote?.lote_vgeopath),this.lote_nsts?.setValue(this.Lote?.lote_nsts),this.img=null,this.updatePolygon(),this.dbapi.getImg(this.Lote?.lote_nid).pipe((0,c.q)(1)).subscribe(e=>{e&&(this.img=e)}))}getProyectos(){this.proy_nid?.setValue(""),this.proyectos=[],this.dbapi.getProyectos().pipe((0,c.q)(1)).subscribe({next:e=>{if(e&&null!=e&&""!==e){for(const o in e)this.proyectos=[...this.proyectos,{id:e[o].proy_nid,text:e[o].proy_vnombre,obj:e[o]}];1==this.proyectos.length&&this.proy_nid?.setValue(this.proyectos[0])}else console.log("Error consultando compa\xf1\xedas")},error:e=>{console.log(e),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:e})}})}getData(){this.data=[],this.dataOriginal=[],this.dbapi.getAll(null).pipe((0,Z.U)(e=>(e.forEach(o=>{o.proy_vnombre=o._tproyectos?o._tproyectos.proy_vnombre:"",o.unimed_vdescripcion=o._tunidades_medidas?o._tunidades_medidas.unimed_vdescripcion:"",o.lote_vsts=1==o.lote_nsts?"ACTIVO":"ELIMINADO"}),this.dataOriginal=[...e],this.data=[...e],e)),(0,c.q)(1)).subscribe({next:()=>{this.setProyecto(this.proy_nid?.value)}})}setProyecto(e){for(let o=0;o<this.polygons.length;o++)this.polygons[o].setMap(null);this.polygons=[],this.data=e&&e.id?this.dataOriginal.filter(o=>o.proy_nid===e.id):[...this.dataOriginal],this.drawGeocercas(this.data)}drawGeocercas(e){e.forEach(o=>{if(o.lote_vgeopath&&o.lote_nid!=this.lote_nid?.value){let i="#00FF00";const s=`\n                    <p style="color: black;">\n                        <b>${o.lote_vnombre}</b> | ${o.proy_vnombre}<br>\n                        <strong>\xc1rea:</strong> ${o.lote_fmedida} m\xb2<br>\n                        <strong>Largo:</strong> ${o.lote_flargo} m<br>\n                        <strong>Ancho:</strong> ${o.lote_fancho} m<br>\n                    </p>\n                `;this.drawGeofence(JSON.parse(o.lote_vgeopath),s,i)}})}drawGeofence(e,o,i){const s=new google.maps.Polygon({paths:e,strokeColor:"black",strokeOpacity:.8,strokeWeight:2,fillColor:i,fillOpacity:.35});s.setMap(this.map.googleMap),s.addListener("click",d=>{d.latLng&&(this.infoContent=o,this.infoWindowPosition=d.latLng,this.infoWindow.open())}),this.polygons.push(s)}getUnimeds(){this.unimed_nid?.setValue(""),this.unimeds=[],this.dbapi.getUnimeds().pipe((0,c.q)(1)).subscribe({next:e=>{if(e&&null!=e&&""!==e){for(const o in e)this.unimeds=[...this.unimeds,{id:e[o].unimed_nid,text:e[o].unimed_vdescripcion,obj:e[o]}];1==this.unimeds.length&&this.unimed_nid?.setValue(this.unimeds[0])}else console.log("Error consultando compa\xf1\xedas")},error:e=>{console.log(e),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:e})}})}calculaPrecio(){let e=0;this.lote_fprecio_unidad?.value&&this.lote_fmedida?.value&&(e=this.lote_fprecio_unidad?.value*this.lote_fmedida?.value,this.lote_fprecio?.setValue(e))}onMapClick(e){if(e.latLng&&this.isDrawing){const o=e.latLng.toJSON();this.geocercaCoordinates=[...this.geocercaCoordinates,o],this.updatePolygon()}}onPolygonComplete(e){this.polygon=e,google.maps.event.addListener(e.getPath(),"set_at",()=>this.updatePolygonCoordinates()),google.maps.event.addListener(e.getPath(),"insert_at",()=>this.updatePolygonCoordinates()),google.maps.event.addListener(e.getPath(),"remove_at",()=>this.updatePolygonCoordinates())}updatePolygonCoordinates(){this.polygon&&(this.geocercaCoordinates=this.polygon.getPath().getArray().map(e=>e.toJSON()))}finishDrawing(){this.isDrawing=!1,this.geocercaCoordinates.length>2&&(this.geocercaCoordinates=[...this.geocercaCoordinates,this.geocercaCoordinates[0]]);const e=JSON.stringify(this.geocercaCoordinates);this.lote_vgeopath?.setValue(e)}updatePolygon(){if(this.geocercaCoordinates.length>1)if(this.polygon)this.polygon.setPath(this.geocercaCoordinates.map(e=>new google.maps.LatLng(e.lat,e.lng)));else{const e=this.map?.googleMap;e&&(this.polygon=new google.maps.Polygon({...this.polygonOptions,paths:this.geocercaCoordinates.map(o=>new google.maps.LatLng(o.lat,o.lng))}),this.polygon.setMap(e),this.onPolygonComplete(this.polygon))}}clearPolygon(){this.polygon&&(this.polygon.setMap(null),this.polygon=void 0),this.geocercaCoordinates=[],this.lote_vgeopath?.setValue(""),this.isDrawing=!0}save(){if(this.createForm.valid&&!this.guardando){this.guardando=!0;const e={lote_nid:this.lote_nid?.value>0?this.lote_nid?.value:null,proy_nid:this.proy_nid?.value.id,unimed_nid:this.unimed_nid?.value.id,lote_vgeopath:this.lote_vgeopath?.value,lote_vnombre:this.lote_vnombre?.value.trim().toUpperCase(),lote_vcodigo:this.lote_vcodigo?.value.trim().toUpperCase(),lote_fmedida:this.lote_fmedida?.value,lote_flargo:this.lote_flargo?.value,lote_fancho:this.lote_fancho?.value,lote_fprecio_unidad:this.lote_fprecio_unidad?.value,lote_fprecio:this.lote_fprecio?.value,lote_nsts:1};this.dbapi.save(e,this.img).pipe((0,c.q)(1)).subscribe({next:o=>{"success"==o.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.limpiarForm()),this.edit.emit(o),this.guardando=!1,this.clearPolygon()},error:o=>{console.log(o),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:o})}})}}limpiarForm(){this.createForm.reset(),this.lote_nid?.setValue(0),this.onRemove({files:[]})}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(e,o){for(let i=0;i<o.length;i++){const s=o[i];if(s.id==e)return s}return""}onSelect(e){for(const o of e.files)this.uploadedFiles.push(o),this.convertirArchivoABase64(o).then(s=>{this.img=s}).catch(s=>{console.error("Error al convertir archivo a base64:",s)});console.log("onSelect",this.uploadedFiles)}onRemove(e){this.uploadedFiles=[],this.img=null}convertirArchivoABase64(e){return new Promise((o,i)=>{const s=new FileReader;s.onload=()=>{o(s.result.split(",")[1])},s.onerror=d=>i(d),s.readAsDataURL(e)})}convertirBase64AFile(e,o){const i=atob(e),s=new Array(i.length);for(let f=0;f<i.length;f++)s[f]=i.charCodeAt(f);const d=new Uint8Array(s),dt=new Blob([d],{type:"application/octet-stream"});return new File([dt],o)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get lote_nid(){return this.createForm.get("lote_nid")}get proy_nid(){return this.createForm.get("proy_nid")}get unimed_nid(){return this.createForm.get("unimed_nid")}get lote_vnombre(){return this.createForm.get("lote_vnombre")}get lote_vcodigo(){return this.createForm.get("lote_vcodigo")}get lote_vgeopath(){return this.createForm.get("lote_vgeopath")}get lote_fmedida(){return this.createForm.get("lote_fmedida")}get lote_fprecio_unidad(){return this.createForm.get("lote_fprecio_unidad")}get lote_flargo(){return this.createForm.get("lote_flargo")}get lote_fancho(){return this.createForm.get("lote_fancho")}get lote_fprecio(){return this.createForm.get("lote_fprecio")}get lote_nsts(){return this.createForm.get("lote_nsts")}}return(0,l.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(y.l),t.Y36(p.qu),t.Y36(T.e),t.Y36(A.pP))}),(0,l.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-create-lotes"]],viewQuery:function(e,o){if(1&e&&(t.Gf(u.b6,5),t.Gf(u.ch,5)),2&e){let i;t.iGM(i=t.CRH())&&(o.map=i.first),t.iGM(i=t.CRH())&&(o.infoWindow=i.first)}},inputs:{Lote:"Lote"},outputs:{edit:"edit"},features:[t.TTD],decls:64,vars:27,consts:[[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["slot","width: 200px;","optionLabel","text","formControlName","proy_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize","onChange"],["slot","width: 200px;","optionLabel","text","formControlName","unimed_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","lote_vnombre","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","lote_vcodigo","type","text","required","",2,"text-transform","uppercase"],[1,"col-12","md:col-2"],["pInputText","","formControlName","lote_fmedida","type","number","min","1","max","100000000","required","",2,"text-transform","uppercase",3,"input"],["pInputText","","formControlName","lote_flargo","type","number","min","1","max","10000","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","lote_fancho","type","number","min","1","max","10000","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","lote_fprecio_unidad","type","number","min","1","max","10000000000","required","",2,"text-transform","uppercase",3,"input"],["pInputText","","formControlName","lote_fprecio","type","number","min","1","max","10000000000","required","",2,"text-transform","uppercase"],["accept","image/*","chooseLabel","Seleccionar...",3,"multiple","showUploadButton","maxFileSize","fileLimit","customUpload","onSelect","onRemove","onClear"],["fileUpload",""],["pTemplate","file","style","display: none;"],["pTemplate","content","style","display: none;"],["style","max-width: 300px; margin-left: auto; margin-right: auto; margin-top: 5px;",3,"src",4,"ngIf"],[1,"col-12","ml-1","mr-1"],[1,"map-container",2,"height","300px"],[1,"map-wrapper",2,"height","100%"],["height","100%","width","100%",3,"zoom","center","options","mapClick"],[3,"options"],[2,"color","black",3,"innerHTML"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","label","Finalizar Geocerca","icon","pi pi-pencil","class","p-button-warning mr-1 btn-sm","type","button",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times","class","p-button-info mr-1 btn-sm","type","button",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"],[2,"max-width","300px","margin-left","auto","margin-right","auto","margin-top","5px",3,"src"],["pButton","","pRipple","","label","Finalizar Geocerca","icon","pi pi-pencil","type","button",1,"p-button-warning","mr-1","btn-sm",3,"click"],["pButton","","pRipple","","icon","pi pi-times","type","button",1,"p-button-info","mr-1","btn-sm",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return o.save()}),t.TgZ(2,"div",2)(3,"label",3),t._uU(4,"Proyecto"),t.qZA(),t.TgZ(5,"div",4)(6,"p-dropdown",5),t.NdJ("onChange",function(s){return o.setProyecto(s.value)}),t.qZA()()(),t.TgZ(7,"div",2)(8,"label",3),t._uU(9,"Unidad"),t.qZA(),t.TgZ(10,"div",4),t._UZ(11,"p-dropdown",6),t.qZA()(),t.TgZ(12,"div",2)(13,"label",3),t._uU(14,"Lote"),t.qZA(),t.TgZ(15,"div",4),t._UZ(16,"input",7),t.qZA()(),t.TgZ(17,"div",2)(18,"label",3),t._uU(19,"Codigo"),t.qZA(),t.TgZ(20,"div",4),t._UZ(21,"input",8),t.qZA()(),t.TgZ(22,"div",2)(23,"label",3),t._uU(24,"Medida total"),t.qZA(),t.TgZ(25,"div",9)(26,"input",10),t.NdJ("input",function(){return o.calculaPrecio()}),t.qZA()(),t.TgZ(27,"label",3),t._uU(28,"Largo"),t.qZA(),t.TgZ(29,"div",9),t._UZ(30,"input",11),t.qZA(),t.TgZ(31,"label",3),t._uU(32,"Ancho"),t.qZA(),t.TgZ(33,"div",9),t._UZ(34,"input",12),t.qZA()(),t.TgZ(35,"div",2)(36,"label",3),t._uU(37,"Precio por unidad"),t.qZA(),t.TgZ(38,"div",4)(39,"input",13),t.NdJ("input",function(){return o.calculaPrecio()}),t.qZA()()(),t.TgZ(40,"div",2)(41,"label",3),t._uU(42,"Precio"),t.qZA(),t.TgZ(43,"div",4),t._UZ(44,"input",14),t.qZA()(),t.TgZ(45,"p-fileUpload",15,16),t.NdJ("onSelect",function(s){return o.onSelect(s)})("onRemove",function(s){return o.onRemove(s)})("onClear",function(s){return o.onRemove(s)}),t.YNc(47,M,1,0,"ng-template",17),t.YNc(48,P,1,0,"ng-template",18),t.qZA(),t.YNc(49,R,1,1,"img",19),t.TgZ(50,"div",20)(51,"div",21)(52,"div",22)(53,"google-map",23),t.NdJ("mapClick",function(s){return o.onMapClick(s)}),t.TgZ(54,"map-info-window",24),t._UZ(55,"p",25),t.qZA()()()()(),t._UZ(56,"hr"),t.TgZ(57,"div",2)(58,"div",26)(59,"span",27),t.YNc(60,E,1,0,"button",28),t.YNc(61,O,1,0,"button",29),t._UZ(62,"button",30),t.TgZ(63,"button",31),t.NdJ("click",function(){return o.limpiarForm()}),t.qZA()()()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.createForm),t.xp6(5),t.Q6J("options",o.proyectos)("filter",!0)("virtualScroll",o.proyectos.length>5)("virtualScrollItemSize",38),t.xp6(5),t.Q6J("options",o.unimeds)("filter",!0)("virtualScroll",o.unimeds.length>5)("virtualScrollItemSize",38),t.xp6(34),t.Q6J("multiple",!0)("showUploadButton",!1)("maxFileSize",1e6)("fileLimit",1)("customUpload",!0),t.xp6(4),t.Q6J("ngIf",o.img&&""!==o.img),t.xp6(4),t.Q6J("zoom",17)("center",o.center)("options",o.options),t.xp6(1),t.Q6J("options",t.VKq(25,B,o.infoWindowPosition)),t.xp6(1),t.Q6J("innerHTML",o.infoContent,t.oJD),t.xp6(5),t.Q6J("ngIf",o.geocercaCoordinates.length>0),t.xp6(1),t.Q6J("ngIf",o.geocercaCoordinates.length>0),t.xp6(1),t.Q6J("disabled",!o.createForm.valid)("loading",o.guardando)("label",o.Lote&&o.Lote.lote_nid?"Editar":"Guardar"))},dependencies:[_.O5,p._Y,p.Fj,p.wV,p.JJ,p.JL,p.Q7,p.qQ,p.Fd,p.sg,p.u,g.jx,L.p,x.Hq,S.H,w.o,U.Lt,u.b6,u.ch]})),n})();function Q(n,r){1&n&&(t.TgZ(0,"div",22)(1,"h3",23),t._uU(2,"Listado de Lotes"),t.qZA()())}function V(n,r){if(1&n){const e=t.EpF();t._UZ(0,"p-fileUpload",24),t.TgZ(1,"button",25),t.NdJ("click",function(){t.CHM(e),t.oxw();const i=t.MAs(8);return t.KtG(i.exportCSV())}),t.qZA()}2&n&&t.Q6J("maxFileSize",1e6)}const G=function(){return{float:"right"}};function Y(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",26)(1,"span",27)(2,"input",28),t.NdJ("input",function(i){t.CHM(e);const s=t.oxw(),d=t.MAs(8);return t.KtG(s.onGlobalFilter(d,i))}),t.qZA(),t.TgZ(3,"button",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.getData())}),t.qZA(),t.TgZ(4,"button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openNew())}),t.qZA(),t.TgZ(5,"p-selectButton",31),t.NdJ("ngModelChange",function(i){t.CHM(e);const s=t.oxw();return t.KtG(s.dataValue=i)})("click",function(){t.CHM(e);const i=t.oxw();return i.getData(),t.KtG(i.clearDataSelected())}),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(5),t.Q6J("options",e.dataOptions)("ngModel",e.dataValue)("ngStyle",t.DdM(3,G))}}function K(n,r){if(1&n&&(t.TgZ(0,"th",34),t._uU(1),t._UZ(2,"p-sortIcon",35),t.qZA()),2&n){const e=r.$implicit;t.ekj("rowStyle","ID"!==e.header)("rowStyleId","ID"===e.header),t.Q6J("pSortableColumn",e.field),t.xp6(1),t.hij(" ",e.header," "),t.xp6(1),t.Q6J("field",e.field)}}function $(n,r){if(1&n&&(t.TgZ(0,"tr")(1,"th",32),t._UZ(2,"p-tableHeaderCheckbox"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Acciones"),t.qZA(),t.YNc(5,K,3,7,"th",33),t.qZA()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.cols)}}function z(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",42),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw();return t.KtG(s.editRow(i))}),t.qZA()}}function j(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw();return t.KtG(s.deleteRow(i))}),t.qZA()}}function W(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",44),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw();return t.KtG(s.restartRow(i))}),t.qZA()}}function X(n,r){if(1&n&&(t.TgZ(0,"td")(1,"span",45),t._uU(2),t.qZA(),t._uU(3),t.qZA()),2&n){const e=r.$implicit,o=t.oxw().$implicit;t.xp6(2),t.Oqu(e.header),t.xp6(1),t.hij(" ",o[e.field]," ")}}function tt(n,r){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-tableCheckbox",36),t.qZA(),t.TgZ(3,"td")(4,"div",37),t.YNc(5,z,1,0,"button",38),t.YNc(6,j,1,0,"button",39),t.YNc(7,W,1,0,"button",40),t.qZA()(),t.YNc(8,X,4,2,"td",41),t.qZA()),2&n){const e=r.$implicit,o=t.oxw();t.xp6(2),t.Q6J("value",e),t.xp6(3),t.Q6J("ngIf",e.lote_nsts>0),t.xp6(1),t.Q6J("ngIf",e.lote_nsts>0),t.xp6(1),t.Q6J("ngIf",e.lote_nsts<1),t.xp6(1),t.Q6J("ngForOf",o.cols)}}function et(n,r){if(1&n&&(t.TgZ(0,"span"),t._uU(1,"Estas seguro que quieres eliminar "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4,"?"),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.item.lote_vnombre)}}function ot(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteItemDialog=!1)}),t.qZA(),t.TgZ(1,"button",47),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmDelete())}),t.qZA()}}function it(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteItemsDialog=!1)}),t.qZA(),t.TgZ(1,"button",47),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmDeleteSelected())}),t.qZA()}}function nt(n,r){if(1&n&&(t.TgZ(0,"span"),t._uU(1,"Estas seguro que quieres restaurar "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4,"?"),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.item.lote_vnombre)}}function st(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.restartItemDialog=!1)}),t.qZA(),t.TgZ(1,"button",48),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmRestart())}),t.qZA()}}function lt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.restartItemsDialog=!1)}),t.qZA(),t.TgZ(1,"button",48),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirmRestartSelected())}),t.qZA()}}const rt=function(){return[10,20,30]},D=function(){return{width:"950px"}},h=function(){return{width:"450px"}},at=[{path:"",component:(()=>{class n{constructor(e,o,i,s){(0,l.Z)(this,"dbapi",void 0),(0,l.Z)(this,"messageService",void 0),(0,l.Z)(this,"authS",void 0),(0,l.Z)(this,"skNsCore",void 0),(0,l.Z)(this,"createDialog",!1),(0,l.Z)(this,"editDialog",!1),(0,l.Z)(this,"deleteItemDialog",!1),(0,l.Z)(this,"deleteItemsDialog",!1),(0,l.Z)(this,"restartItemDialog",!1),(0,l.Z)(this,"restartItemsDialog",!1),(0,l.Z)(this,"isLoadingTable",!1),(0,l.Z)(this,"data",[]),(0,l.Z)(this,"item",{}),(0,l.Z)(this,"selectedData",[]),(0,l.Z)(this,"submitted",!1),(0,l.Z)(this,"cols",[]),(0,l.Z)(this,"statuses",[]),(0,l.Z)(this,"dataOptions",[]),(0,l.Z)(this,"dataValue",[1]),(0,l.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,l.Z)(this,"$destroy",new C.x),this.dbapi=e,this.messageService=o,this.authS=i,this.skNsCore=s,s.fromEvent("/proyectos/lotes").pipe((0,v.R)(this.$destroy)).subscribe(d=>{this.skNsCore.socketId!=d&&(console.log("Event socket: unidades medidas"),this.getData())}),this.cols=[{field:"lote_nid",header:"ID"},{field:"proy_vnombre",header:"Proyecto"},{field:"unimed_vdescripcion",header:"Unidad"},{field:"lote_vnombre",header:"Lote"},{field:"lote_vcodigo",header:"Codigo"},{field:"lote_fmedida",header:"Medidas"},{field:"lote_flargo",header:"Largo"},{field:"lote_fancho",header:"Ancho"},{field:"lote_fprecio_unidad",header:"Precio unidad"},{field:"lote_fprecio",header:"Precio"},{field:"lote_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}],this.getData()}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,Z.U)(e=>(e.forEach(o=>{o.proy_vnombre=o._tproyectos?o._tproyectos.proy_vnombre:"",o.unimed_vdescripcion=o._tunidades_medidas?o._tunidades_medidas.unimed_vdescripcion:"",o.lote_vsts=1==o.lote_nsts?"ACTIVO":"ELIMINADO"}),e)),(0,c.q)(1)).subscribe({next:e=>{this.data=[...e],console.log("data",this.data),this.isLoadingTable=!1},error:e=>{console.log(e),this.isLoadingTable=!1,this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}restartSelectedItems(){this.restartItemsDialog=!0}editRow(e){this.item={...e},this.editDialog=!0}deleteRow(e){this.deleteItemDialog=!0,this.item={...e}}restartRow(e){this.restartItemDialog=!0,this.item={...e}}confirmDeleteSelected(){const e=[];this.selectedData.forEach(o=>{e.push({lote_nid:o.lote_nid,lote_nsts:0})}),this.dbapi.setBulkSts(e).pipe((0,c.q)(1)).subscribe({next:o=>{this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),"success"==o.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmDelete(){this.dbapi.setSts({lote_nid:this.item.lote_nid,lote_nsts:0}).pipe((0,c.q)(1)).subscribe({next:o=>{this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmRestart(){this.item.lote_nsts=1,this.dbapi.setSts(this.item).pipe((0,c.q)(1)).subscribe({next:e=>{this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}confirmRestartSelected(){this.selectedData.forEach(e=>{e.lote_nsts=1}),this.item.lote_nsts=1,this.dbapi.setBulkSts(this.selectedData).pipe((0,c.q)(1)).subscribe({next:e=>{this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),"success"==e.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}findIndexById(e){let o=-1;for(let i=0;i<this.data.length;i++)if(this.data[i].lote_nid===e){o=i;break}return o}onGlobalFilter(e,o){e.filterGlobal(o.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}editEvent(e){this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),"success"==e.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}clearDataSelected(){this.selectedData=[]}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,l.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(y.l),t.Y36(g.ez),t.Y36(T.e),t.Y36(A.pP))}),(0,l.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["ng-component"]],features:[t._Bn([g.ez])],decls:38,vars:45,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","unimed_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear lote",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar lote",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"Lote","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1",3,"click"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],[2,"width","3rem"],["style","width: 100rem",3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[2,"width","100rem",3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"p-toast",3),t.TgZ(4,"p-toolbar",4),t.YNc(5,Q,3,0,"ng-template",5),t.YNc(6,V,2,1,"ng-template",6),t.qZA(),t.TgZ(7,"p-table",7,8),t.NdJ("selectionChange",function(s){return o.selectedData=s}),t.YNc(9,Y,6,4,"ng-template",9),t.YNc(10,$,6,1,"ng-template",10),t.YNc(11,tt,9,5,"ng-template",11),t.qZA()(),t.TgZ(12,"p-dialog",12),t.NdJ("visibleChange",function(s){return o.createDialog=s}),t.TgZ(13,"app-create-lotes",13),t.NdJ("edit",function(s){return o.editEvent(s)}),t.qZA()(),t.TgZ(14,"p-dialog",14),t.NdJ("visibleChange",function(s){return o.editDialog=s}),t.TgZ(15,"app-create-lotes",15),t.NdJ("edit",function(s){return o.editEvent(s)}),t.qZA()(),t.TgZ(16,"p-dialog",16),t.NdJ("visibleChange",function(s){return o.deleteItemDialog=s}),t.TgZ(17,"div",17),t._UZ(18,"i",18),t.YNc(19,et,5,1,"span",19),t.qZA(),t.YNc(20,ot,2,0,"ng-template",20),t.qZA(),t.TgZ(21,"p-dialog",21),t.NdJ("visibleChange",function(s){return o.deleteItemsDialog=s}),t.TgZ(22,"div",17),t._UZ(23,"i",18),t.TgZ(24,"span"),t._uU(25,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),t.qZA()(),t.YNc(26,it,2,0,"ng-template",20),t.qZA(),t.TgZ(27,"p-dialog",16),t.NdJ("visibleChange",function(s){return o.restartItemDialog=s}),t.TgZ(28,"div",17),t._UZ(29,"i",18),t.YNc(30,nt,5,1,"span",19),t.qZA(),t.YNc(31,st,2,0,"ng-template",20),t.qZA(),t.TgZ(32,"p-dialog",21),t.NdJ("visibleChange",function(s){return o.restartItemsDialog=s}),t.TgZ(33,"div",17),t._UZ(34,"i",18),t.TgZ(35,"span"),t._uU(36,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),t.qZA()(),t.YNc(37,lt,2,0,"ng-template",20),t.qZA()()()),2&e&&(t.xp6(7),t.Q6J("value",o.data)("columns",o.cols)("rows",10)("globalFilterFields",o.cols)("rows",10)("paginator",!0)("loading",o.isLoadingTable)("rowsPerPageOptions",t.DdM(38,rt))("showCurrentPageReport",!0)("selection",o.selectedData)("rowHover",!0),t.xp6(5),t.Akn(t.DdM(39,D)),t.Q6J("visible",o.createDialog)("modal",!0),t.xp6(2),t.Akn(t.DdM(40,D)),t.Q6J("visible",o.editDialog)("modal",!0),t.xp6(1),t.Q6J("Lote",o.item),t.xp6(1),t.Akn(t.DdM(41,h)),t.Q6J("visible",o.deleteItemDialog)("modal",!0),t.xp6(3),t.Q6J("ngIf",o.item),t.xp6(2),t.Akn(t.DdM(42,h)),t.Q6J("visible",o.deleteItemsDialog)("modal",!0),t.xp6(6),t.Akn(t.DdM(43,h)),t.Q6J("visible",o.restartItemDialog)("modal",!0),t.xp6(3),t.Q6J("ngIf",o.item),t.xp6(2),t.Akn(t.DdM(44,h)),t.Q6J("visible",o.restartItemsDialog)("modal",!0))},dependencies:[_.sg,_.O5,_.PC,p.JJ,p.On,m.iA,g.jx,m.lQ,m.fz,m.UA,m.Mo,L.p,x.Hq,N.UN,S.H,q.FN,J.o,w.o,F.V,H]})),n})()}];let pt=(()=>{class n{}return(0,l.Z)(n,"\u0275fac",function(e){return new(e||n)}),(0,l.Z)(n,"\u0275mod",t.oAB({type:n})),(0,l.Z)(n,"\u0275inj",t.cJS({imports:[k.m,u.Y4,I.Bz.forChild(at)]})),n})()}}]);