"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[98],{98:(ce,b,r)=>{r.r(b),r.d(b,{LotesModule:()=>pe});var l=r(1180),k=r(7246),I=r(1380),g=r(805),C=r(7579),v=r(2722),Z=r(4004),c=r(5698),e=r(4650),y=r(2162),T=r(629),A=r(1168),_=r(6895),p=r(433),m=r(99),L=r(3388),x=r(5593),N=r(5362),D=r(1795),q=r(2453),J=r(1383),S=r(1740),F=r(1493),u=r(2661),U=r(2210);function M(n,a){1&n&&e._UZ(0,"div")}function P(n,a){1&n&&e._UZ(0,"div")}function R(n,a){if(1&n&&e._UZ(0,"img",32),2&n){const t=e.oxw();e.Q6J("src","data:image/png;base64,"+t.img,e.LSH)}}function E(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.finishDrawing())}),e.qZA()}}function O(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.clearPolygon())}),e.qZA()}}const B=function(n){return{position:n}};let H=(()=>{class n{constructor(t,o,i,s){(0,l.Z)(this,"dbapi",void 0),(0,l.Z)(this,"_builder",void 0),(0,l.Z)(this,"authS",void 0),(0,l.Z)(this,"skNsCore",void 0),(0,l.Z)(this,"map",void 0),(0,l.Z)(this,"infoWindow",void 0),(0,l.Z)(this,"infoContent",""),(0,l.Z)(this,"dataOriginal",[]),(0,l.Z)(this,"data",[]),(0,l.Z)(this,"createForm",void 0),(0,l.Z)(this,"primeraCons",!1),(0,l.Z)(this,"guardando",!1),(0,l.Z)(this,"itemDialog",!1),(0,l.Z)(this,"submitted",!1),(0,l.Z)(this,"residenciales",[]),(0,l.Z)(this,"unimeds",[]),(0,l.Z)(this,"uploadedFiles",[]),(0,l.Z)(this,"img",void 0),(0,l.Z)(this,"infoWindowPosition",void 0),(0,l.Z)(this,"polygons",[]),(0,l.Z)(this,"center",{lat:14.5934,lng:-87.8336}),(0,l.Z)(this,"options",{}),(0,l.Z)(this,"geocercaCoordinates",[]),(0,l.Z)(this,"isDrawing",!0),(0,l.Z)(this,"polygon",void 0),(0,l.Z)(this,"polygonOptions",{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0,draggable:!0}),(0,l.Z)(this,"$destroy",new C.x),(0,l.Z)(this,"Lote",{}),(0,l.Z)(this,"edit",new e.vpe),this.dbapi=t,this._builder=o,this.authS=i,this.skNsCore=s,this.createForm=o.group({lote_nid:[0],proy_nid:["",p.kI.required],unimed_nid:["",p.kI.required],lote_vnombre:["",p.kI.required],lote_vcodigo:["",p.kI.required],lote_vgeopath:["",p.kI.required],lote_fmedida:["",p.kI.required],lote_flargo:["",p.kI.required],lote_fancho:["",p.kI.required],lote_fprecio_unidad:["",p.kI.required],lote_fprecio:["",p.kI.required],lote_nsts:[""]}),this.options={zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1,mapTypeId:"hybrid",maxZoom:20,minZoom:4,tilt:45,mapTypeControl:!0},i.\u00f8bserverCompanySelected.pipe((0,v.R)(this.$destroy)).subscribe(d=>{this.consultas(),this.getUnimeds()})}consultas(){this.getProyectos(),this.getData()}ngOnChanges(){this.Lote&&this.Lote?.lote_nid&&this.Lote?.lote_nid>0&&(this.geocercaCoordinates=JSON.parse(this.Lote?.lote_vgeopath),this.lote_nid?.setValue(this.Lote?.lote_nid),this.proy_nid?.setValue(this.searchById(this.Lote?.proy_nid,this.residenciales)),this.getData(),this.unimed_nid?.setValue(this.searchById(this.Lote?.unimed_nid,this.unimeds)),this.center=this.geocercaCoordinates[0],this.lote_vnombre?.setValue(this.Lote?.lote_vnombre),this.lote_vcodigo?.setValue(this.Lote?.lote_vcodigo),this.lote_fmedida?.setValue(this.Lote?.lote_fmedida),this.lote_fancho?.setValue(this.Lote?.lote_fancho),this.lote_flargo?.setValue(this.Lote?.lote_flargo),this.lote_fprecio?.setValue(this.Lote?.lote_fprecio),this.lote_fprecio_unidad?.setValue(this.Lote?.lote_fprecio_unidad),this.lote_vgeopath?.setValue(this.Lote?.lote_vgeopath),this.lote_nsts?.setValue(this.Lote?.lote_nsts),this.img=null,this.updatePolygon(),this.dbapi.getImg(this.Lote?.lote_nid).pipe((0,c.q)(1)).subscribe(t=>{t&&(this.img=t)}))}getProyectos(){this.proy_nid?.setValue(""),this.residenciales=[],this.dbapi.getProyectos().pipe((0,c.q)(1)).subscribe({next:t=>{if(t&&null!=t&&""!==t){for(const o in t)this.residenciales=[...this.residenciales,{id:t[o].proy_nid,text:t[o].proy_vnombre,obj:t[o]}];1==this.residenciales.length&&this.proy_nid?.setValue(this.residenciales[0]),this.residenciales=[...this.residenciales]}else console.log("Error consultando compa\xf1\xedas")},error:t=>{console.log(t),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}})}getData(){this.data=[],this.dataOriginal=[],this.dbapi.getAll(null).pipe((0,Z.U)(t=>(t.forEach(o=>{o.proy_vnombre=o._tproyectos?o._tproyectos.proy_vnombre:"",o.unimed_vdescripcion=o._tunidades_medidas?o._tunidades_medidas.unimed_vdescripcion:"",o.lote_vsts=1==o.lote_nsts?"ACTIVO":"ELIMINADO"}),this.dataOriginal=[...t],this.data=[...t],t)),(0,c.q)(1)).subscribe({next:()=>{this.setProyecto(this.proy_nid?.value)}})}verData(){console.log("residenciales",this.residenciales)}setProyecto(t){for(let o=0;o<this.polygons.length;o++)this.polygons[o].setMap(null);this.polygons=[],this.data=t&&t.id?this.dataOriginal.filter(o=>o.proy_nid===t.id):[...this.dataOriginal],this.drawGeocercas(this.data)}drawGeocercas(t){t.forEach(o=>{if(o.lote_vgeopath&&o.lote_nid!=this.lote_nid?.value){let i="#00FF00";const s=`\n                    <p style="color: black;">\n                        <b>${o.lote_vnombre}</b> | ${o.proy_vnombre}<br>\n                        <strong>\xc1rea:</strong> ${o.lote_fmedida} m\xb2<br>\n                        <strong>Largo:</strong> ${o.lote_flargo} m<br>\n                        <strong>Ancho:</strong> ${o.lote_fancho} m<br>\n                    </p>\n                `;this.drawGeofence(JSON.parse(o.lote_vgeopath),s,i)}})}drawGeofence(t,o,i){const s=new google.maps.Polygon({paths:t,strokeColor:"black",strokeOpacity:.8,strokeWeight:2,fillColor:i,fillOpacity:.35});s.setMap(this.map.googleMap),s.addListener("click",d=>{d.latLng&&(this.infoContent=o,this.infoWindowPosition=d.latLng,this.infoWindow.open())}),this.polygons.push(s)}getUnimeds(){this.unimed_nid?.setValue(""),this.unimeds=[],this.dbapi.getUnimeds().pipe((0,c.q)(1)).subscribe({next:t=>{if(t&&null!=t&&""!==t){for(const o in t)this.unimeds=[...this.unimeds,{id:t[o].unimed_nid,text:t[o].unimed_vdescripcion,obj:t[o]}];1==this.unimeds.length&&this.unimed_nid?.setValue(this.unimeds[0])}else console.log("Error consultando compa\xf1\xedas")},error:t=>{console.log(t),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}})}calculaPrecio(){let t=0;this.lote_fprecio_unidad?.value&&this.lote_fmedida?.value&&(t=this.lote_fprecio_unidad?.value*this.lote_fmedida?.value,this.lote_fprecio?.setValue(t))}onMapClick(t){if(t.latLng&&this.isDrawing){const o=t.latLng.toJSON();this.geocercaCoordinates=[...this.geocercaCoordinates,o],this.updatePolygon()}}onPolygonComplete(t){this.polygon=t,google.maps.event.addListener(t.getPath(),"set_at",()=>this.updatePolygonCoordinates()),google.maps.event.addListener(t.getPath(),"insert_at",()=>this.updatePolygonCoordinates()),google.maps.event.addListener(t.getPath(),"remove_at",()=>this.updatePolygonCoordinates())}updatePolygonCoordinates(){this.polygon&&(this.geocercaCoordinates=this.polygon.getPath().getArray().map(t=>t.toJSON()))}finishDrawing(){this.isDrawing=!1,this.geocercaCoordinates.length>2&&(this.geocercaCoordinates=[...this.geocercaCoordinates,this.geocercaCoordinates[0]]);const t=JSON.stringify(this.geocercaCoordinates);this.lote_vgeopath?.setValue(t)}updatePolygon(){if(this.geocercaCoordinates.length>1)if(this.polygon)this.polygon.setPath(this.geocercaCoordinates.map(t=>new google.maps.LatLng(t.lat,t.lng)));else{const t=this.map?.googleMap;t&&(this.polygon=new google.maps.Polygon({...this.polygonOptions,paths:this.geocercaCoordinates.map(o=>new google.maps.LatLng(o.lat,o.lng))}),this.polygon.setMap(t),this.onPolygonComplete(this.polygon))}}clearPolygon(){this.polygon&&(this.polygon.setMap(null),this.polygon=void 0),this.geocercaCoordinates=[],this.lote_vgeopath?.setValue(""),this.isDrawing=!0}save(){if(this.createForm.valid&&!this.guardando){this.guardando=!0;const t={lote_nid:this.lote_nid?.value>0?this.lote_nid?.value:null,proy_nid:this.proy_nid?.value.id,unimed_nid:this.unimed_nid?.value.id,lote_vgeopath:this.lote_vgeopath?.value,lote_vnombre:this.lote_vnombre?.value.trim().toUpperCase(),lote_vcodigo:this.lote_vcodigo?.value.trim().toUpperCase(),lote_fmedida:this.lote_fmedida?.value,lote_flargo:this.lote_flargo?.value,lote_fancho:this.lote_fancho?.value,lote_fprecio_unidad:this.lote_fprecio_unidad?.value,lote_fprecio:this.lote_fprecio?.value,lote_nsts:1};this.dbapi.save(t,this.img).pipe((0,c.q)(1)).subscribe({next:o=>{"success"==o.type&&(this.skNsCore.notificarUpsert("/residenciales/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.limpiarForm()),this.edit.emit(o),this.guardando=!1,this.clearPolygon()},error:o=>{console.log(o),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:o})}})}}limpiarForm(){this.createForm.reset(),this.lote_nid?.setValue(0),this.onRemove({files:[]})}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(t,o){for(let i=0;i<o.length;i++){const s=o[i];if(s.id==t)return s}return""}onSelect(t){for(const o of t.files)this.uploadedFiles.push(o),this.convertirArchivoABase64(o).then(s=>{this.img=s}).catch(s=>{console.error("Error al convertir archivo a base64:",s)});console.log("onSelect",this.uploadedFiles)}onRemove(t){this.uploadedFiles=[],this.img=null}convertirArchivoABase64(t){return new Promise((o,i)=>{const s=new FileReader;s.onload=()=>{o(s.result.split(",")[1])},s.onerror=d=>i(d),s.readAsDataURL(t)})}convertirBase64AFile(t,o){const i=atob(t),s=new Array(i.length);for(let f=0;f<i.length;f++)s[f]=i.charCodeAt(f);const d=new Uint8Array(s),de=new Blob([d],{type:"application/octet-stream"});return new File([de],o)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get lote_nid(){return this.createForm.get("lote_nid")}get proy_nid(){return this.createForm.get("proy_nid")}get unimed_nid(){return this.createForm.get("unimed_nid")}get lote_vnombre(){return this.createForm.get("lote_vnombre")}get lote_vcodigo(){return this.createForm.get("lote_vcodigo")}get lote_vgeopath(){return this.createForm.get("lote_vgeopath")}get lote_fmedida(){return this.createForm.get("lote_fmedida")}get lote_fprecio_unidad(){return this.createForm.get("lote_fprecio_unidad")}get lote_flargo(){return this.createForm.get("lote_flargo")}get lote_fancho(){return this.createForm.get("lote_fancho")}get lote_fprecio(){return this.createForm.get("lote_fprecio")}get lote_nsts(){return this.createForm.get("lote_nsts")}}return(0,l.Z)(n,"\u0275fac",function(t){return new(t||n)(e.Y36(y.l),e.Y36(p.qu),e.Y36(T.e),e.Y36(A.pP))}),(0,l.Z)(n,"\u0275cmp",e.Xpm({type:n,selectors:[["app-create-lotes"]],viewQuery:function(t,o){if(1&t&&(e.Gf(u.b6,5),e.Gf(u.ch,5)),2&t){let i;e.iGM(i=e.CRH())&&(o.map=i.first),e.iGM(i=e.CRH())&&(o.infoWindow=i.first)}},inputs:{Lote:"Lote"},outputs:{edit:"edit"},features:[e.TTD],decls:64,vars:27,consts:[[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["slot","width: 200px;","optionLabel","text","formControlName","proy_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize","onChange"],["slot","width: 200px;","optionLabel","text","formControlName","unimed_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","lote_vnombre","type","text","required","",2,"text-transform","uppercase",3,"input"],["pInputText","","formControlName","lote_vcodigo","type","text","required","",2,"text-transform","uppercase"],[1,"col-12","md:col-2"],["pInputText","","formControlName","lote_fmedida","type","number","min","1","max","100000000","required","",2,"text-transform","uppercase",3,"input"],["pInputText","","formControlName","lote_flargo","type","number","min","1","max","10000","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","lote_fancho","type","number","min","1","max","10000","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","lote_fprecio_unidad","type","number","min","1","max","10000000000","required","",2,"text-transform","uppercase",3,"input"],["pInputText","","formControlName","lote_fprecio","type","number","min","1","max","10000000000","required","",2,"text-transform","uppercase"],["accept","image/*","chooseLabel","Seleccionar...",3,"multiple","showUploadButton","maxFileSize","fileLimit","customUpload","onSelect","onRemove","onClear"],["fileUpload",""],["pTemplate","file","style","display: none;"],["pTemplate","content","style","display: none;"],["style","max-width: 300px; margin-left: auto; margin-right: auto; margin-top: 5px;",3,"src",4,"ngIf"],[1,"col-12","ml-1","mr-1"],[1,"map-container",2,"height","300px"],[1,"map-wrapper",2,"height","100%"],["height","100%","width","100%",3,"zoom","center","options","mapClick"],[3,"options"],[2,"color","black",3,"innerHTML"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","label","Finalizar Geocerca","icon","pi pi-pencil","class","p-button-warning mr-1 btn-sm","type","button",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times","class","p-button-info mr-1 btn-sm","type","button",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"],[2,"max-width","300px","margin-left","auto","margin-right","auto","margin-top","5px",3,"src"],["pButton","","pRipple","","label","Finalizar Geocerca","icon","pi pi-pencil","type","button",1,"p-button-warning","mr-1","btn-sm",3,"click"],["pButton","","pRipple","","icon","pi pi-times","type","button",1,"p-button-info","mr-1","btn-sm",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return o.save()}),e.TgZ(2,"div",2)(3,"label",3),e._uU(4,"Residencial"),e.qZA(),e.TgZ(5,"div",4)(6,"p-dropdown",5),e.NdJ("onChange",function(s){return o.setProyecto(s.value)}),e.qZA()()(),e.TgZ(7,"div",2)(8,"label",3),e._uU(9,"Unidad"),e.qZA(),e.TgZ(10,"div",4),e._UZ(11,"p-dropdown",6),e.qZA()(),e.TgZ(12,"div",2)(13,"label",3),e._uU(14,"Lote"),e.qZA(),e.TgZ(15,"div",4)(16,"input",7),e.NdJ("input",function(){return o.verData()}),e.qZA()()(),e.TgZ(17,"div",2)(18,"label",3),e._uU(19,"Codigo"),e.qZA(),e.TgZ(20,"div",4),e._UZ(21,"input",8),e.qZA()(),e.TgZ(22,"div",2)(23,"label",3),e._uU(24,"Medida total"),e.qZA(),e.TgZ(25,"div",9)(26,"input",10),e.NdJ("input",function(){return o.calculaPrecio()}),e.qZA()(),e.TgZ(27,"label",3),e._uU(28,"Largo"),e.qZA(),e.TgZ(29,"div",9),e._UZ(30,"input",11),e.qZA(),e.TgZ(31,"label",3),e._uU(32,"Ancho"),e.qZA(),e.TgZ(33,"div",9),e._UZ(34,"input",12),e.qZA()(),e.TgZ(35,"div",2)(36,"label",3),e._uU(37,"Precio por unidad"),e.qZA(),e.TgZ(38,"div",4)(39,"input",13),e.NdJ("input",function(){return o.calculaPrecio()}),e.qZA()()(),e.TgZ(40,"div",2)(41,"label",3),e._uU(42,"Precio"),e.qZA(),e.TgZ(43,"div",4),e._UZ(44,"input",14),e.qZA()(),e.TgZ(45,"p-fileUpload",15,16),e.NdJ("onSelect",function(s){return o.onSelect(s)})("onRemove",function(s){return o.onRemove(s)})("onClear",function(s){return o.onRemove(s)}),e.YNc(47,M,1,0,"ng-template",17),e.YNc(48,P,1,0,"ng-template",18),e.qZA(),e.YNc(49,R,1,1,"img",19),e.TgZ(50,"div",20)(51,"div",21)(52,"div",22)(53,"google-map",23),e.NdJ("mapClick",function(s){return o.onMapClick(s)}),e.TgZ(54,"map-info-window",24),e._UZ(55,"p",25),e.qZA()()()()(),e._UZ(56,"hr"),e.TgZ(57,"div",2)(58,"div",26)(59,"span",27),e.YNc(60,E,1,0,"button",28),e.YNc(61,O,1,0,"button",29),e._UZ(62,"button",30),e.TgZ(63,"button",31),e.NdJ("click",function(){return o.limpiarForm()}),e.qZA()()()()()()),2&t&&(e.xp6(1),e.Q6J("formGroup",o.createForm),e.xp6(5),e.Q6J("options",o.residenciales)("filter",!0)("virtualScroll",o.residenciales.length>5)("virtualScrollItemSize",38),e.xp6(5),e.Q6J("options",o.unimeds)("filter",!0)("virtualScroll",o.unimeds.length>5)("virtualScrollItemSize",38),e.xp6(34),e.Q6J("multiple",!0)("showUploadButton",!1)("maxFileSize",1e6)("fileLimit",1)("customUpload",!0),e.xp6(4),e.Q6J("ngIf",o.img&&""!==o.img),e.xp6(4),e.Q6J("zoom",17)("center",o.center)("options",o.options),e.xp6(1),e.Q6J("options",e.VKq(25,B,o.infoWindowPosition)),e.xp6(1),e.Q6J("innerHTML",o.infoContent,e.oJD),e.xp6(5),e.Q6J("ngIf",o.geocercaCoordinates.length>0),e.xp6(1),e.Q6J("ngIf",o.geocercaCoordinates.length>0),e.xp6(1),e.Q6J("disabled",!o.createForm.valid)("loading",o.guardando)("label",o.Lote&&o.Lote.lote_nid?"Editar":"Guardar"))},dependencies:[_.O5,p._Y,p.Fj,p.wV,p.JJ,p.JL,p.Q7,p.qQ,p.Fd,p.sg,p.u,g.jx,L.p,x.Hq,D.H,S.o,U.Lt,u.b6,u.ch]})),n})();function Q(n,a){1&n&&(e.TgZ(0,"div",22)(1,"h3",23),e._uU(2,"Listado de Lotes"),e.qZA()())}function V(n,a){if(1&n){const t=e.EpF();e._UZ(0,"p-fileUpload",24),e.TgZ(1,"button",25),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(8);return e.KtG(i.exportCSV())}),e.qZA()}2&n&&e.Q6J("maxFileSize",1e6)}const G=function(){return{float:"right"}};function Y(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",26)(1,"span",27)(2,"input",28),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw(),d=e.MAs(8);return e.KtG(s.onGlobalFilter(d,i))}),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.getData())}),e.qZA(),e.TgZ(4,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openNew())}),e.qZA(),e.TgZ(5,"p-selectButton",31),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.dataValue=i)})("click",function(){e.CHM(t);const i=e.oxw();return i.getData(),e.KtG(i.clearDataSelected())}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("options",t.dataOptions)("ngModel",t.dataValue)("ngStyle",e.DdM(3,G))}}function K(n,a){if(1&n&&(e.TgZ(0,"th",34),e._uU(1),e._UZ(2,"p-sortIcon",35),e.qZA()),2&n){const t=a.$implicit;e.ekj("rowStyle","ID"!==t.header)("rowStyleId","ID"===t.header),e.Q6J("pSortableColumn",t.field),e.xp6(1),e.hij(" ",t.header," "),e.xp6(1),e.Q6J("field",t.field)}}function $(n,a){if(1&n&&(e.TgZ(0,"tr")(1,"th",32),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Acciones"),e.qZA(),e.YNc(5,K,3,7,"th",33),e.qZA()),2&n){const t=e.oxw();e.xp6(5),e.Q6J("ngForOf",t.cols)}}function z(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",42),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.editRow(i))}),e.qZA()}}function j(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.deleteRow(i))}),e.qZA()}}function W(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",44),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.restartRow(i))}),e.qZA()}}function X(n,a){if(1&n&&(e.TgZ(0,"td")(1,"span",45),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&n){const t=a.$implicit,o=e.oxw().$implicit;e.xp6(2),e.Oqu(t.header),e.xp6(1),e.hij(" ",o[t.field]," ")}}function ee(n,a){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"p-tableCheckbox",36),e.qZA(),e.TgZ(3,"td")(4,"div",37),e.YNc(5,z,1,0,"button",38),e.YNc(6,j,1,0,"button",39),e.YNc(7,W,1,0,"button",40),e.qZA()(),e.YNc(8,X,4,2,"td",41),e.qZA()),2&n){const t=a.$implicit,o=e.oxw();e.xp6(2),e.Q6J("value",t),e.xp6(3),e.Q6J("ngIf",t.lote_nsts>0),e.xp6(1),e.Q6J("ngIf",t.lote_nsts>0),e.xp6(1),e.Q6J("ngIf",t.lote_nsts<1),e.xp6(1),e.Q6J("ngForOf",o.cols)}}function te(n,a){if(1&n&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres eliminar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Oqu(t.item.lote_vnombre)}}function oe(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",47),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirmDelete())}),e.qZA()}}function ie(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",47),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirmDeleteSelected())}),e.qZA()}}function ne(n,a){if(1&n&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres restaurar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Oqu(t.item.lote_vnombre)}}function se(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.restartItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",48),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirmRestart())}),e.qZA()}}function le(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.restartItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",48),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirmRestartSelected())}),e.qZA()}}const ae=function(){return[10,20,30]},w=function(){return{width:"950px"}},h=function(){return{width:"450px"}},re=[{path:"",component:(()=>{class n{constructor(t,o,i,s){(0,l.Z)(this,"dbapi",void 0),(0,l.Z)(this,"messageService",void 0),(0,l.Z)(this,"authS",void 0),(0,l.Z)(this,"skNsCore",void 0),(0,l.Z)(this,"createDialog",!1),(0,l.Z)(this,"editDialog",!1),(0,l.Z)(this,"deleteItemDialog",!1),(0,l.Z)(this,"deleteItemsDialog",!1),(0,l.Z)(this,"restartItemDialog",!1),(0,l.Z)(this,"restartItemsDialog",!1),(0,l.Z)(this,"isLoadingTable",!1),(0,l.Z)(this,"data",[]),(0,l.Z)(this,"item",{}),(0,l.Z)(this,"selectedData",[]),(0,l.Z)(this,"submitted",!1),(0,l.Z)(this,"cols",[]),(0,l.Z)(this,"statuses",[]),(0,l.Z)(this,"dataOptions",[]),(0,l.Z)(this,"dataValue",[1]),(0,l.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,l.Z)(this,"$destroy",new C.x),this.dbapi=t,this.messageService=o,this.authS=i,this.skNsCore=s,s.fromEvent("/proyectos/lotes").pipe((0,v.R)(this.$destroy)).subscribe(d=>{this.skNsCore.socketId!=d&&(console.log("Event socket: unidades medidas"),this.getData())}),this.cols=[{field:"lote_nid",header:"ID"},{field:"proy_vnombre",header:"Proyecto"},{field:"unimed_vdescripcion",header:"Unidad"},{field:"lote_vnombre",header:"Lote"},{field:"lote_vcodigo",header:"Codigo"},{field:"lote_fmedida",header:"Medidas"},{field:"lote_flargo",header:"Largo"},{field:"lote_fancho",header:"Ancho"},{field:"lote_fprecio_unidad",header:"Precio unidad"},{field:"lote_fprecio",header:"Precio"},{field:"lote_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}],this.getData()}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,Z.U)(t=>(t.forEach(o=>{o.proy_vnombre=o._tproyectos?o._tproyectos.proy_vnombre:"",o.unimed_vdescripcion=o._tunidades_medidas?o._tunidades_medidas.unimed_vdescripcion:"",o.lote_vsts=1==o.lote_nsts?"ACTIVO":"ELIMINADO"}),t)),(0,c.q)(1)).subscribe({next:t=>{this.data=[...t],console.log("data",this.data),this.isLoadingTable=!1},error:t=>{console.log(t),this.isLoadingTable=!1,this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}restartSelectedItems(){this.restartItemsDialog=!0}editRow(t){this.item={...t},this.editDialog=!0}deleteRow(t){this.deleteItemDialog=!0,this.item={...t}}restartRow(t){this.restartItemDialog=!0,this.item={...t}}confirmDeleteSelected(){const t=[];this.selectedData.forEach(o=>{t.push({lote_nid:o.lote_nid,lote_nsts:0})}),this.dbapi.setBulkSts(t).pipe((0,c.q)(1)).subscribe({next:o=>{this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),"success"==o.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmDelete(){this.dbapi.setSts({lote_nid:this.item.lote_nid,lote_nsts:0}).pipe((0,c.q)(1)).subscribe({next:o=>{this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.messageService.add({severity:o.type,summary:o.title,detail:o.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:o=>{console.log(o),this.editEvent({type:"error",title:"Ha ocurrido un error",message:o})}})}confirmRestart(){this.item.lote_nsts=1,this.dbapi.setSts(this.item).pipe((0,c.q)(1)).subscribe({next:t=>{this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmRestartSelected(){this.selectedData.forEach(t=>{t.lote_nsts=1}),this.item.lote_nsts=1,this.dbapi.setBulkSts(this.selectedData).pipe((0,c.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}findIndexById(t){let o=-1;for(let i=0;i<this.data.length;i++)if(this.data[i].lote_nid===t){o=i;break}return o}onGlobalFilter(t,o){t.filterGlobal(o.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}editEvent(t){this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}clearDataSelected(){this.selectedData=[]}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,l.Z)(n,"\u0275fac",function(t){return new(t||n)(e.Y36(y.l),e.Y36(g.ez),e.Y36(T.e),e.Y36(A.pP))}),(0,l.Z)(n,"\u0275cmp",e.Xpm({type:n,selectors:[["ng-component"]],features:[e._Bn([g.ez])],decls:38,vars:45,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","unimed_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear lote",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar lote",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"Lote","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1",3,"click"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],[2,"width","3rem"],["style","width: 100rem",3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[2,"width","100rem",3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"p-toast",3),e.TgZ(4,"p-toolbar",4),e.YNc(5,Q,3,0,"ng-template",5),e.YNc(6,V,2,1,"ng-template",6),e.qZA(),e.TgZ(7,"p-table",7,8),e.NdJ("selectionChange",function(s){return o.selectedData=s}),e.YNc(9,Y,6,4,"ng-template",9),e.YNc(10,$,6,1,"ng-template",10),e.YNc(11,ee,9,5,"ng-template",11),e.qZA()(),e.TgZ(12,"p-dialog",12),e.NdJ("visibleChange",function(s){return o.createDialog=s}),e.TgZ(13,"app-create-lotes",13),e.NdJ("edit",function(s){return o.editEvent(s)}),e.qZA()(),e.TgZ(14,"p-dialog",14),e.NdJ("visibleChange",function(s){return o.editDialog=s}),e.TgZ(15,"app-create-lotes",15),e.NdJ("edit",function(s){return o.editEvent(s)}),e.qZA()(),e.TgZ(16,"p-dialog",16),e.NdJ("visibleChange",function(s){return o.deleteItemDialog=s}),e.TgZ(17,"div",17),e._UZ(18,"i",18),e.YNc(19,te,5,1,"span",19),e.qZA(),e.YNc(20,oe,2,0,"ng-template",20),e.qZA(),e.TgZ(21,"p-dialog",21),e.NdJ("visibleChange",function(s){return o.deleteItemsDialog=s}),e.TgZ(22,"div",17),e._UZ(23,"i",18),e.TgZ(24,"span"),e._uU(25,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),e.qZA()(),e.YNc(26,ie,2,0,"ng-template",20),e.qZA(),e.TgZ(27,"p-dialog",16),e.NdJ("visibleChange",function(s){return o.restartItemDialog=s}),e.TgZ(28,"div",17),e._UZ(29,"i",18),e.YNc(30,ne,5,1,"span",19),e.qZA(),e.YNc(31,se,2,0,"ng-template",20),e.qZA(),e.TgZ(32,"p-dialog",21),e.NdJ("visibleChange",function(s){return o.restartItemsDialog=s}),e.TgZ(33,"div",17),e._UZ(34,"i",18),e.TgZ(35,"span"),e._uU(36,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),e.qZA()(),e.YNc(37,le,2,0,"ng-template",20),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("value",o.data)("columns",o.cols)("rows",10)("globalFilterFields",o.cols)("rows",10)("paginator",!0)("loading",o.isLoadingTable)("rowsPerPageOptions",e.DdM(38,ae))("showCurrentPageReport",!0)("selection",o.selectedData)("rowHover",!0),e.xp6(5),e.Akn(e.DdM(39,w)),e.Q6J("visible",o.createDialog)("modal",!0),e.xp6(2),e.Akn(e.DdM(40,w)),e.Q6J("visible",o.editDialog)("modal",!0),e.xp6(1),e.Q6J("Lote",o.item),e.xp6(1),e.Akn(e.DdM(41,h)),e.Q6J("visible",o.deleteItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",o.item),e.xp6(2),e.Akn(e.DdM(42,h)),e.Q6J("visible",o.deleteItemsDialog)("modal",!0),e.xp6(6),e.Akn(e.DdM(43,h)),e.Q6J("visible",o.restartItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",o.item),e.xp6(2),e.Akn(e.DdM(44,h)),e.Q6J("visible",o.restartItemsDialog)("modal",!0))},dependencies:[_.sg,_.O5,_.PC,p.JJ,p.On,m.iA,g.jx,m.lQ,m.fz,m.UA,m.Mo,L.p,x.Hq,N.UN,D.H,q.FN,J.o,S.o,F.V,H]})),n})()}];let pe=(()=>{class n{}return(0,l.Z)(n,"\u0275fac",function(t){return new(t||n)}),(0,l.Z)(n,"\u0275mod",e.oAB({type:n})),(0,l.Z)(n,"\u0275inj",e.cJS({imports:[k.m,u.Y4,I.Bz.forChild(re)]})),n})()}}]);