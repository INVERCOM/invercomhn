"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[4641],{4641:(_e,A,a)=>{a.r(A),a.d(A,{SucursalesModule:()=>me});var o=a(1180),w=a(7246),T=a(1380),m=a(805),y=a(7579),h=a(2722),k=a(4004),c=a(5698),e=a(4650),U=a(2340),I=a(529),f=a(629);let v=(()=>{class n{constructor(i,t,s){(0,o.Z)(this,"http",void 0),(0,o.Z)(this,"authS",void 0),(0,o.Z)(this,"router",void 0),(0,o.Z)(this,"_prefix",U.H+"/api/sucursales"),this.http=i,this.authS=t,this.router=s}getAll(i=[1]){return this.authS.refreshToken(),this.http.post(this._prefix+"/getall",{cia_nids:this.authS.isValidCia(!1),sucu_nsts:i})}save(i){const t={...i,...this.authS.getUsuarioLog()};return this.http.post(this._prefix+"/save",t)}setSts(i){return this.http.post(this._prefix+"/setsts/"+i.sucu_nid,{sucu_nsts:i.sucu_nsts,...this.authS.getUsuarioLog()})}setBulkSts(i){return this.http.post(this._prefix+"/setbullksts",{data:i,...this.authS.getUsuarioLog()})}getCompanias(){const i={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getallcompanias",i)}getAsigSucursalUsuario(i){return this.http.post(this._prefix+"/asigsucursalusuarios/getall/"+i,{})}saveAsigSucursalUsuario(i,t){const s={asig:t,...this.authS.getUsuarioLog()};return this.http.post(this._prefix+"/asigsucursalusuarios/save/"+i,s)}getUsuarios(){const i={cia_nids:this.authS.isValidCia(!1),user_nsts:[1,2]};return this.http.post(this._prefix+"/getallusuariosbycia",i)}}return(0,o.Z)(n,"\u0275fac",function(i){return new(i||n)(e.LFG(I.eN),e.LFG(f.e),e.LFG(T.F0))}),(0,o.Z)(n,"\u0275prov",e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})),n})();var D=a(1168),_=a(6895),r=a(4006),d=a(99),N=a(3388),b=a(5593),x=a(5362),Z=a(1795),J=a(2453),q=a(1383),C=a(1740),F=a(1493),M=a(2210);let E=(()=>{class n{constructor(i,t,s,u){(0,o.Z)(this,"dbapi",void 0),(0,o.Z)(this,"_builder",void 0),(0,o.Z)(this,"authS",void 0),(0,o.Z)(this,"skNsCore",void 0),(0,o.Z)(this,"createForm",void 0),(0,o.Z)(this,"companias",[]),(0,o.Z)(this,"guardando",!1),(0,o.Z)(this,"itemDialog",!1),(0,o.Z)(this,"submitted",!1),(0,o.Z)(this,"$destroy",new y.x),(0,o.Z)(this,"sucursal",{}),(0,o.Z)(this,"edit",new e.vpe),this.dbapi=i,this._builder=t,this.authS=s,this.skNsCore=u,this.createForm=t.group({sucu_nid:[0],cia_nid:["",r.kI.required],sucu_vcodigo:["",r.kI.required],sucu_vnombre:["",r.kI.required],sucu_vdireccion:["",r.kI.required],sucu_vtelefono:[""],sucu_vcorreo:["",r.kI.email],sucu_nsts:[""]}),s.\u00f8bserverCompanySelected.pipe((0,h.R)(this.$destroy)).subscribe(p=>{this.getCompanias()})}ngOnInit(){}ngOnChanges(){this.sucursal&&this.sucursal?.sucu_nid&&this.sucursal?.sucu_nid>0&&(this.sucu_nid?.setValue(this.sucursal?.sucu_nid),this.cia_nid?.setValue(this.searchById(this.sucursal?.cia_nid,this.companias)),this.sucu_vcodigo?.setValue(this.sucursal?.sucu_vcodigo),this.sucu_vnombre?.setValue(this.sucursal?.sucu_vnombre),this.sucu_vdireccion?.setValue(this.sucursal?.sucu_vdireccion),this.sucu_vtelefono?.setValue(this.sucursal?.sucu_vtelefono),this.sucu_vcorreo?.setValue(this.sucursal?.sucu_vcorreo),this.sucu_nsts?.setValue(this.sucursal?.sucu_nsts))}getCompanias(){this.companias=[],this.cia_nid?.setValue(""),this.dbapi.getCompanias().pipe((0,c.q)(1)).subscribe({next:i=>{if(i&&null!=i&&""!==i){for(const t in i)this.companias=[...this.companias,{id:i[t].cia_nid,text:i[t].cia_vnombre,obj:i[t]}];1==this.companias.length&&this.cia_nid?.setValue(this.companias[0])}else console.log("Error consultando compa\xf1\xedas")},error:i=>{console.log(i),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}save(){if(this.createForm.valid&&!this.guardando){this.guardando=!0;const i={sucu_nid:this.sucu_nid?.value>0?this.sucu_nid?.value:null,cia_nid:this.cia_nid?.value.id,sucu_vcodigo:this.sucu_vcodigo?.value.toString().trim().toUpperCase(),sucu_vnombre:this.sucu_vnombre?.value.trim().toUpperCase(),sucu_vdireccion:this.sucu_vdireccion?.value.trim().toUpperCase(),sucu_vtelefono:this.sucu_vtelefono?.value.toString().trim(),sucu_vcorreo:this.sucu_vcorreo?.value.trim().toLowerCase(),sucu_nsts:1};this.dbapi.save(i).pipe((0,c.q)(1)).subscribe({next:t=>{"success"==t.type&&(this.skNsCore.notificarUpsert("/admin/sucursales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.limpiarForm()),this.guardando=!1,this.edit.emit(t)},error:t=>{console.log(t),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}})}}limpiarForm(){this.createForm.reset(),this.sucu_nid?.setValue(0)}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(i,t){for(let s=0;s<t.length;s++){const u=t[s];if(u.id==i)return u}return""}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get sucu_nid(){return this.createForm.get("sucu_nid")}get cia_nid(){return this.createForm.get("cia_nid")}get sucu_vcodigo(){return this.createForm.get("sucu_vcodigo")}get sucu_vnombre(){return this.createForm.get("sucu_vnombre")}get sucu_vdireccion(){return this.createForm.get("sucu_vdireccion")}get sucu_vtelefono(){return this.createForm.get("sucu_vtelefono")}get sucu_vcorreo(){return this.createForm.get("sucu_vcorreo")}get sucu_nsts(){return this.createForm.get("sucu_nsts")}}return(0,o.Z)(n,"\u0275fac",function(i){return new(i||n)(e.Y36(v),e.Y36(r.qu),e.Y36(f.e),e.Y36(D.pP))}),(0,o.Z)(n,"\u0275cmp",e.Xpm({type:n,selectors:[["app-create-sucursales"]],inputs:{sucursal:"sucursal"},outputs:{edit:"edit"},features:[e.TTD],decls:40,vars:44,consts:[[1,"row"],[1,"col-12"],[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["optionLabel","text","formControlName","cia_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","sucu_vcodigo","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","sucu_vnombre","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","sucu_vdireccion","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","sucu_vtelefono","type","number"],["pInputText","","formControlName","sucu_vcorreo","type","email",2,"text-transform","lowercase"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),e.NdJ("ngSubmit",function(){return t.save()}),e.TgZ(4,"div",4)(5,"label",5),e._uU(6,"Compa\xf1\xeda"),e.qZA(),e.TgZ(7,"div",6),e._UZ(8,"p-dropdown",7),e.qZA()(),e.TgZ(9,"div",4)(10,"label",5),e._uU(11,"C\xf3digo"),e.qZA(),e.TgZ(12,"div",6),e._UZ(13,"input",8),e.qZA()(),e.TgZ(14,"div",4)(15,"label",5),e._uU(16,"Nombre"),e.qZA(),e.TgZ(17,"div",6),e._UZ(18,"input",9),e.qZA()(),e.TgZ(19,"div",4)(20,"label",5),e._uU(21,"Direcci\xf3n"),e.qZA(),e.TgZ(22,"div",6),e._UZ(23,"input",10),e.qZA()(),e.TgZ(24,"div",4)(25,"label",5),e._uU(26,"Tel\xe9fono"),e.qZA(),e.TgZ(27,"div",6),e._UZ(28,"input",11),e.qZA()(),e.TgZ(29,"div",4)(30,"label",5),e._uU(31,"Correo electr\xf3nico"),e.qZA(),e.TgZ(32,"div",6),e._UZ(33,"input",12),e.qZA()(),e._UZ(34,"hr"),e.TgZ(35,"div",4)(36,"div",13)(37,"span",14),e._UZ(38,"button",15),e.TgZ(39,"button",16),e.NdJ("click",function(){return t.limpiarForm()}),e.qZA()()()()()()()()),2&i&&(e.xp6(3),e.Q6J("formGroup",t.createForm),e.xp6(5),e.ekj("ng-invalid",(null==t.cia_nid?null:t.cia_nid.invalid)&&(null==t.cia_nid?null:t.cia_nid.touched))("ng-dirty",(null==t.cia_nid?null:t.cia_nid.invalid)&&(null==t.cia_nid?null:t.cia_nid.touched))("ng-valid",(null==t.cia_nid?null:t.cia_nid.valid)&&((null==t.cia_nid?null:t.cia_nid.touched)||(null==t.cia_nid?null:t.cia_nid.dirty))),e.Q6J("options",t.companias)("filter",!0)("virtualScroll",t.companias.length>5)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==t.sucu_vcodigo?null:t.sucu_vcodigo.invalid)&&(null==t.sucu_vcodigo?null:t.sucu_vcodigo.touched))("ng-dirty",(null==t.sucu_vcodigo?null:t.sucu_vcodigo.invalid)&&(null==t.sucu_vcodigo?null:t.sucu_vcodigo.touched))("ng-valid",(null==t.sucu_vcodigo?null:t.sucu_vcodigo.valid)&&((null==t.sucu_vcodigo?null:t.sucu_vcodigo.touched)||(null==t.sucu_vcodigo?null:t.sucu_vcodigo.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.sucu_vnombre?null:t.sucu_vnombre.invalid)&&(null==t.sucu_vnombre?null:t.sucu_vnombre.touched))("ng-dirty",(null==t.sucu_vnombre?null:t.sucu_vnombre.invalid)&&(null==t.sucu_vnombre?null:t.sucu_vnombre.touched))("ng-valid",(null==t.sucu_vnombre?null:t.sucu_vnombre.valid)&&((null==t.sucu_vnombre?null:t.sucu_vnombre.touched)||(null==t.sucu_vnombre?null:t.sucu_vnombre.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.sucu_vdireccion?null:t.sucu_vdireccion.invalid)&&(null==t.sucu_vdireccion?null:t.sucu_vdireccion.touched))("ng-dirty",(null==t.sucu_vdireccion?null:t.sucu_vdireccion.invalid)&&(null==t.sucu_vdireccion?null:t.sucu_vdireccion.touched))("ng-valid",(null==t.sucu_vdireccion?null:t.sucu_vdireccion.valid)&&((null==t.sucu_vdireccion?null:t.sucu_vdireccion.touched)||(null==t.sucu_vdireccion?null:t.sucu_vdireccion.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.sucu_vtelefono?null:t.sucu_vtelefono.invalid)&&(null==t.sucu_vtelefono?null:t.sucu_vtelefono.touched))("ng-dirty",(null==t.sucu_vtelefono?null:t.sucu_vtelefono.invalid)&&(null==t.sucu_vtelefono?null:t.sucu_vtelefono.touched))("ng-valid",(null==t.sucu_vtelefono?null:t.sucu_vtelefono.valid)&&((null==t.sucu_vtelefono?null:t.sucu_vtelefono.touched)||(null==t.sucu_vtelefono?null:t.sucu_vtelefono.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.sucu_vcorreo?null:t.sucu_vcorreo.invalid)&&(null==t.sucu_vcorreo?null:t.sucu_vcorreo.touched))("ng-dirty",(null==t.sucu_vcorreo?null:t.sucu_vcorreo.invalid)&&(null==t.sucu_vcorreo?null:t.sucu_vcorreo.touched))("ng-valid",(null==t.sucu_vcorreo?null:t.sucu_vcorreo.valid)&&((null==t.sucu_vcorreo?null:t.sucu_vcorreo.touched)||(null==t.sucu_vcorreo?null:t.sucu_vcorreo.dirty))),e.xp6(5),e.Q6J("disabled",!t.createForm.valid)("loading",t.guardando)("label",t.sucursal&&t.sucursal.sucu_nid?"Editar":"Guardar"))},dependencies:[r._Y,r.Fj,r.wV,r.JJ,r.JL,r.Q7,r.sg,r.u,b.Hq,Z.H,C.o,M.Lt],styles:[".ng-valid[_ngcontent-%COMP%]{border-color:#2ecc71!important}"]})),n})();function R(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"div",12)(1,"span",13)(2,"input",14),e.NdJ("input",function(s){e.CHM(i);const u=e.oxw(),p=e.MAs(4);return e.KtG(u.onGlobalFilter(p,s))}),e.qZA(),e.TgZ(3,"button",15),e.NdJ("click",function(s){e.CHM(i);const u=e.oxw();return e.KtG(u.cambiarBtn(s,1))}),e.qZA(),e.TgZ(4,"button",16),e.NdJ("click",function(s){e.CHM(i);const u=e.oxw();return e.KtG(u.cambiarBtn(s,0))}),e.qZA(),e.TgZ(5,"button",17),e.NdJ("click",function(s){e.CHM(i);const u=e.oxw();return e.KtG(u.cambiarBtn(s,-1))}),e.qZA(),e.TgZ(6,"button",18),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.getUsuarios())}),e.qZA()()()}}function H(n,l){if(1&n&&(e.TgZ(0,"th",22),e._uU(1),e._UZ(2,"p-sortIcon",20),e.qZA()),2&n){const i=l.$implicit;e.ekj("rowStyle","ID"!==i.header)("rowStyleId","ID"===i.header),e.Q6J("pSortableColumn",i.field),e.xp6(1),e.hij(" ",i.header," "),e.xp6(1),e.Q6J("field",i.field)}}function B(n,l){if(1&n&&(e.TgZ(0,"tr")(1,"th",19),e._uU(2," CHK "),e._UZ(3,"p-sortIcon",20),e.qZA(),e.YNc(4,H,3,7,"th",21),e.qZA()),2&n){const i=e.oxw();e.xp6(3),e.Q6J("field","checked"),e.xp6(1),e.Q6J("ngForOf",i.cols)}}function O(n,l){if(1&n&&(e.TgZ(0,"td")(1,"span",27),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&n){const i=l.$implicit,t=e.oxw().$implicit;e.xp6(2),e.Oqu(i.header),e.xp6(1),e.hij(" ",t[i.field]," ")}}function Q(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"div",23)(3,"label")(4,"input",24),e.NdJ("ngModelChange",function(s){const p=e.CHM(i).$implicit;return e.KtG(p.checked=s)}),e.qZA(),e._UZ(5,"span",25),e.qZA()()(),e.YNc(6,O,4,2,"td",26),e.qZA()}if(2&n){const i=l.$implicit,t=e.oxw();e.xp6(4),e.Q6J("ngModel",i.checked),e.xp6(2),e.Q6J("ngForOf",t.cols)}}const G=function(){return[10,20,30]};let V=(()=>{class n{constructor(i){(0,o.Z)(this,"dbapi",void 0),(0,o.Z)(this,"guardando",!1),(0,o.Z)(this,"isLoadingTable",!1),(0,o.Z)(this,"selectedData",[]),(0,o.Z)(this,"data",[]),(0,o.Z)(this,"cols",[]),(0,o.Z)(this,"sucursal",{}),(0,o.Z)(this,"edit",new e.vpe),this.dbapi=i,this.cols=[{field:"user_nid",header:"ID"},{field:"user_vmail",header:"Correo"},{field:"user_vtelefono",header:"Tel\xe9fono"},{field:"user_vsts",header:"Estado"}],this.getUsuarios()}getUsuarios(){this.isLoadingTable=!0,this.dbapi.getUsuarios().pipe((0,k.U)(i=>(i.forEach(t=>{t.checked=!1,t["x.usecia_npricipal"]=!1,t.user_vsts=1==t.user_nsts?"ACTIVO":2==t.user_nsts?"PENDIENTE":"ELIMINADO"}),i)),(0,c.q)(1)).subscribe({next:i=>{this.data=[...i],this.getAsigSucursalUsuario(),this.isLoadingTable=!1},error:i=>{console.log(i),this.isLoadingTable=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}ngOnInit(){}findIndexById(i){let t=-1;for(let s=0;s<this.data.length;s++)if(this.data[s].user_nid===i){t=s;break}return t}onGlobalFilter(i,t){i.filterGlobal(t.target.value,"contains")}cambiarBtn(i,t){i&&i.preventDefault(),t=1*t||0,this.data.forEach(s=>{s.checked=-1==t?!s.checked:1==t})}ngOnChanges(){this.getAsigSucursalUsuario()}getAsigSucursalUsuario(){this.sucursal&&this.sucursal?.sucu_nid&&this.sucursal?.sucu_nid>0&&(this.data.forEach(i=>{i.checked=!1}),this.dbapi.getAsigSucursalUsuario(this.sucursal.sucu_nid).pipe((0,c.q)(1)).subscribe({next:i=>{this.data.forEach(t=>{i.forEach(s=>{t.user_nid===s.user_nid&&(t.checked=!0)})})},error:i=>{console.log(i),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}}))}saveAsignacion(){const i=[],t=this.sucursal.sucu_nid?this.sucursal.sucu_nid:0;this.data.forEach(s=>{s.checked&&i.push({sucu_nid:t,user_nid:s.user_nid})}),this.dbapi.saveAsigSucursalUsuario(t,i).pipe((0,c.q)(1)).subscribe({next:s=>{this.edit.emit(s)},error:s=>{console.log(s),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:s})}})}}return(0,o.Z)(n,"\u0275fac",function(i){return new(i||n)(e.Y36(v))}),(0,o.Z)(n,"\u0275cmp",e.Xpm({type:n,selectors:[["app-asig-usuarios-sucursales"]],inputs:{sucursal:"sucursal"},outputs:{edit:"edit"},features:[e.TTD],decls:13,vars:14,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","user_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"field","grid"],[1,"col-3"],[1,"p-buttonset"],["pButton","","pRipple","","icon","pi pi-save","type","button",1,"p-button-success","mr-1","btn-sm",3,"loading","label","click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1",3,"input"],["pButton","","pRipple","","title","Todos","icon","pi pi-check",1,"p-button-primary","ml-1",3,"click"],["pButton","","pRipple","","title","Ninguno","icon","pi pi-times",1,"p-button-primary",3,"click"],["pButton","","pRipple","","title","Invertir","icon","pi pi-circle",1,"p-button-primary",3,"click"],["pButton","","pRipple","","title","Recargar","icon","pi pi-sync",1,"p-button-secondary","ml-1",3,"click"],[2,"width","3rem"],[3,"field"],["style","width: 100rem",3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[2,"width","100rem",3,"pSortableColumn"],[1,"checkbox","c-checkbox"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"fa","fa-check"],[4,"ngFor","ngForOf"],[1,"p-column-title"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-table",3,4),e.NdJ("selectionChange",function(u){return t.selectedData=u}),e.YNc(5,R,7,0,"ng-template",5),e.YNc(6,B,5,2,"ng-template",6),e.YNc(7,Q,7,2,"ng-template",7),e.qZA(),e._UZ(8,"hr"),e.TgZ(9,"div",8)(10,"div",9)(11,"span",10)(12,"button",11),e.NdJ("click",function(){return t.saveAsignacion()}),e.qZA()()()()()()()),2&i&&(e.xp6(3),e.Q6J("value",t.data)("columns",t.cols)("rows",10)("globalFilterFields",t.cols)("rows",10)("paginator",!0)("loading",t.isLoadingTable)("rowsPerPageOptions",e.DdM(13,G))("showCurrentPageReport",!0)("selection",t.selectedData)("rowHover",!0),e.xp6(9),e.Q6J("loading",t.guardando)("label","Guardar"))},dependencies:[_.sg,r.Wl,r.JJ,r.On,d.iA,m.jx,d.lQ,d.fz,b.Hq,Z.H,C.o],styles:[".rowStyle[_ngcontent-%COMP%]{width:14%;min-width:10rem}.rowStyleId[_ngcontent-%COMP%]{width:10%;min-width:6rem}"]})),n})();function Y(n,l){1&n&&(e.TgZ(0,"div",23)(1,"h3",24),e._uU(2,"Listado de sucursales"),e.qZA()())}function K(n,l){if(1&n){const i=e.EpF();e._UZ(0,"p-fileUpload",25),e.TgZ(1,"button",26),e.NdJ("click",function(){e.CHM(i),e.oxw();const s=e.MAs(8);return e.KtG(s.exportCSV())}),e.qZA()}2&n&&e.Q6J("maxFileSize",1e6)}function L(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",35),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.deleteSelectedItems())}),e.qZA()}if(2&n){const i=e.oxw(2);e.Q6J("disabled",!i.selectedData||!i.selectedData.length)}}function P(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.restartSelectedItems())}),e.qZA()}if(2&n){const i=e.oxw(2);e.Q6J("disabled",!i.selectedData||!i.selectedData.length)}}const $=function(){return{float:"right"}};function j(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"div",27)(1,"span",28)(2,"input",29),e.NdJ("input",function(s){e.CHM(i);const u=e.oxw(),p=e.MAs(8);return e.KtG(u.onGlobalFilter(p,s))}),e.qZA(),e.TgZ(3,"button",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.getData())}),e.qZA(),e.TgZ(4,"button",31),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.openNew())}),e.qZA(),e.YNc(5,L,1,1,"button",32),e.YNc(6,P,1,1,"button",33),e.TgZ(7,"p-selectButton",34),e.NdJ("ngModelChange",function(s){e.CHM(i);const u=e.oxw();return e.KtG(u.dataValue=s)})("click",function(){e.CHM(i);const s=e.oxw();return s.getData(),e.KtG(s.clearDataSelected())}),e.qZA()()()}if(2&n){const i=e.oxw();e.xp6(5),e.Q6J("ngIf",i.dataValue&&1===i.dataValue[0]),e.xp6(1),e.Q6J("ngIf",i.dataValue&&0===i.dataValue[0]),e.xp6(1),e.Q6J("options",i.dataOptions)("ngModel",i.dataValue)("ngStyle",e.DdM(5,$))}}function z(n,l){if(1&n&&(e.TgZ(0,"th",39),e._uU(1),e._UZ(2,"p-sortIcon",40),e.qZA()),2&n){const i=l.$implicit;e.ekj("rowStyle","ID"!==i.header)("rowStyleId","ID"===i.header),e.Q6J("pSortableColumn",i.field),e.xp6(1),e.hij(" ",i.header," "),e.xp6(1),e.Q6J("field",i.field)}}function X(n,l){if(1&n&&(e.TgZ(0,"tr")(1,"th",37),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Acciones"),e.qZA(),e.YNc(5,z,3,7,"th",38),e.qZA()),2&n){const i=e.oxw();e.xp6(5),e.Q6J("ngForOf",i.cols)}}function W(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",48),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.editRow(s))}),e.qZA()}}function ee(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",49),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.asignacionUsuarios(s))}),e.qZA()}}function te(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.deleteRow(s))}),e.qZA()}}function ie(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",51),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().$implicit,u=e.oxw();return e.KtG(u.restartRow(s))}),e.qZA()}}function se(n,l){if(1&n&&(e.TgZ(0,"td")(1,"span",52),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&n){const i=l.$implicit,t=e.oxw().$implicit;e.xp6(2),e.Oqu(i.header),e.xp6(1),e.hij(" ",t[i.field]," ")}}function ne(n,l){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"p-tableCheckbox",41),e.qZA(),e.TgZ(3,"td")(4,"div",42),e.YNc(5,W,1,0,"button",43),e.YNc(6,ee,1,0,"button",44),e.YNc(7,te,1,0,"button",45),e.YNc(8,ie,1,0,"button",46),e.qZA()(),e.YNc(9,se,4,2,"td",47),e.qZA()),2&n){const i=l.$implicit,t=e.oxw();e.xp6(2),e.Q6J("value",i),e.xp6(3),e.Q6J("ngIf",i.sucu_nsts>0),e.xp6(1),e.Q6J("ngIf",i.sucu_nsts>0),e.xp6(1),e.Q6J("ngIf",i.sucu_nsts>0),e.xp6(1),e.Q6J("ngIf",i.sucu_nsts<1),e.xp6(1),e.Q6J("ngForOf",t.cols)}}function oe(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres eliminar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&n){const i=e.oxw();e.xp6(3),e.Oqu(i.item.sucu_vnombre)}}function ue(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.deleteItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",54),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.confirmDelete())}),e.qZA()}}function le(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.deleteItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",54),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.confirmDeleteSelected())}),e.qZA()}}function ae(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres restaurar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&n){const i=e.oxw();e.xp6(3),e.Oqu(i.item.sucu_vnombre)}}function re(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.restartItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",55),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.confirmRestart())}),e.qZA()}}function ce(n,l){if(1&n){const i=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.restartItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",55),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.confirmRestartSelected())}),e.qZA()}}const pe=function(){return[10,20,30]},S=function(){return{width:"750px"}},g=function(){return{width:"450px"}},de=[{path:"",component:(()=>{class n{constructor(i,t,s,u){(0,o.Z)(this,"dbapi",void 0),(0,o.Z)(this,"messageService",void 0),(0,o.Z)(this,"authS",void 0),(0,o.Z)(this,"skNsCore",void 0),(0,o.Z)(this,"createDialog",!1),(0,o.Z)(this,"editDialog",!1),(0,o.Z)(this,"asigUsuariosDialog",!1),(0,o.Z)(this,"deleteItemDialog",!1),(0,o.Z)(this,"deleteItemsDialog",!1),(0,o.Z)(this,"restartItemDialog",!1),(0,o.Z)(this,"restartItemsDialog",!1),(0,o.Z)(this,"isLoadingTable",!1),(0,o.Z)(this,"data",[]),(0,o.Z)(this,"item",{}),(0,o.Z)(this,"itemAsigUsuarios",{}),(0,o.Z)(this,"selectedData",[]),(0,o.Z)(this,"submitted",!1),(0,o.Z)(this,"cols",[]),(0,o.Z)(this,"statuses",[]),(0,o.Z)(this,"dataOptions",[]),(0,o.Z)(this,"dataValue",[1]),(0,o.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,o.Z)(this,"$destroy",new y.x),this.dbapi=i,this.messageService=t,this.authS=s,this.skNsCore=u,s.\u00f8bserverCompanySelected.pipe((0,h.R)(this.$destroy)).subscribe(p=>{this.getData()}),u.fromEvent("/admin/sucursales+"+this.authS.isValidCia(!1).toString()).pipe((0,h.R)(this.$destroy)).subscribe(p=>{this.skNsCore.socketId!=p&&(console.log("Event socket: sucursales"),this.getData())}),this.cols=[{field:"sucu_nid",header:"ID"},{field:"cia_vnombre",header:"Compa\xf1\xeda"},{field:"sucu_vcodigo",header:"C\xf3digo"},{field:"sucu_vnombre",header:"Nombre"},{field:"sucu_vdireccion",header:"Direcci\xf3n"},{field:"sucu_vtelefono",header:"Tel\xe9fono"},{field:"sucu_vcorreo",header:"Correo"},{field:"sucu_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}]}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,k.U)(i=>(i.forEach(t=>{t.cia_vnombre=t.cias?t.cias.cia_vnombre:"",t.sucu_vsts=1==t.sucu_nsts?"ACTIVO":"ELIMINADO"}),i)),(0,c.q)(1)).subscribe({next:i=>{this.data=[...i],this.isLoadingTable=!1},error:i=>{console.log(i),this.editEvent({type:"error",title:"Ha ocurrido un error",message:i})}})}ngOnInit(){}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}asignacionUsuarios(i){this.itemAsigUsuarios={...i},this.asigUsuariosDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}editRow(i){this.item={...i},this.editDialog=!0}deleteRow(i){this.deleteItemDialog=!0,this.item={...i}}restartRow(i){this.restartItemDialog=!0,this.item={...i}}confirmDeleteSelected(){const i=[];this.selectedData.forEach(t=>{i.push({sucu_nid:t.sucu_nid,sucu_nsts:0})}),this.dbapi.setBulkSts(i).pipe((0,c.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/admin/sucursales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmDelete(){this.dbapi.setSts({sucu_nid:this.item.sucu_nid,sucu_nsts:0}).pipe((0,c.q)(1)).subscribe({next:t=>{this.skNsCore.notificarUpsert("/admin/sucursales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmRestart(){this.dbapi.setSts({sucu_nid:this.item.sucu_nid,sucu_nsts:1}).pipe((0,c.q)(1)).subscribe({next:t=>{this.skNsCore.notificarUpsert("/admin/sucursales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmRestartSelected(){const i=[];this.selectedData.forEach(t=>{i.push({sucu_nid:t.sucu_nid,sucu_nsts:1})}),this.dbapi.setBulkSts(i).pipe((0,c.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/admin/sucursales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}findIndexById(i){let t=-1;for(let s=0;s<this.data.length;s++)if(this.data[s].sucu_nid===i){t=s;break}return t}onGlobalFilter(i,t){i.filterGlobal(t.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}restartSelectedItems(){this.restartItemsDialog=!0}editEvent(i){this.messageService.add({severity:i.type,summary:i.title,detail:i.message,life:3e3}),"success"==i.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1,this.asigUsuariosDialog=!1)}clearDataSelected(){this.selectedData=[]}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,o.Z)(n,"\u0275fac",function(i){return new(i||n)(e.Y36(v),e.Y36(m.ez),e.Y36(f.e),e.Y36(D.pP))}),(0,o.Z)(n,"\u0275cmp",e.Xpm({type:n,selectors:[["ng-component"]],features:[e._Bn([m.ez])],decls:40,vars:51,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","sucu_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear sucursal",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar sucursal",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"sucursal","edit"],["header","Asignar usuarios",1,"p-fluid",3,"visible","modal","visibleChange"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1","mt-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1","mt-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1","mt-1",3,"click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash","class","p-button-danger mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay","class","p-button-help mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash",1,"p-button-danger","mr-1","ml-1","mt-1",3,"disabled","click"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay",1,"p-button-help","mr-1","ml-1","mt-1",3,"disabled","click"],[2,"width","3rem"],["style","width: 100rem",3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[2,"width","100rem",3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","title","Editar","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","title","Asignar usuarios","pRipple","","icon","pi pi-users","class","p-button-info mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil","title","Editar",1,"p-button-success","mr-1",3,"click"],["pButton","","title","Asignar usuarios","pRipple","","icon","pi pi-users",1,"p-button-info","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"p-toast",3),e.TgZ(4,"p-toolbar",4),e.YNc(5,Y,3,0,"ng-template",5),e.YNc(6,K,2,1,"ng-template",6),e.qZA(),e.TgZ(7,"p-table",7,8),e.NdJ("selectionChange",function(u){return t.selectedData=u}),e.YNc(9,j,8,6,"ng-template",9),e.YNc(10,X,6,1,"ng-template",10),e.YNc(11,ne,10,6,"ng-template",11),e.qZA()(),e.TgZ(12,"p-dialog",12),e.NdJ("visibleChange",function(u){return t.createDialog=u}),e.TgZ(13,"app-create-sucursales",13),e.NdJ("edit",function(u){return t.editEvent(u)}),e.qZA()(),e.TgZ(14,"p-dialog",14),e.NdJ("visibleChange",function(u){return t.editDialog=u}),e.TgZ(15,"app-create-sucursales",15),e.NdJ("edit",function(u){return t.editEvent(u)}),e.qZA()(),e.TgZ(16,"p-dialog",16),e.NdJ("visibleChange",function(u){return t.asigUsuariosDialog=u}),e.TgZ(17,"app-asig-usuarios-sucursales",15),e.NdJ("edit",function(u){return t.editEvent(u)}),e.qZA()(),e.TgZ(18,"p-dialog",17),e.NdJ("visibleChange",function(u){return t.deleteItemDialog=u}),e.TgZ(19,"div",18),e._UZ(20,"i",19),e.YNc(21,oe,5,1,"span",20),e.qZA(),e.YNc(22,ue,2,0,"ng-template",21),e.qZA(),e.TgZ(23,"p-dialog",22),e.NdJ("visibleChange",function(u){return t.deleteItemsDialog=u}),e.TgZ(24,"div",18),e._UZ(25,"i",19),e.TgZ(26,"span"),e._uU(27,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),e.qZA()(),e.YNc(28,le,2,0,"ng-template",21),e.qZA(),e.TgZ(29,"p-dialog",17),e.NdJ("visibleChange",function(u){return t.restartItemDialog=u}),e.TgZ(30,"div",18),e._UZ(31,"i",19),e.YNc(32,ae,5,1,"span",20),e.qZA(),e.YNc(33,re,2,0,"ng-template",21),e.qZA(),e.TgZ(34,"p-dialog",22),e.NdJ("visibleChange",function(u){return t.restartItemsDialog=u}),e.TgZ(35,"div",18),e._UZ(36,"i",19),e.TgZ(37,"span"),e._uU(38,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),e.qZA()(),e.YNc(39,ce,2,0,"ng-template",21),e.qZA()()()),2&i&&(e.xp6(7),e.Q6J("value",t.data)("columns",t.cols)("rows",10)("globalFilterFields",t.cols)("rows",10)("paginator",!0)("loading",t.isLoadingTable)("rowsPerPageOptions",e.DdM(43,pe))("showCurrentPageReport",!0)("selection",t.selectedData)("rowHover",!0),e.xp6(5),e.Akn(e.DdM(44,S)),e.Q6J("visible",t.createDialog)("modal",!0),e.xp6(2),e.Akn(e.DdM(45,S)),e.Q6J("visible",t.editDialog)("modal",!0),e.xp6(1),e.Q6J("sucursal",t.item),e.xp6(1),e.Akn(e.DdM(46,S)),e.Q6J("visible",t.asigUsuariosDialog)("modal",!0),e.xp6(1),e.Q6J("sucursal",t.itemAsigUsuarios),e.xp6(1),e.Akn(e.DdM(47,g)),e.Q6J("visible",t.deleteItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",t.item),e.xp6(2),e.Akn(e.DdM(48,g)),e.Q6J("visible",t.deleteItemsDialog)("modal",!0),e.xp6(6),e.Akn(e.DdM(49,g)),e.Q6J("visible",t.restartItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",t.item),e.xp6(2),e.Akn(e.DdM(50,g)),e.Q6J("visible",t.restartItemsDialog)("modal",!0))},dependencies:[_.sg,_.O5,_.PC,r.JJ,r.On,d.iA,m.jx,d.lQ,d.fz,d.UA,d.Mo,N.p,b.Hq,x.UN,Z.H,J.FN,q.o,C.o,F.V,E,V],styles:[".rowStyle[_ngcontent-%COMP%]{width:14%;min-width:10rem}.rowStyleId[_ngcontent-%COMP%]{width:10%;min-width:6rem}"]})),n})()}];let me=(()=>{class n{}return(0,o.Z)(n,"\u0275fac",function(i){return new(i||n)}),(0,o.Z)(n,"\u0275mod",e.oAB({type:n})),(0,o.Z)(n,"\u0275inj",e.cJS({imports:[w.m,T.Bz.forChild(de)]})),n})()}}]);