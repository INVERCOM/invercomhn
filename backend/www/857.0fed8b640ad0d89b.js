"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[857],{857:(ct,v,r)=>{r.r(v),r.d(v,{AsistenciasModule:()=>dt});var a=r(1180),A=r(1380),F=r(7246),f=r(805),Z=r(7579),h=r(2722),J=r(4004),p=r(5698),t=r(4650),M=r(2340),w=r(529),b=r(629);let C=(()=>{class n{constructor(i,e,s){(0,a.Z)(this,"http",void 0),(0,a.Z)(this,"authS",void 0),(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"_prefix",M.H+"/api/asistencias"),this.http=i,this.authS=e,this.router=s}getAll(i=null,e=[1]){this.authS.refreshToken();const s={cia_nids:this.authS.isValidCia(!1),asis_nsts:e,fechas:i};return this.http.post(this._prefix+"/getall",s)}save(i){const e={...i,...this.authS.getUsuarioLog()};return this.http.post(this._prefix+"/save",e)}setSts(i){return this.http.post(this._prefix+"/setsts/"+i.asis_nid,{asis_nsts:i.asis_nsts,...this.authS.getUsuarioLog()})}setBulkSts(i){return this.http.post(this._prefix+"/setbullksts",{data:i,...this.authS.getUsuarioLog()})}getCompanias(){const i={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getallcias",i)}getEmpleados(){const i={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getallempleados",i)}}return(0,a.Z)(n,"\u0275fac",function(i){return new(i||n)(t.LFG(w.eN),t.LFG(b.e),t.LFG(A.F0))}),(0,a.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})),n})();var E=r(492),q=r(1850),T=r(1168),m=r(6895),d=r(433),u=r(99),U=r(3388),y=r(5593),x=r(5362),S=r(1795),H=r(2453),B=r(1383),D=r(1740),I=r(2210),R=r(1493);let V=(()=>{class n{constructor(i,e,s,o,c){(0,a.Z)(this,"dbapi",void 0),(0,a.Z)(this,"_builder",void 0),(0,a.Z)(this,"authS",void 0),(0,a.Z)(this,"skNsCore",void 0),(0,a.Z)(this,"datePipe",void 0),(0,a.Z)(this,"createForm",void 0),(0,a.Z)(this,"companias",[]),(0,a.Z)(this,"empleados",[]),(0,a.Z)(this,"guardando",!1),(0,a.Z)(this,"itemDialog",!1),(0,a.Z)(this,"submitted",!1),(0,a.Z)(this,"$destroy",new Z.x),(0,a.Z)(this,"asistencia",{}),(0,a.Z)(this,"edit",new t.vpe),this.dbapi=i,this._builder=e,this.authS=s,this.skNsCore=o,this.datePipe=c,this.createForm=e.group({asis_nid:[0],cia_nid:["",d.kI.required],emp_nid:["",d.kI.required],asis_ttfechaentrada:[""],asis_nlatentrada:[""],asis_nlongentrada:[""],asis_ttfechasalida:[""],asis_nlatsalida:[""],asis_nlongsalida:[""],asis_nminutosreceso:[""],asis_nsts:[""]}),s.\u00f8bserverCompanySelected.pipe((0,h.R)(this.$destroy)).subscribe(_=>{this.cia_nid?.setValue(""),this.emp_nid?.setValue(""),this.getCompanias(),this.getEmpleados()}),o.fromEvent("/rrhh/empleados+"+this.authS.isValidCia(!1).toString()).pipe((0,h.R)(this.$destroy)).subscribe(_=>{this.skNsCore.socketId!=_&&(console.log("Event socket: empleados"),this.getEmpleados())})}ngOnInit(){}ngOnChanges(){this.asistencia&&this.asistencia?.emp_nid&&this.asistencia?.emp_nid>0&&(this.asis_nid?.setValue(this.asistencia?.asis_nid),this.cia_nid?.setValue(this.searchById(this.asistencia?.cia_nid,this.companias)),this.emp_nid?.setValue(this.searchById(this.asistencia?.emp_nid,this.empleados)),this.asis_ttfechaentrada?.setValue(this.asistencia?.asis_ttfechaentrada?this.datePipe.transform(this.asistencia?.asis_ttfechaentrada,"yyyy-MM-dd HH:mm"):null),this.asis_nlatentrada?.setValue(this.asistencia?.asis_nlatentrada),this.asis_nlongentrada?.setValue(this.asistencia?.asis_nlongentrada),this.asis_ttfechasalida?.setValue(this.asistencia?.asis_ttfechasalida?this.datePipe.transform(this.asistencia?.asis_ttfechasalida,"yyyy-MM-dd HH:mm"):null),this.asis_nlatsalida?.setValue(this.asistencia?.asis_nlatsalida),this.asis_nlongsalida?.setValue(this.asistencia?.asis_nlongsalida),this.asis_nminutosreceso?.setValue(this.asistencia?.asis_nminutosreceso),this.asis_nsts?.setValue(this.asistencia?.asis_nsts))}getCompanias(){this.companias=[{id:"",text:"...",obj:{}}],this.dbapi.getCompanias().pipe((0,p.q)(1)).subscribe({next:i=>{if(i&&null!=i&&""!==i){for(const e in i)this.companias=[...this.companias,{id:i[e].cia_nid,text:i[e].cia_vnombre,obj:i[e]}];1==this.companias.length&&this.cia_nid?.setValue(this.companias[0])}else console.log("Error consultando compa\xf1\xedas")},error:i=>{console.log(i),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}getEmpleados(){this.empleados=[{id:"",text:"...",obj:{}}],this.dbapi.getEmpleados().pipe((0,p.q)(1)).subscribe({next:i=>{if(i&&null!=i&&""!==i){for(const e in i)this.empleados=[...this.empleados,{id:i[e].emp_nid,text:i[e].emp_videntidad+" - "+i[e].emp_vnombre+" "+i[e].emp_vapellido,obj:i[e]}];1==this.empleados.length&&this.emp_nid?.setValue(this.empleados[0])}else console.log("Error consultando empleados")},error:i=>{console.log(i),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}save(){if(this.createForm.valid&&!this.guardando){this.guardando=!0;const i={asis_nid:this.asis_nid?.value>0?this.asis_nid?.value:null,cia_nid:this.cia_nid?.value.id,emp_nid:this.emp_nid?.value.id,asis_ttfechaentrada:this.asis_ttfechaentrada?.value,asis_nlatentrada:this.asis_nlatentrada?.value,asis_nlongentrada:this.asis_nlongentrada?.value,asis_ttfechasalida:this.asis_ttfechasalida?.value,asis_nlatsalida:this.asis_nlatsalida?.value,asis_nlongsalida:this.asis_nlongsalida?.value,asis_nminutosreceso:this.asis_nminutosreceso?.value,asis_nsts:this.asis_nsts?.value>0?3:1};console.log(i),this.dbapi.save(i).pipe((0,p.q)(1)).subscribe({next:e=>{"success"==e.type&&(this.skNsCore.notificarUpsert("/rrhh/asistencias",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.limpiarForm()),this.guardando=!1,this.edit.emit(e)},error:e=>{console.log(e),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:e})}})}}limpiarForm(){this.createForm.reset(),this.emp_nid?.setValue(0)}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(i,e){for(let s=0;s<e.length;s++){const o=e[s];if(o.id==i)return o}return""}validarForm(){return!(!this.createForm.valid||""==this.cia_nid?.value.id||""==this.emp_nid?.value.id)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get asis_nid(){return this.createForm.get("asis_nid")}get cia_nid(){return this.createForm.get("cia_nid")}get emp_nid(){return this.createForm.get("emp_nid")}get asis_ttfechaentrada(){return this.createForm.get("asis_ttfechaentrada")}get asis_nlatentrada(){return this.createForm.get("asis_nlatentrada")}get asis_nlongentrada(){return this.createForm.get("asis_nlongentrada")}get asis_ttfechasalida(){return this.createForm.get("asis_ttfechasalida")}get asis_nlatsalida(){return this.createForm.get("asis_nlatsalida")}get asis_nlongsalida(){return this.createForm.get("asis_nlongsalida")}get asis_nminutosreceso(){return this.createForm.get("asis_nminutosreceso")}get asis_nsts(){return this.createForm.get("asis_nsts")}}return(0,a.Z)(n,"\u0275fac",function(i){return new(i||n)(t.Y36(C),t.Y36(d.qu),t.Y36(b.e),t.Y36(T.pP),t.Y36(m.uU))}),(0,a.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-create-asistencias"]],inputs:{asistencia:"asistencia"},outputs:{edit:"edit"},features:[t.TTD],decls:35,vars:42,consts:[[1,"row"],[1,"col-12"],[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["optionLabel","text","formControlName","cia_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["optionLabel","text","formControlName","emp_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","asis_ttfechaentrada","type","datetime-local"],["pInputText","","formControlName","asis_ttfechasalida","type","datetime-local"],["pInputText","","formControlName","asis_nminutosreceso","type","number"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),t.NdJ("ngSubmit",function(){return e.save()}),t.TgZ(4,"div",4)(5,"label",5),t._uU(6,"Compa\xf1\xeda"),t.qZA(),t.TgZ(7,"div",6),t._UZ(8,"p-dropdown",7),t.qZA()(),t.TgZ(9,"div",4)(10,"label",5),t._uU(11,"Empleado"),t.qZA(),t.TgZ(12,"div",6),t._UZ(13,"p-dropdown",8),t.qZA()(),t.TgZ(14,"div",4)(15,"label",5),t._uU(16,"Fecha entrada"),t.qZA(),t.TgZ(17,"div",6),t._UZ(18,"input",9),t.qZA()(),t.TgZ(19,"div",4)(20,"label",5),t._uU(21,"Fecha salida"),t.qZA(),t.TgZ(22,"div",6),t._UZ(23,"input",10),t.qZA()(),t.TgZ(24,"div",4)(25,"label",5),t._uU(26,"Tiempo receso (min)"),t.qZA(),t.TgZ(27,"div",6),t._UZ(28,"input",11),t.qZA()(),t._UZ(29,"hr"),t.TgZ(30,"div",4)(31,"div",12)(32,"span",13),t._UZ(33,"button",14),t.TgZ(34,"button",15),t.NdJ("click",function(){return e.limpiarForm()}),t.qZA()()()()()()()()),2&i&&(t.xp6(3),t.Q6J("formGroup",e.createForm),t.xp6(5),t.ekj("ng-invalid",(null==e.cia_nid?null:e.cia_nid.invalid)&&(null==e.cia_nid?null:e.cia_nid.touched))("ng-dirty",(null==e.cia_nid?null:e.cia_nid.invalid)&&(null==e.cia_nid?null:e.cia_nid.touched))("ng-valid",(null==e.cia_nid?null:e.cia_nid.valid)&&((null==e.cia_nid?null:e.cia_nid.touched)||(null==e.cia_nid?null:e.cia_nid.dirty))),t.Q6J("options",e.companias)("filter",!1)("virtualScroll",e.companias.length>5)("virtualScrollItemSize",38),t.xp6(5),t.ekj("ng-invalid",(null==e.emp_nid?null:e.emp_nid.invalid)&&(null==e.emp_nid?null:e.emp_nid.touched))("ng-dirty",(null==e.emp_nid?null:e.emp_nid.invalid)&&(null==e.emp_nid?null:e.emp_nid.touched))("ng-valid",(null==e.emp_nid?null:e.emp_nid.valid)&&((null==e.emp_nid?null:e.emp_nid.touched)||(null==e.emp_nid?null:e.emp_nid.dirty))),t.Q6J("options",e.empleados)("filter",!1)("virtualScroll",e.empleados.length>5)("virtualScrollItemSize",38),t.xp6(5),t.ekj("ng-invalid",(null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.invalid)&&(null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.touched))("ng-dirty",(null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.invalid)&&(null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.touched))("ng-valid",(null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.valid)&&((null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.touched)||(null==e.asis_ttfechaentrada?null:e.asis_ttfechaentrada.dirty))),t.xp6(5),t.ekj("ng-invalid",(null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.invalid)&&(null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.touched))("ng-dirty",(null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.invalid)&&(null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.touched))("ng-valid",(null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.valid)&&((null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.touched)||(null==e.asis_ttfechasalida?null:e.asis_ttfechasalida.dirty))),t.xp6(5),t.ekj("ng-invalid",(null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.invalid)&&(null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.touched))("ng-dirty",(null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.invalid)&&(null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.touched))("ng-valid",(null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.valid)&&((null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.touched)||(null==e.asis_nminutosreceso?null:e.asis_nminutosreceso.dirty))),t.xp6(5),t.Q6J("disabled",!e.validarForm())("loading",e.guardando)("label",e.asistencia&&e.asistencia.asis_nid?"Editar":"Guardar"))},dependencies:[d._Y,d.Fj,d.wV,d.JJ,d.JL,d.sg,d.u,y.Hq,S.H,D.o,I.Lt],styles:[".ng-valid[_ngcontent-%COMP%]{border-color:#2ecc71!important}"]})),n})();function O(n,l){1&n&&(t.TgZ(0,"div",32)(1,"h3",33),t._uU(2,"Listado de asistencias"),t.qZA()())}function Q(n,l){if(1&n){const i=t.EpF();t._UZ(0,"p-fileUpload",34),t.TgZ(1,"button",35),t.NdJ("click",function(){t.CHM(i),t.oxw();const s=t.MAs(28);return t.KtG(s.exportCSV())}),t.qZA()}2&n&&t.Q6J("maxFileSize",1e6)}function Y(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",44),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.deleteSelectedItems())}),t.qZA()}if(2&n){const i=t.oxw(2);t.Q6J("disabled",!i.selectedData||!i.selectedData.length)}}function G(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",45),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.restartSelectedItems())}),t.qZA()}if(2&n){const i=t.oxw(2);t.Q6J("disabled",!i.selectedData||!i.selectedData.length)}}const P=function(){return{float:"right"}};function L(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"div",36)(1,"span",37)(2,"input",38),t.NdJ("input",function(s){t.CHM(i);const o=t.oxw(),c=t.MAs(28);return t.KtG(o.onGlobalFilter(c,s))}),t.qZA(),t.TgZ(3,"button",39),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.getData())}),t.qZA(),t.TgZ(4,"button",40),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.openNew())}),t.qZA(),t.YNc(5,Y,1,1,"button",41),t.YNc(6,G,1,1,"button",42),t.TgZ(7,"p-selectButton",43),t.NdJ("ngModelChange",function(s){t.CHM(i);const o=t.oxw();return t.KtG(o.dataValue=s)})("click",function(){t.CHM(i);const s=t.oxw();return s.getData(),t.KtG(s.clearDataSelected())}),t.qZA()()()}if(2&n){const i=t.oxw();t.xp6(5),t.Q6J("ngIf",i.dataValue&&(1===i.dataValue[0]||2===i.dataValue[0])),t.xp6(1),t.Q6J("ngIf",i.dataValue&&0===i.dataValue[0]),t.xp6(1),t.Q6J("options",i.dataOptions)("ngModel",i.dataValue)("ngStyle",t.DdM(5,P))}}function K(n,l){if(1&n&&(t.TgZ(0,"th",48),t._uU(1),t._UZ(2,"p-sortIcon",49),t.qZA()),2&n){const i=l.$implicit;t.ekj("rowStyle","ID"!==i.header)("rowStyleId","ID"===i.header),t.Q6J("pSortableColumn",i.field),t.xp6(1),t.hij(" ",i.header," "),t.xp6(1),t.Q6J("field",i.field)}}function j(n,l){if(1&n&&(t.TgZ(0,"tr")(1,"th",46),t._UZ(2,"p-tableHeaderCheckbox"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Acciones"),t.qZA(),t.YNc(5,K,3,7,"th",47),t.qZA()),2&n){const i=t.oxw();t.xp6(5),t.Q6J("ngForOf",i.cols)}}function $(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",56),t.NdJ("click",function(){t.CHM(i);const s=t.oxw().$implicit,o=t.oxw();return t.KtG(o.editRow(s))}),t.qZA()}}function z(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",57),t.NdJ("click",function(){t.CHM(i);const s=t.oxw().$implicit,o=t.oxw();return t.KtG(o.deleteRow(s))}),t.qZA()}}function X(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",58),t.NdJ("click",function(){t.CHM(i);const s=t.oxw().$implicit,o=t.oxw();return t.KtG(o.restartRow(s))}),t.qZA()}}function W(n,l){if(1&n&&(t.TgZ(0,"td")(1,"span",59),t._uU(2),t.qZA(),t._uU(3),t.qZA()),2&n){const i=l.$implicit,e=t.oxw().$implicit;t.xp6(2),t.Oqu(i.header),t.xp6(1),t.hij(" ",e[i.field]," ")}}function tt(n,l){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-tableCheckbox",50),t.qZA(),t.TgZ(3,"td")(4,"div",51),t.YNc(5,$,1,0,"button",52),t.YNc(6,z,1,0,"button",53),t.YNc(7,X,1,0,"button",54),t.qZA()(),t.YNc(8,W,4,2,"td",55),t.qZA()),2&n){const i=l.$implicit,e=t.oxw();t.xp6(2),t.Q6J("value",i),t.xp6(3),t.Q6J("ngIf",i.asis_nsts>0),t.xp6(1),t.Q6J("ngIf",i.asis_nsts>0),t.xp6(1),t.Q6J("ngIf",i.asis_nsts<1),t.xp6(1),t.Q6J("ngForOf",e.cols)}}function et(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1,"Estas seguro que quieres eliminar "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4,"?"),t.qZA()),2&n){const i=t.oxw();t.xp6(3),t.Oqu("Asistencia N\xb0 "+i.item.asis_nid)}}function it(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.deleteItemDialog=!1)}),t.qZA(),t.TgZ(1,"button",61),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.confirmDelete())}),t.qZA()}}function st(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.deleteItemsDialog=!1)}),t.qZA(),t.TgZ(1,"button",61),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.confirmDeleteSelected())}),t.qZA()}}function nt(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1,"Estas seguro que quieres restaurar "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4,"?"),t.qZA()),2&n){const i=t.oxw();t.xp6(3),t.Oqu("Asistencia N\xb0 "+i.item.asis_nid)}}function at(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.restartItemDialog=!1)}),t.qZA(),t.TgZ(1,"button",62),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.confirmRestart())}),t.qZA()}}function ot(n,l){if(1&n){const i=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.restartItemsDialog=!1)}),t.qZA(),t.TgZ(1,"button",62),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.confirmRestartSelected())}),t.qZA()}}const lt=function(){return[10,20,30]},N=function(){return{width:"750px"}},g=function(){return{width:"450px"}},rt=[{path:"",component:(()=>{class n{constructor(i,e,s,o,c,_,pt){(0,a.Z)(this,"dbapi",void 0),(0,a.Z)(this,"messageService",void 0),(0,a.Z)(this,"timezone",void 0),(0,a.Z)(this,"utilsService",void 0),(0,a.Z)(this,"authS",void 0),(0,a.Z)(this,"skNsCore",void 0),(0,a.Z)(this,"datePipe",void 0),(0,a.Z)(this,"createDialog",!1),(0,a.Z)(this,"editDialog",!1),(0,a.Z)(this,"deleteItemDialog",!1),(0,a.Z)(this,"deleteItemsDialog",!1),(0,a.Z)(this,"restartItemDialog",!1),(0,a.Z)(this,"restartItemsDialog",!1),(0,a.Z)(this,"isLoadingTable",!1),(0,a.Z)(this,"data",[]),(0,a.Z)(this,"item",{}),(0,a.Z)(this,"selectedData",[]),(0,a.Z)(this,"submitted",!1),(0,a.Z)(this,"cols",[]),(0,a.Z)(this,"tipoConsultaOp",[]),(0,a.Z)(this,"tipoConsulta",void 0),(0,a.Z)(this,"fechaInicio",""),(0,a.Z)(this,"fechaFin",""),(0,a.Z)(this,"statuses",[]),(0,a.Z)(this,"dataOptions",[]),(0,a.Z)(this,"dataValue",[1,2,3]),(0,a.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,a.Z)(this,"$destroy",new Z.x),this.dbapi=i,this.messageService=e,this.timezone=s,this.utilsService=o,this.authS=c,this.skNsCore=_,this.datePipe=pt,this.tipoConsultaOp=[...o.tipoConsulta],this.tipoConsulta=this.tipoConsultaOp[0],c.\u00f8bserverCompanySelected.pipe((0,h.R)(this.$destroy)).subscribe(k=>{this.getData()}),_.fromEvent("/rrhh/asistencias+"+this.authS.isValidCia(!1).toString()).pipe((0,h.R)(this.$destroy)).subscribe(k=>{this.skNsCore.socketId!=k&&(console.log("Event socket: asistencias"),this.getData())}),this.cols=[{field:"asis_nid",header:"ID"},{field:"cia_vnombre",header:"Compa\xf1\xeda"},{field:"emp_videntidad",header:"Identidad"},{field:"emp_vnombrecompleto",header:"Empleado"},{field:"asis_ttfechaentradapipe",header:"Fecha/hora entrada"},{field:"asis_nlatlogentrada",header:"Ubicaci\xf3n entrada"},{field:"asis_ttfechasalidapipe",header:"Fecha/hora salida"},{field:"asis_nlatlogsalida",header:"Ubicaci\xf3n salida"},{field:"asis_vminutosreceso",header:"Tiempo receso (min)"},{field:"asis_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1,2,3]},{name:"PENDIENTE",value:[1]},{name:"FINALIZADOS",value:[2,3]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1,2,3]}]}getData(){const i=this.utilsService.getDayToQuery(this.tipoConsulta.value,this.fechaInicio,this.fechaFin);""!=i.fechaInicio&&""!=i.fechaFinal&&(this.data=[],this.isLoadingTable=!0,this.dbapi.getAll(i,this.dataValue).pipe((0,J.U)(e=>(e.forEach(s=>{s.cia_vnombre=s.cias?s.cias.cia_vnombre:"",s.emp_videntidad=s.emps?s.emps.emp_videntidad:"",s.emp_vnombrecompleto=s.emps?s.emps.emp_vnombre+" "+s.emps.emp_vapellido:"",s.asis_ttfechaentradapipe=s.asis_ttfechaentrada?this.datePipe.transform(s.asis_ttfechaentrada,"dd-MM-yyyy HH:mm"):"-----",s.asis_ttfechasalidapipe=s.asis_ttfechasalida?this.datePipe.transform(s.asis_ttfechasalida,"dd-MM-yyyy HH:mm"):"-----",s.asis_nlatlogentrada=s.asis_nlatentrada?s.asis_nlatentrada+","+s.asis_nlongentrada:"-----",s.asis_nlatlogsalida=s.asis_nlatsalida?s.asis_nlongentrada+","+s.asis_nlongsalida:"-----",s.asis_vminutosreceso=s.asis_nminutosreceso?s.asis_nminutosreceso+" min":"-----",s.asis_vsts=1==s.asis_nsts?"PENDIENTE":s.asis_nsts>1?"FINALIZADO":"ELIMINADO"}),e)),(0,p.q)(1)).subscribe({next:e=>{this.data=[...e],this.isLoadingTable=!1},error:e=>{console.log(e),this.isLoadingTable=!1,this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}}))}ngOnInit(){}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}editRow(i){this.item={...i},this.editDialog=!0}deleteRow(i){this.deleteItemDialog=!0,this.item={...i}}confirmDeleteSelected(){const i=[];this.selectedData.forEach(e=>{i.push({asis_nid:e.asis_nid,asis_nsts:0})}),this.dbapi.setBulkSts(i).pipe((0,p.q)(1)).subscribe({next:e=>{this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),"success"==e.type&&(this.skNsCore.notificarUpsert("/rrhh/asistencias",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}confirmDelete(){this.dbapi.setSts({asis_nid:this.item.asis_nid,asis_nsts:0}).pipe((0,p.q)(1)).subscribe({next:e=>{this.skNsCore.notificarUpsert("/rrhh/asistencias",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}restartRow(i){this.restartItemDialog=!0,this.item={...i}}restartSelectedItems(){this.restartItemsDialog=!0}confirmRestart(){this.dbapi.setSts({asis_nid:this.item.asis_nid,asis_nsts:3}).pipe((0,p.q)(1)).subscribe({next:e=>{this.skNsCore.notificarUpsert("/rrhh/asistencias",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}confirmRestartSelected(){const i=[];this.selectedData.forEach(e=>{i.push({asis_nid:e.asis_nid,asis_nsts:3})}),this.dbapi.setBulkSts(i).pipe((0,p.q)(1)).subscribe({next:e=>{this.messageService.add({severity:e.type,summary:e.title,detail:e.message,life:3e3}),"success"==e.type&&(this.skNsCore.notificarUpsert("/rrhh/asistencias",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:e=>{console.log(e),this.editEvent({type:"error",title:"Ha ocurrido un error",message:e})}})}clearDataSelected(){this.selectedData=[]}findIndexById(i){let e=-1;for(let s=0;s<this.data.length;s++)if(this.data[s].asis_nid===i){e=s;break}return e}onGlobalFilter(i,e){i.filterGlobal(e.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}editEvent(i){this.messageService.add({severity:i.type,summary:i.title,detail:i.message,life:3e3}),"success"==i.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,a.Z)(n,"\u0275fac",function(i){return new(i||n)(t.Y36(C),t.Y36(f.ez),t.Y36(E.B),t.Y36(q.F),t.Y36(b.e),t.Y36(T.pP),t.Y36(m.uU))}),(0,a.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["ng-component"]],features:[t._Bn([f.ez])],decls:58,vars:53,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],[1,"grid","p-fluid"],[1,"card"],[1,"grid",2,"margin-bottom","-25px"],[1,"col-12","md:col-2"],[1,"field","grid"],[1,"col-12","md:col-10"],["optionLabel","label","filterBy","label",1,"p-width-125",3,"options","ngModel","filter","virtualScroll","ngModelChange","onChange"],[1,"col-12","md:col-3",3,"hidden"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],["pInputText","","type","datetime-local",3,"ngModel","ngModelChange","change"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","asis_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear asistencia",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar asistencia",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"asistencia","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1","mt-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1","mt-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1","mt-1",3,"click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash","class","p-button-danger mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay","class","p-button-help mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash",1,"p-button-danger","mr-1","ml-1","mt-1",3,"disabled","click"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay",1,"p-button-help","mr-1","ml-1","mt-1",3,"disabled","click"],[2,"width","3rem"],[3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","title","Editar","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil","title","Editar",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"p-toast",3),t.TgZ(4,"p-toolbar",4),t.YNc(5,O,3,0,"ng-template",5),t.YNc(6,Q,2,1,"ng-template",6),t.qZA(),t.TgZ(7,"div",7)(8,"div",1)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"p-dropdown",13),t.NdJ("ngModelChange",function(o){return e.tipoConsulta=o})("onChange",function(){return e.getData()}),t.qZA()()()(),t.TgZ(15,"div",14)(16,"div",11)(17,"label",15),t._uU(18,"del"),t.qZA(),t.TgZ(19,"div",12)(20,"input",16),t.NdJ("ngModelChange",function(o){return e.fechaInicio=o})("change",function(){return e.getData()}),t.qZA()()()(),t.TgZ(21,"div",14)(22,"div",11)(23,"label",15),t._uU(24,"al"),t.qZA(),t.TgZ(25,"div",12)(26,"input",16),t.NdJ("ngModelChange",function(o){return e.fechaFin=o})("change",function(){return e.getData()}),t.qZA()()()()()()()(),t.TgZ(27,"p-table",17,18),t.NdJ("selectionChange",function(o){return e.selectedData=o}),t.YNc(29,L,8,6,"ng-template",19),t.YNc(30,j,6,1,"ng-template",20),t.YNc(31,tt,9,5,"ng-template",21),t.qZA()(),t.TgZ(32,"p-dialog",22),t.NdJ("visibleChange",function(o){return e.createDialog=o}),t.TgZ(33,"app-create-asistencias",23),t.NdJ("edit",function(o){return e.editEvent(o)}),t.qZA()(),t.TgZ(34,"p-dialog",24),t.NdJ("visibleChange",function(o){return e.editDialog=o}),t.TgZ(35,"app-create-asistencias",25),t.NdJ("edit",function(o){return e.editEvent(o)}),t.qZA()(),t.TgZ(36,"p-dialog",26),t.NdJ("visibleChange",function(o){return e.deleteItemDialog=o}),t.TgZ(37,"div",27),t._UZ(38,"i",28),t.YNc(39,et,5,1,"span",29),t.qZA(),t.YNc(40,it,2,0,"ng-template",30),t.qZA(),t.TgZ(41,"p-dialog",31),t.NdJ("visibleChange",function(o){return e.deleteItemsDialog=o}),t.TgZ(42,"div",27),t._UZ(43,"i",28),t.TgZ(44,"span"),t._uU(45,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),t.qZA()(),t.YNc(46,st,2,0,"ng-template",30),t.qZA(),t.TgZ(47,"p-dialog",26),t.NdJ("visibleChange",function(o){return e.restartItemDialog=o}),t.TgZ(48,"div",27),t._UZ(49,"i",28),t.YNc(50,nt,5,1,"span",29),t.qZA(),t.YNc(51,at,2,0,"ng-template",30),t.qZA(),t.TgZ(52,"p-dialog",31),t.NdJ("visibleChange",function(o){return e.restartItemsDialog=o}),t.TgZ(53,"div",27),t._UZ(54,"i",28),t.TgZ(55,"span"),t._uU(56,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),t.qZA()(),t.YNc(57,ot,2,0,"ng-template",30),t.qZA()()()),2&i&&(t.xp6(14),t.Q6J("options",e.tipoConsultaOp)("ngModel",e.tipoConsulta)("filter",!1)("virtualScroll",!1),t.xp6(1),t.Q6J("hidden",e.tipoConsulta&&"5"!==e.tipoConsulta.value),t.xp6(5),t.Q6J("ngModel",e.fechaInicio),t.xp6(1),t.Q6J("hidden",e.tipoConsulta&&"5"!==e.tipoConsulta.value),t.xp6(5),t.Q6J("ngModel",e.fechaFin),t.xp6(1),t.Q6J("value",e.data)("columns",e.cols)("rows",10)("globalFilterFields",e.cols)("rows",10)("paginator",!0)("loading",e.isLoadingTable)("rowsPerPageOptions",t.DdM(46,lt))("showCurrentPageReport",!0)("selection",e.selectedData)("rowHover",!0),t.xp6(5),t.Akn(t.DdM(47,N)),t.Q6J("visible",e.createDialog)("modal",!0),t.xp6(2),t.Akn(t.DdM(48,N)),t.Q6J("visible",e.editDialog)("modal",!0),t.xp6(1),t.Q6J("asistencia",e.item),t.xp6(1),t.Akn(t.DdM(49,g)),t.Q6J("visible",e.deleteItemDialog)("modal",!0),t.xp6(3),t.Q6J("ngIf",e.item),t.xp6(2),t.Akn(t.DdM(50,g)),t.Q6J("visible",e.deleteItemsDialog)("modal",!0),t.xp6(6),t.Akn(t.DdM(51,g)),t.Q6J("visible",e.restartItemDialog)("modal",!0),t.xp6(3),t.Q6J("ngIf",e.item),t.xp6(2),t.Akn(t.DdM(52,g)),t.Q6J("visible",e.restartItemsDialog)("modal",!0))},dependencies:[m.sg,m.O5,m.PC,d.Fj,d.JJ,d.On,u.iA,f.jx,u.lQ,u.fz,u.UA,u.Mo,U.p,y.Hq,x.UN,S.H,H.FN,B.o,D.o,I.Lt,R.V,V],styles:[".rowStyle[_ngcontent-%COMP%]{width:14%;min-width:10rem}.rowStyleId[_ngcontent-%COMP%]{width:10%;min-width:6rem}.p-width-125[_ngcontent-%COMP%]     .p-component{width:125px!important}"]})),n})()}];let dt=(()=>{class n{}return(0,a.Z)(n,"\u0275fac",function(i){return new(i||n)}),(0,a.Z)(n,"\u0275mod",t.oAB({type:n})),(0,a.Z)(n,"\u0275inj",t.cJS({imports:[F.m,A.Bz.forChild(rt)]})),n})()}}]);