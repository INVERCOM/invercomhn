"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[4669],{4669:(le,f,s)=>{s.r(f),s.d(f,{MaterialesModule:()=>oe});var r=s(1180),p=s(6895),N=s(7246),b=s(1380),h=s(805),Z=s(7579),_=s(2722),D=s(4004),u=s(5698),e=s(4650),k=s(2340),q=s(529),v=s(629);let C=(()=>{class a{constructor(i,t,n){(0,r.Z)(this,"http",void 0),(0,r.Z)(this,"authS",void 0),(0,r.Z)(this,"router",void 0),(0,r.Z)(this,"_prefix",k.H+"/api/materiales"),this.http=i,this.authS=t,this.router=n}getAll(i=[1]){this.authS.refreshToken();const t={cia_nids:this.authS.isValidCia(!1),mater_nsts:i};return this.http.post(this._prefix+"/getall",t)}save(i,t){const n={...i,_isvs:t,...this.authS.getUsuarioLog()};return this.http.post(this._prefix+"/save",n)}setSts(i){return this.http.post(this._prefix+"/setsts/"+i.mater_nid,{mater_nsts:i.mater_nsts,...this.authS.getUsuarioLog()})}setBulkSts(i){return this.http.post(this._prefix+"/setbullksts",{data:i,...this.authS.getUsuarioLog()})}getCompanias(){const i={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getallcompanias",i)}getImpuestos(){const i={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getallimpuestoscia",i)}}return(0,r.Z)(a,"\u0275fac",function(i){return new(i||a)(e.LFG(q.eN),e.LFG(v.e),e.LFG(b.F0))}),(0,r.Z)(a,"\u0275prov",e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})),a})();var T=s(1168),m=s(433),c=s(99),F=s(3388),A=s(5593),J=s(5362),S=s(1795),w=s(2453),U=s(1383),y=s(1740),j=s(1493),E=s(2210);let V=(()=>{class a{constructor(i,t,n,o){(0,r.Z)(this,"dbapi",void 0),(0,r.Z)(this,"_builder",void 0),(0,r.Z)(this,"authS",void 0),(0,r.Z)(this,"skNsCore",void 0),(0,r.Z)(this,"createForm",void 0),(0,r.Z)(this,"companias",[]),(0,r.Z)(this,"impuestos",[]),(0,r.Z)(this,"manejosInv",[]),(0,r.Z)(this,"SiNo",[]),(0,r.Z)(this,"guardando",!1),(0,r.Z)(this,"itemDialog",!1),(0,r.Z)(this,"submitted",!1),(0,r.Z)(this,"$destroy",new Z.x),(0,r.Z)(this,"material",{}),(0,r.Z)(this,"edit",new e.vpe),this.dbapi=i,this._builder=t,this.authS=n,this.skNsCore=o,o.fromEvent("/inventario/impuestos").pipe((0,_.R)(this.$destroy)).subscribe(d=>{console.log("Event socket: impuestos"),this.getImpuestos()}),this.createForm=t.group({mater_nid:[0],cia_nid:["",m.kI.required],mater_vcodigo:[""],mater_vnombre:["",m.kI.required],mater_vdescripcion:["",m.kI.required],mater_vcodbar:[""],mater_nprecio:["",m.kI.required],mater_ncosto:["",m.kI.required],mater_ntipomanejo:["",m.kI.required],mater_vimpuestos:[""],mater_nisv:["",m.kI.required],mater_nisvincluido:["",m.kI.required],mater_nmostrarfact:["",m.kI.required],mater_nsts:[""]}),n.\u00f8bserverCompanySelected.pipe((0,_.R)(this.$destroy)).subscribe(d=>{this.getCompanias()}),this.getImpuestos(),this.manejosInv=[{id:"",text:"...",obj:{}},{id:"1",text:"INVENTARIABLE",obj:{}},{id:"2",text:"NO INVENTARIABLE",obj:{}}],this.SiNo=[{id:"",text:"...",obj:{}},{id:"1",text:"SI",obj:{}},{id:"0",text:"NO",obj:{}}]}ngOnChanges(){if(this.material&&this.material?.mater_nid&&this.material?.mater_nid>0){this.mater_nid?.setValue(this.material?.mater_nid),this.cia_nid?.setValue(this.searchById(this.material?.cia_nid,this.companias)),this.mater_vcodigo?.setValue(this.material?.mater_vcodigo),this.mater_vnombre?.setValue(this.material?.mater_vnombre),this.mater_vdescripcion?.setValue(this.material?.mater_vdescripcion),this.mater_vcodbar?.setValue(this.material?.mater_vcodbar),this.mater_nprecio?.setValue(this.material?.mater_nprecio),this.mater_ncosto?.setValue(this.material?.mater_ncosto),this.mater_ntipomanejo?.setValue(this.searchById(this.material?.mater_ntipomanejo.toString(),this.manejosInv)),this.mater_nisvincluido?.setValue(this.searchById(this.material?.mater_nisvincluido.toString(),this.SiNo)),this.mater_nisv?.setValue(this.material?.mater_nisv),this.mater_nmostrarfact?.setValue(this.searchById(this.material?.mater_nmostrarfact.toString(),this.SiNo)),this.mater_nsts?.setValue(this.material?.mater_nsts);const i=[];for(let t=0;t<this.material.isvs?.length;t++){const n=this.material?.isvs[t];i.push(this.searchById(n.isv_nid,this.impuestos))}this.mater_vimpuestos?.setValue(i)}}getCompanias(){this.companias=[],this.cia_nid?.setValue(""),this.dbapi.getCompanias().pipe((0,u.q)(1)).subscribe({next:i=>{if(i&&null!=i&&""!==i){for(const t in i)this.companias=[...this.companias,{id:i[t].cia_nid,text:i[t].cia_vnombre,obj:i[t]}];1==this.companias.length&&this.cia_nid?.setValue(this.companias[0])}else console.log("Error consultando compa\xf1\xedas")},error:i=>{console.log(i),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}getImpuestos(){this.impuestos=[],this.mater_vimpuestos?.setValue(""),this.dbapi.getImpuestos().pipe((0,u.q)(1)).subscribe({next:i=>{if(i&&null!=i&&""!==i)for(const t in i)this.impuestos=[...this.impuestos,{id:i[t].isv_nvalor,text:i[t].isv_vdescripcion,obj:i[t]}];else console.log("Error consultando impuestos")},error:i=>{console.log(i),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}save(){if(this.validarForm()){this.guardando=!0;const i={mater_nid:this.mater_nid?.value>0?this.mater_nid?.value:null,cia_nid:this.cia_nid?.value.id,mater_vcodigo:this.mater_vcodigo?.value.trim().toUpperCase(),mater_vnombre:this.mater_vnombre?.value.trim().toUpperCase(),mater_vdescripcion:this.mater_vdescripcion?.value.trim().toUpperCase(),mater_vcodbar:this.mater_vcodbar?.value.trim().toUpperCase(),mater_nprecio:this.mater_nprecio?.value,mater_ncosto:this.mater_ncosto?.value,mater_ntipomanejo:this.mater_ntipomanejo?.value.id,mater_nisv:this.mater_nisv?.value.id>0?this.mater_nisv?.value.id:0,mater_nisvincluido:this.mater_nisvincluido?.value.id,mater_nmostrarfact:this.mater_nmostrarfact?.value.id,mater_nsts:1};this.dbapi.save(i,[]).pipe((0,u.q)(1)).subscribe({next:t=>{"success"==t.type&&(this.skNsCore.notificarUpsert("/inventario/materiales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.limpiarForm()),this.edit.emit(t),this.guardando=!1},error:t=>{console.log(t),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}})}}limpiarForm(){this.createForm.reset(),this.mater_nid?.setValue(0),this.mater_ntipomanejo?.setValue(""),this.mater_nisvincluido?.setValue(""),this.mater_nisv?.setValue(""),this.mater_nmostrarfact?.setValue("")}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(i,t){for(let n=0;n<t.length;n++){const o=t[n];if(o.id==i)return o}return""}validarForm(){return!(!this.createForm.valid||""==this.mater_ntipomanejo?.value.id||""==this.mater_nisvincluido?.value.id||""==this.mater_nmostrarfact?.value.id)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get mater_nid(){return this.createForm.get("mater_nid")}get cia_nid(){return this.createForm.get("cia_nid")}get mater_vcodigo(){return this.createForm.get("mater_vcodigo")}get mater_vnombre(){return this.createForm.get("mater_vnombre")}get mater_vdescripcion(){return this.createForm.get("mater_vdescripcion")}get mater_vcodbar(){return this.createForm.get("mater_vcodbar")}get mater_nprecio(){return this.createForm.get("mater_nprecio")}get mater_ncosto(){return this.createForm.get("mater_ncosto")}get mater_ntipomanejo(){return this.createForm.get("mater_ntipomanejo")}get mater_vimpuestos(){return this.createForm.get("mater_vimpuestos")}get mater_nisv(){return this.createForm.get("mater_nisv")}get mater_nisvincluido(){return this.createForm.get("mater_nisvincluido")}get mater_nmostrarfact(){return this.createForm.get("mater_nmostrarfact")}get mater_nsts(){return this.createForm.get("mater_nsts")}}return(0,r.Z)(a,"\u0275fac",function(i){return new(i||a)(e.Y36(C),e.Y36(m.qu),e.Y36(v.e),e.Y36(T.pP))}),(0,r.Z)(a,"\u0275cmp",e.Xpm({type:a,selectors:[["app-create-materiales"]],inputs:{material:"material"},outputs:{edit:"edit"},features:[e.TTD],decls:65,vars:87,consts:[[1,"row"],[1,"col-12"],[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["optionLabel","text","formControlName","cia_nid",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","mater_vcodigo","type","text",2,"text-transform","uppercase"],["pInputText","","formControlName","mater_vnombre","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","mater_vdescripcion","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","mater_vcodbar","type","text",2,"text-transform","uppercase"],["optionLabel","text","formControlName","mater_ntipomanejo","filterBy","text",3,"options","filter","virtualScrollItemSize"],["pInputText","","formControlName","mater_nprecio","type","number","required",""],["pInputText","","formControlName","mater_ncosto","type","number","required",""],["optionLabel","text","formControlName","mater_vimpuestos",3,"options","filter","virtualScroll","virtualScrollItemSize"],["optionLabel","text","formControlName","mater_nisvincluido",3,"options","filter","virtualScrollItemSize"],["optionLabel","text","formControlName","mater_nmostrarfact",3,"options","filter","virtualScrollItemSize"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),e.NdJ("ngSubmit",function(){return t.save()}),e.TgZ(4,"div",4)(5,"label",5),e._uU(6,"Compa\xf1\xeda"),e.qZA(),e.TgZ(7,"div",6),e._UZ(8,"p-dropdown",7),e.qZA()(),e.TgZ(9,"div",4)(10,"label",5),e._uU(11,"C\xf3digo"),e.qZA(),e.TgZ(12,"div",6),e._UZ(13,"input",8),e.qZA()(),e.TgZ(14,"div",4)(15,"label",5),e._uU(16,"Nombre"),e.qZA(),e.TgZ(17,"div",6),e._UZ(18,"input",9),e.qZA()(),e.TgZ(19,"div",4)(20,"label",5),e._uU(21,"Descripci\xf3n"),e.qZA(),e.TgZ(22,"div",6),e._UZ(23,"input",10),e.qZA()(),e.TgZ(24,"div",4)(25,"label",5),e._uU(26,"C\xf3digo de barras"),e.qZA(),e.TgZ(27,"div",6),e._UZ(28,"input",11),e.qZA()(),e.TgZ(29,"div",4)(30,"label",5),e._uU(31,"Manejo inventario"),e.qZA(),e.TgZ(32,"div",6),e._UZ(33,"p-dropdown",12),e.qZA()(),e.TgZ(34,"div",4)(35,"label",5),e._uU(36,"Precio"),e.qZA(),e.TgZ(37,"div",6),e._UZ(38,"input",13),e.qZA()(),e.TgZ(39,"div",4)(40,"label",5),e._uU(41,"Costo"),e.qZA(),e.TgZ(42,"div",6),e._UZ(43,"input",14),e.qZA()(),e.TgZ(44,"div",4)(45,"label",5),e._uU(46,"Impuestos"),e.qZA(),e.TgZ(47,"div",6),e._UZ(48,"p-dropdown",15),e.qZA()(),e.TgZ(49,"div",4)(50,"label",5),e._uU(51,"ISV incluido"),e.qZA(),e.TgZ(52,"div",6),e._UZ(53,"p-dropdown",16),e.qZA()(),e.TgZ(54,"div",4)(55,"label",5),e._uU(56,"Mostrar para facturar"),e.qZA(),e.TgZ(57,"div",6),e._UZ(58,"p-dropdown",17),e.qZA()(),e._UZ(59,"hr"),e.TgZ(60,"div",4)(61,"div",18)(62,"span",19),e._UZ(63,"button",20),e.TgZ(64,"button",21),e.NdJ("click",function(){return t.limpiarForm()}),e.qZA()()()()()()()()),2&i&&(e.xp6(3),e.Q6J("formGroup",t.createForm),e.xp6(5),e.ekj("ng-invalid",(null==t.cia_nid?null:t.cia_nid.invalid)&&(null==t.cia_nid?null:t.cia_nid.touched))("ng-dirty",(null==t.cia_nid?null:t.cia_nid.invalid)&&(null==t.cia_nid?null:t.cia_nid.touched))("ng-valid",(null==t.cia_nid?null:t.cia_nid.valid)&&((null==t.cia_nid?null:t.cia_nid.touched)||(null==t.cia_nid?null:t.cia_nid.dirty))),e.Q6J("options",t.companias)("filter",!1)("virtualScroll",t.companias.length>5)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_vcodigo?null:t.mater_vcodigo.invalid)&&(null==t.mater_vcodigo?null:t.mater_vcodigo.touched))("ng-dirty",(null==t.mater_vcodigo?null:t.mater_vcodigo.invalid)&&(null==t.mater_vcodigo?null:t.mater_vcodigo.touched))("ng-valid",(null==t.mater_vcodigo?null:t.mater_vcodigo.valid)&&((null==t.mater_vcodigo?null:t.mater_vcodigo.touched)||(null==t.mater_vcodigo?null:t.mater_vcodigo.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_vnombre?null:t.mater_vnombre.invalid)&&(null==t.mater_vnombre?null:t.mater_vnombre.touched))("ng-dirty",(null==t.mater_vnombre?null:t.mater_vnombre.invalid)&&(null==t.mater_vnombre?null:t.mater_vnombre.touched))("ng-valid",(null==t.mater_vnombre?null:t.mater_vnombre.valid)&&((null==t.mater_vnombre?null:t.mater_vnombre.touched)||(null==t.mater_vnombre?null:t.mater_vnombre.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_vdescripcion?null:t.mater_vdescripcion.invalid)&&(null==t.mater_vdescripcion?null:t.mater_vdescripcion.touched))("ng-dirty",(null==t.mater_vdescripcion?null:t.mater_vdescripcion.invalid)&&(null==t.mater_vdescripcion?null:t.mater_vdescripcion.touched))("ng-valid",(null==t.mater_vdescripcion?null:t.mater_vdescripcion.valid)&&((null==t.mater_vdescripcion?null:t.mater_vdescripcion.touched)||(null==t.mater_vdescripcion?null:t.mater_vdescripcion.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_vcodbar?null:t.mater_vcodbar.invalid)&&(null==t.mater_vcodbar?null:t.mater_vcodbar.touched))("ng-dirty",(null==t.mater_vcodbar?null:t.mater_vcodbar.invalid)&&(null==t.mater_vcodbar?null:t.mater_vcodbar.touched))("ng-valid",(null==t.mater_vcodbar?null:t.mater_vcodbar.valid)&&((null==t.mater_vcodbar?null:t.mater_vcodbar.touched)||(null==t.mater_vcodbar?null:t.mater_vcodbar.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.invalid)&&(null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.touched))("ng-dirty",(null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.invalid)&&(null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.touched))("ng-valid",(null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.valid)&&((null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.touched)||(null==t.mater_ntipomanejo?null:t.mater_ntipomanejo.dirty))),e.Q6J("options",t.manejosInv)("filter",!1)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_nprecio?null:t.mater_nprecio.invalid)&&(null==t.mater_nprecio?null:t.mater_nprecio.touched))("ng-dirty",(null==t.mater_nprecio?null:t.mater_nprecio.invalid)&&(null==t.mater_nprecio?null:t.mater_nprecio.touched))("ng-valid",(null==t.mater_nprecio?null:t.mater_nprecio.valid)&&((null==t.mater_nprecio?null:t.mater_nprecio.touched)||(null==t.mater_nprecio?null:t.mater_nprecio.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_ncosto?null:t.mater_ncosto.invalid)&&(null==t.mater_ncosto?null:t.mater_ncosto.touched))("ng-dirty",(null==t.mater_ncosto?null:t.mater_ncosto.invalid)&&(null==t.mater_ncosto?null:t.mater_ncosto.touched))("ng-valid",(null==t.mater_ncosto?null:t.mater_ncosto.valid)&&((null==t.mater_ncosto?null:t.mater_ncosto.touched)||(null==t.mater_ncosto?null:t.mater_ncosto.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_vimpuestos?null:t.mater_vimpuestos.invalid)&&(null==t.mater_vimpuestos?null:t.mater_vimpuestos.touched))("ng-dirty",(null==t.mater_vimpuestos?null:t.mater_vimpuestos.invalid)&&(null==t.mater_vimpuestos?null:t.mater_vimpuestos.touched))("ng-valid",(null==t.mater_vimpuestos?null:t.mater_vimpuestos.valid)&&((null==t.mater_vimpuestos?null:t.mater_vimpuestos.touched)||(null==t.mater_vimpuestos?null:t.mater_vimpuestos.dirty))),e.Q6J("options",t.impuestos)("filter",!1)("virtualScroll",t.impuestos.length>5)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_nisvincluido?null:t.mater_nisvincluido.invalid)&&(null==t.mater_nisvincluido?null:t.mater_nisvincluido.touched))("ng-dirty",(null==t.mater_nisvincluido?null:t.mater_nisvincluido.invalid)&&(null==t.mater_nisvincluido?null:t.mater_nisvincluido.touched))("ng-valid",(null==t.mater_nisvincluido?null:t.mater_nisvincluido.valid)&&((null==t.mater_nisvincluido?null:t.mater_nisvincluido.touched)||(null==t.mater_nisvincluido?null:t.mater_nisvincluido.dirty))),e.Q6J("options",t.SiNo)("filter",!1)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.invalid)&&(null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.touched))("ng-dirty",(null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.invalid)&&(null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.touched))("ng-valid",(null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.valid)&&((null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.touched)||(null==t.mater_nmostrarfact?null:t.mater_nmostrarfact.dirty))),e.Q6J("options",t.SiNo)("filter",!1)("virtualScrollItemSize",38),e.xp6(5),e.Q6J("disabled",!t.validarForm())("loading",t.guardando)("label",t.material&&t.material.mater_nid?"Editar":"Guardar"))},dependencies:[m._Y,m.Fj,m.wV,m.JJ,m.JL,m.Q7,m.sg,m.u,A.Hq,S.H,y.o,E.Lt],styles:[".ng-valid[_ngcontent-%COMP%]{border-color:#2ecc71!important}"]})),a})();function R(a,l){1&a&&(e.TgZ(0,"div",22)(1,"h3",23),e._uU(2,"Listado de materiales"),e.qZA()())}function B(a,l){if(1&a){const i=e.EpF();e._UZ(0,"p-fileUpload",24),e.TgZ(1,"button",25),e.NdJ("click",function(){e.CHM(i),e.oxw();const n=e.MAs(8);return e.KtG(n.exportCSV())}),e.qZA()}2&a&&e.Q6J("maxFileSize",1e6)}function H(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",34),e.NdJ("click",function(){e.CHM(i);const n=e.oxw(2);return e.KtG(n.deleteSelectedItems())}),e.qZA()}if(2&a){const i=e.oxw(2);e.Q6J("disabled",!i.selectedData||!i.selectedData.length)}}function O(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",35),e.NdJ("click",function(){e.CHM(i);const n=e.oxw(2);return e.KtG(n.restartSelectedItems())}),e.qZA()}if(2&a){const i=e.oxw(2);e.Q6J("disabled",!i.selectedData||!i.selectedData.length)}}const Q=function(){return{float:"right"}};function Y(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"div",26)(1,"span",27)(2,"input",28),e.NdJ("input",function(n){e.CHM(i);const o=e.oxw(),d=e.MAs(8);return e.KtG(o.onGlobalFilter(d,n))}),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.getData())}),e.qZA(),e.TgZ(4,"button",30),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.openNew())}),e.qZA(),e.YNc(5,H,1,1,"button",31),e.YNc(6,O,1,1,"button",32),e.TgZ(7,"p-selectButton",33),e.NdJ("ngModelChange",function(n){e.CHM(i);const o=e.oxw();return e.KtG(o.dataValue=n)})("click",function(){e.CHM(i);const n=e.oxw();return n.getData(),e.KtG(n.clearDataSelected())}),e.qZA()()()}if(2&a){const i=e.oxw();e.xp6(5),e.Q6J("ngIf",i.dataValue&&1===i.dataValue[0]),e.xp6(1),e.Q6J("ngIf",i.dataValue&&0===i.dataValue[0]),e.xp6(1),e.Q6J("options",i.dataOptions)("ngModel",i.dataValue)("ngStyle",e.DdM(5,Q))}}function G(a,l){if(1&a&&(e.TgZ(0,"th",38),e._uU(1),e._UZ(2,"p-sortIcon",39),e.qZA()),2&a){const i=l.$implicit;e.ekj("rowStyle","ID"!==i.header)("rowStyleId","ID"===i.header),e.Q6J("pSortableColumn",i.field),e.xp6(1),e.hij(" ",i.header," "),e.xp6(1),e.Q6J("field",i.field)}}function L(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"th",36),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Acciones"),e.qZA(),e.YNc(5,G,3,7,"th",37),e.qZA()),2&a){const i=e.oxw();e.xp6(5),e.Q6J("ngForOf",i.cols)}}function K(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(i);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.editRow(n))}),e.qZA()}}function P(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",47),e.NdJ("click",function(){e.CHM(i);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.deleteRow(n))}),e.qZA()}}function z(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",48),e.NdJ("click",function(){e.CHM(i);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.restartRow(n))}),e.qZA()}}function $(a,l){if(1&a&&(e.TgZ(0,"td")(1,"span",49),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&a){const i=l.$implicit,t=e.oxw().$implicit;e.xp6(2),e.Oqu(i.header),e.xp6(1),e.hij(" ",t[i.field]," ")}}function X(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"p-tableCheckbox",40),e.qZA(),e.TgZ(3,"td")(4,"div",41),e.YNc(5,K,1,0,"button",42),e.YNc(6,P,1,0,"button",43),e.YNc(7,z,1,0,"button",44),e.qZA()(),e.YNc(8,$,4,2,"td",45),e.qZA()),2&a){const i=l.$implicit,t=e.oxw();e.xp6(2),e.Q6J("value",i),e.xp6(3),e.Q6J("ngIf",i.mater_nsts>0),e.xp6(1),e.Q6J("ngIf",i.mater_nsts>0),e.xp6(1),e.Q6J("ngIf",i.mater_nsts<1),e.xp6(1),e.Q6J("ngForOf",t.cols)}}function W(a,l){if(1&a&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres eliminar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&a){const i=e.oxw();e.xp6(3),e.Oqu(i.item.mater_vdescripcion)}}function x(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.deleteItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",51),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.confirmDelete())}),e.qZA()}}function ee(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.deleteItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",51),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.confirmDeleteSelected())}),e.qZA()}}function te(a,l){if(1&a&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres restaurar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&a){const i=e.oxw();e.xp6(3),e.Oqu(i.item.mater_vdescripcion)}}function ie(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.restartItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",52),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.confirmRestart())}),e.qZA()}}function ne(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.restartItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",52),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.confirmRestartSelected())}),e.qZA()}}const ae=function(){return[10,20,30]},I=function(){return{width:"750px"}},g=function(){return{width:"450px"}},re=[{path:"",component:(()=>{class a{constructor(i,t,n,o,d){(0,r.Z)(this,"dbapi",void 0),(0,r.Z)(this,"messageService",void 0),(0,r.Z)(this,"currencyPipe",void 0),(0,r.Z)(this,"authS",void 0),(0,r.Z)(this,"skNsCore",void 0),(0,r.Z)(this,"createDialog",!1),(0,r.Z)(this,"editDialog",!1),(0,r.Z)(this,"deleteItemDialog",!1),(0,r.Z)(this,"deleteItemsDialog",!1),(0,r.Z)(this,"restartItemDialog",!1),(0,r.Z)(this,"restartItemsDialog",!1),(0,r.Z)(this,"isLoadingTable",!1),(0,r.Z)(this,"data",[]),(0,r.Z)(this,"item",{}),(0,r.Z)(this,"selectedData",[]),(0,r.Z)(this,"submitted",!1),(0,r.Z)(this,"cols",[]),(0,r.Z)(this,"statuses",[]),(0,r.Z)(this,"dataOptions",[]),(0,r.Z)(this,"dataValue",[1]),(0,r.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,r.Z)(this,"$destroy",new Z.x),this.dbapi=i,this.messageService=t,this.currencyPipe=n,this.authS=o,this.skNsCore=d,o.\u00f8bserverCompanySelected.pipe((0,_.R)(this.$destroy)).subscribe(M=>{this.getData()}),d.fromEvent("/inventario/materiales+"+this.authS.isValidCia(!1).toString()).pipe((0,_.R)(this.$destroy)).subscribe(M=>{this.skNsCore.socketId!=M&&(console.log("Event socket: materiales"),this.getData())}),this.cols=[{field:"mater_nid",header:"ID"},{field:"cia_vnombre",header:"Compa\xf1\xeda"},{field:"mater_vcodigo",header:"C\xf3digo"},{field:"mater_vnombre",header:"Nombre"},{field:"mater_vdescripcion",header:"Descripci\xf3n"},{field:"mater_nprecio",header:"Precio"},{field:"mater_ncosto",header:"Costo"},{field:"mater_vtipomanejo",header:"T. Manejo"},{field:"mater_visvincluido",header:"ISV. Incluido"},{field:"mater_vmostrarfact",header:"Mostrar fact."},{field:"mater_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}]}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,D.U)(i=>(i.forEach(t=>{t.cia_vnombre=t.cias?t.cias.cia_vnombre:"",t.mater_vtipomanejo=1==t.mater_ntipomanejo?"INV.":"NO INV.",t.mater_vmostrarfact=1==t.mater_nmostrarfact?"SI":"NO",t.mater_visvincluido=1==t.mater_nisvincluido?"SI":"NO",t.mater_vsts=1==t.mater_nsts?"ACTIVO":"ELIMINADO"}),i)),(0,u.q)(1)).subscribe({next:i=>{this.data=[...i],this.isLoadingTable=!1},error:i=>{console.log(i),this.isLoadingTable=!1,this.editEvent({type:"error",title:"Ha ocurrido un error",message:i})}})}ngOnInit(){}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}editRow(i){this.item={...i},this.editDialog=!0}deleteRow(i){this.deleteItemDialog=!0,this.item={...i}}deleteSelectedItems(){this.deleteItemsDialog=!0}confirmDeleteSelected(){const i=[];this.selectedData.forEach(t=>{i.push({mater_nid:t.mater_nid,mater_nsts:0})}),this.dbapi.setBulkSts(i).pipe((0,u.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/inventario/materiales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmDelete(){this.dbapi.setSts({mater_nid:this.item.mater_nid,mater_nsts:0}).pipe((0,u.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.skNsCore.notificarUpsert("/inventario/materiales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.deleteItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}restartRow(i){this.restartItemDialog=!0,this.item={...i}}restartSelectedItems(){this.restartItemsDialog=!0}confirmRestart(){this.dbapi.setSts({mater_nid:this.item.mater_nid,mater_nsts:1}).pipe((0,u.q)(1)).subscribe({next:t=>{this.skNsCore.notificarUpsert("/inventario/materiales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmRestartSelected(){const i=[];this.selectedData.forEach(t=>{i.push({mater_nid:t.mater_nid,mater_nsts:1})}),this.dbapi.setBulkSts(i).pipe((0,u.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/inventario/materiales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}clearDataSelected(){this.selectedData=[]}findIndexById(i){let t=-1;for(let n=0;n<this.data.length;n++)if(this.data[n].mater_nid===i){t=n;break}return t}onGlobalFilter(i,t){i.filterGlobal(t.target.value,"contains")}editEvent(i){this.messageService.add({severity:i.type,summary:i.title,detail:i.message,life:3e3}),"success"==i.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,r.Z)(a,"\u0275fac",function(i){return new(i||a)(e.Y36(C),e.Y36(h.ez),e.Y36(p.H9),e.Y36(v.e),e.Y36(T.pP))}),(0,r.Z)(a,"\u0275cmp",e.Xpm({type:a,selectors:[["ng-component"]],features:[e._Bn([h.ez])],decls:38,vars:45,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","mater_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear material",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar material",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"material","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1","mt-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1","mt-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1","mt-1",3,"click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash","class","p-button-danger mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay","class","p-button-help mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash",1,"p-button-danger","mr-1","ml-1","mt-1",3,"disabled","click"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay",1,"p-button-help","mr-1","ml-1","mt-1",3,"disabled","click"],[2,"width","3rem"],[3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","title","Editar","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil","title","Editar",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"p-toast",3),e.TgZ(4,"p-toolbar",4),e.YNc(5,R,3,0,"ng-template",5),e.YNc(6,B,2,1,"ng-template",6),e.qZA(),e.TgZ(7,"p-table",7,8),e.NdJ("selectionChange",function(o){return t.selectedData=o}),e.YNc(9,Y,8,6,"ng-template",9),e.YNc(10,L,6,1,"ng-template",10),e.YNc(11,X,9,5,"ng-template",11),e.qZA()(),e.TgZ(12,"p-dialog",12),e.NdJ("visibleChange",function(o){return t.createDialog=o}),e.TgZ(13,"app-create-materiales",13),e.NdJ("edit",function(o){return t.editEvent(o)}),e.qZA()(),e.TgZ(14,"p-dialog",14),e.NdJ("visibleChange",function(o){return t.editDialog=o}),e.TgZ(15,"app-create-materiales",15),e.NdJ("edit",function(o){return t.editEvent(o)}),e.qZA()(),e.TgZ(16,"p-dialog",16),e.NdJ("visibleChange",function(o){return t.deleteItemDialog=o}),e.TgZ(17,"div",17),e._UZ(18,"i",18),e.YNc(19,W,5,1,"span",19),e.qZA(),e.YNc(20,x,2,0,"ng-template",20),e.qZA(),e.TgZ(21,"p-dialog",21),e.NdJ("visibleChange",function(o){return t.deleteItemsDialog=o}),e.TgZ(22,"div",17),e._UZ(23,"i",18),e.TgZ(24,"span"),e._uU(25,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),e.qZA()(),e.YNc(26,ee,2,0,"ng-template",20),e.qZA(),e.TgZ(27,"p-dialog",16),e.NdJ("visibleChange",function(o){return t.restartItemDialog=o}),e.TgZ(28,"div",17),e._UZ(29,"i",18),e.YNc(30,te,5,1,"span",19),e.qZA(),e.YNc(31,ie,2,0,"ng-template",20),e.qZA(),e.TgZ(32,"p-dialog",21),e.NdJ("visibleChange",function(o){return t.restartItemsDialog=o}),e.TgZ(33,"div",17),e._UZ(34,"i",18),e.TgZ(35,"span"),e._uU(36,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),e.qZA()(),e.YNc(37,ne,2,0,"ng-template",20),e.qZA()()()),2&i&&(e.xp6(7),e.Q6J("value",t.data)("columns",t.cols)("rows",10)("globalFilterFields",t.cols)("rows",10)("paginator",!0)("loading",t.isLoadingTable)("rowsPerPageOptions",e.DdM(38,ae))("showCurrentPageReport",!0)("selection",t.selectedData)("rowHover",!0),e.xp6(5),e.Akn(e.DdM(39,I)),e.Q6J("visible",t.createDialog)("modal",!0),e.xp6(2),e.Akn(e.DdM(40,I)),e.Q6J("visible",t.editDialog)("modal",!0),e.xp6(1),e.Q6J("material",t.item),e.xp6(1),e.Akn(e.DdM(41,g)),e.Q6J("visible",t.deleteItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",t.item),e.xp6(2),e.Akn(e.DdM(42,g)),e.Q6J("visible",t.deleteItemsDialog)("modal",!0),e.xp6(6),e.Akn(e.DdM(43,g)),e.Q6J("visible",t.restartItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",t.item),e.xp6(2),e.Akn(e.DdM(44,g)),e.Q6J("visible",t.restartItemsDialog)("modal",!0))},dependencies:[p.sg,p.O5,p.PC,m.JJ,m.On,c.iA,h.jx,c.lQ,c.fz,c.UA,c.Mo,F.p,A.Hq,J.UN,S.H,w.FN,U.o,y.o,j.V,V],styles:[".rowStyle[_ngcontent-%COMP%]{width:14%;min-width:10rem}.rowStyleId[_ngcontent-%COMP%]{width:10%;min-width:6rem}"]})),a})()}];let oe=(()=>{class a{}return(0,r.Z)(a,"\u0275fac",function(i){return new(i||a)}),(0,r.Z)(a,"\u0275mod",e.oAB({type:a})),(0,r.Z)(a,"\u0275inj",e.cJS({providers:[p.H9],imports:[N.m,b.Bz.forChild(re)]})),a})()}}]);