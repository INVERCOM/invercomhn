"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[1413],{1413:(re,f,s)=>{s.r(f),s.d(f,{VentaLotesModule:()=>ae});var i=s(1180),I=s(7246),b=s(1380),c=s(805),Z=s(7579),h=s(2722),k=s(4004),d=s(5698),e=s(4650),q=s(2340),N=s(529),g=s(629);let C=(()=>{class o{constructor(n,t,l){(0,i.Z)(this,"http",void 0),(0,i.Z)(this,"authS",void 0),(0,i.Z)(this,"router",void 0),(0,i.Z)(this,"_prefix",q.H+"/api/ventaslotes"),this.http=n,this.authS=t,this.router=l}getAll(n){return this.authS.refreshToken(),this.http.post(this._prefix+"/getall",{cia_nids:this.authS.isValidCia(!1),lote_nsts:n})}save(n){const t={...n,...this.authS.getUsuarioLog()};return this.http.post(this._prefix+"/save",t)}setSts(n){return this.http.post(this._prefix+"/setsts/"+n.venlot_nid,{lote_nsts:n.venlot_nsts,...this.authS.getUsuarioLog()})}setBulkSts(n){return this.http.post(this._prefix+"/setbullksts",{data:n,...this.authS.getUsuarioLog()})}getLotes(){return this.http.post(this._prefix+"/lotes/getall",{lote_nsts:[1],sucu_nids:this.authS.getSucursalSelected()})}getClientes(){return this.http.post(this._prefix+"/clientes/getall",{cia_nids:this.authS.isValidCia(!1)})}}return(0,i.Z)(o,"\u0275fac",function(n){return new(n||o)(e.LFG(N.eN),e.LFG(g.e),e.LFG(b.F0))}),(0,i.Z)(o,"\u0275prov",e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})),o})();var p=s(6895),T=s(1168),u=s(4006),v=s(99),F=s(3388),y=s(5593),J=s(5362),A=s(1795),U=s(2453),V=s(1383),L=s(1740),w=s(1493),M=s(2210);let E=(()=>{class o{constructor(n,t,l,a){(0,i.Z)(this,"dbapi",void 0),(0,i.Z)(this,"_builder",void 0),(0,i.Z)(this,"authS",void 0),(0,i.Z)(this,"skNsCore",void 0),(0,i.Z)(this,"createForm",void 0),(0,i.Z)(this,"lotes",[]),(0,i.Z)(this,"clientes",[]),(0,i.Z)(this,"guardando",!1),(0,i.Z)(this,"itemDialog",!1),(0,i.Z)(this,"submitted",!1),(0,i.Z)(this,"$destroy",new Z.x),(0,i.Z)(this,"ventaLote",{}),(0,i.Z)(this,"edit",new e.vpe),this.dbapi=n,this._builder=t,this.authS=l,this.skNsCore=a,a.fromEvent("/proyectos/lotes").pipe((0,h.R)(this.$destroy)).subscribe(_=>{console.log("Event socket: lotes"),this.getLotes()}),a.fromEvent("/ventas/clientes").pipe((0,h.R)(this.$destroy)).subscribe(_=>{console.log("Event socket: clientes"),this.getClientes()}),this.createForm=t.group({venlot_nid:[0],lote_nid:["",u.kI.required],cli_nid:["",u.kI.required],venlot_dfecha:["",u.kI.required],venlot_fprecio:["",u.kI.required],venlot_fprima:["",u.kI.required],venlot_fvalorfinal:["",u.kI.required],venlot_ftasainteresanual:["",u.kI.required],venlot_nnumeromeses:["",u.kI.required],venlot_ndiapago:["",u.kI.required],venlot_ndiamaxpago:["",u.kI.required],venlot_fcuotanivelada:["",u.kI.required],venlot_dfechaprimerpago:["",u.kI.required],venlot_vobservaciones:[""],venlot_nsts:[""]}),this.getLotes(),this.getClientes()}ngOnInit(){}ngOnChanges(){this.ventaLote&&this.ventaLote?.venlot_nid&&this.ventaLote?.venlot_nid>0&&(this.venlot_nid?.setValue(this.ventaLote?.venlot_nid),this.lote_nid?.setValue(this.searchById(this.ventaLote?.lote_nid,this.lotes)),this.cli_nid?.setValue(this.searchById(this.ventaLote?.cli_nid,this.clientes)),this.venlot_dfecha?.setValue(this.ventaLote?.venlot_dfecha),this.venlot_fprecio?.setValue(this.ventaLote?.venlot_fprecio),this.venlot_fprima?.setValue(this.ventaLote?.venlot_fprima),this.venlot_fvalorfinal?.setValue(this.ventaLote?.venlot_fvalorfinal),this.venlot_ftasainteresanual?.setValue(this.ventaLote?.venlot_ftasainteresanual),this.venlot_nnumeromeses?.setValue(this.ventaLote?.venlot_nnumeromeses),this.venlot_ndiapago?.setValue(this.ventaLote?.venlot_ndiapago),this.venlot_ndiamaxpago?.setValue(this.ventaLote?.venlot_ndiamaxpago),this.venlot_fcuotanivelada?.setValue(this.ventaLote?.venlot_fcuotanivelada),this.venlot_dfechaprimerpago?.setValue(this.ventaLote?.venlot_dfechaprimerpago),this.venlot_vobservaciones?.setValue(this.ventaLote?.venlot_vobservaciones),this.venlot_nsts?.setValue(this.ventaLote?.venlot_nsts))}getLotes(){this.lotes=[{id:"",text:"...",obj:{}}],this.lote_nid?.setValue(""),this.dbapi.getLotes().pipe((0,d.q)(1)).subscribe({next:n=>{if(n&&null!=n&&""!==n)for(const t in n)this.lotes=[...this.lotes,{id:n[t].lote_nid,text:n[t].lote_vcodigo+" - "+n[t].lote_vnombre,obj:n[t]}];else console.log("Error consultando unidades de medida")},error:n=>{console.log(n),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:n})}})}getClientes(){this.clientes=[{id:"",text:"...",obj:{}}],this.cli_nid?.setValue(""),this.dbapi.getClientes().pipe((0,d.q)(1)).subscribe({next:n=>{if(n&&null!=n&&""!==n)for(const t in n)this.clientes=[...this.clientes,{id:n[t].cli_nid,text:n[t].cli_videntidad+" - "+n[t].cli_vnombre,obj:n[t]}];else console.log("Error consultando unidades de medida")},error:n=>{console.log(n),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:n})}})}save(){this.createForm.valid&&!this.guardando&&(this.guardando=!0,this.dbapi.save({venlot_nid:this.venlot_nid?.value>0?this.venlot_nid?.value:null,lote_nid:this.lote_nid?.value.id,cli_nid:this.cli_nid?.value.id,venlot_dfecha:this.venlot_dfecha?.value,venlot_fprecio:this.venlot_fprecio?.value,venlot_fprima:this.venlot_fprima?.value,venlot_fvalorfinal:this.venlot_fvalorfinal?.value,venlot_ftasainteresanual:this.venlot_ftasainteresanual?.value,venlot_nnumeromeses:this.venlot_nnumeromeses?.value,venlot_ndiapago:this.venlot_ndiapago?.value,venlot_ndiamaxpago:this.venlot_ndiamaxpago?.value,venlot_fcuotanivelada:this.venlot_fcuotanivelada?.value,venlot_dfechaprimerpago:this.venlot_dfechaprimerpago?.value,venlot_vobservaciones:this.venlot_vobservaciones?.value,venlot_nsts:1}).pipe((0,d.q)(1)).subscribe({next:t=>{"success"==t.type&&(this.skNsCore.notificarUpsert("/proyectos/ventaLotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.getLotes(),this.limpiarForm()),this.guardando=!1,this.edit.emit(t)},error:t=>{console.log(t),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}}))}limpiarForm(){this.createForm.reset(),this.venlot_nid?.setValue(0)}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(n,t){for(let l=0;l<t.length;l++){const a=t[l];if(a.id==n)return a}return""}setPrecio(n){let t="";n&&n.value&&n.value.id>0&&(t=n.value.obj.lote_fprecio),this.venlot_fprecio?.setValue(t),this.setValorFinal()}setValorFinal(){let n="";this.venlot_fprecio?.value>-1&&this.venlot_fprima?.value>-1&&(n=this.venlot_fprecio?.value-this.venlot_fprima?.value),this.venlot_fvalorfinal?.setValue(n),this.setCuotraMensual()}setCuotraMensual(){let n=0;this.venlot_fvalorfinal?.value>-1&&this.venlot_nnumeromeses?.value>0&&(n=parseFloat((this.venlot_fvalorfinal?.value/this.venlot_nnumeromeses?.value).toFixed(2))),this.venlot_fcuotanivelada?.setValue(n)}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get venlot_nid(){return this.createForm.get("venlot_nid")}get lote_nid(){return this.createForm.get("lote_nid")}get cli_nid(){return this.createForm.get("cli_nid")}get venlot_dfecha(){return this.createForm.get("venlot_dfecha")}get venlot_fprecio(){return this.createForm.get("venlot_fprecio")}get venlot_fprima(){return this.createForm.get("venlot_fprima")}get venlot_fvalorfinal(){return this.createForm.get("venlot_fvalorfinal")}get venlot_ftasainteresanual(){return this.createForm.get("venlot_ftasainteresanual")}get venlot_nnumeromeses(){return this.createForm.get("venlot_nnumeromeses")}get venlot_ndiapago(){return this.createForm.get("venlot_ndiapago")}get venlot_ndiamaxpago(){return this.createForm.get("venlot_ndiamaxpago")}get venlot_fcuotanivelada(){return this.createForm.get("venlot_fcuotanivelada")}get venlot_dfechaprimerpago(){return this.createForm.get("venlot_dfechaprimerpago")}get venlot_vobservaciones(){return this.createForm.get("venlot_vobservaciones")}get venlot_nsts(){return this.createForm.get("venlot_nsts")}}return(0,i.Z)(o,"\u0275fac",function(n){return new(n||o)(e.Y36(C),e.Y36(u.qu),e.Y36(g.e),e.Y36(T.pP))}),(0,i.Z)(o,"\u0275cmp",e.Xpm({type:o,selectors:[["app-create-ventas-lotes"]],inputs:{ventaLote:"ventaLote"},outputs:{edit:"edit"},features:[e.TTD],decls:69,vars:92,consts:[[1,"row"],[1,"col-12"],[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-4"],["optionLabel","text","formControlName","lote_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize","onChange"],["optionLabel","text","formControlName","cli_nid","filterBy","text",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","venlot_dfecha","type","date","required",""],["pInputText","","formControlName","venlot_fprecio","type","number","required","",3,"change"],["pInputText","","formControlName","venlot_fprima","type","number","required","",3,"change"],["pInputText","","formControlName","venlot_fvalorfinal","type","number","required","",3,"readonly"],["pInputText","","formControlName","venlot_ftasainteresanual","type","number","required","",3,"change"],["pInputText","","formControlName","venlot_nnumeromeses","type","number","required","",3,"change"],["pInputText","","formControlName","venlot_ndiapago","type","number","required",""],["pInputText","","formControlName","venlot_ndiamaxpago","type","number","required",""],["pInputText","","formControlName","venlot_fcuotanivelada","type","number","required","",3,"readonly"],["pInputText","","formControlName","venlot_dfechaprimerpago","type","date"],["pInputText","","formControlName","venlot_vobservaciones","type","text"],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),e.NdJ("ngSubmit",function(){return t.save()}),e.TgZ(4,"div",4)(5,"label",5),e._uU(6,"Lote"),e.qZA(),e.TgZ(7,"div",6)(8,"p-dropdown",7),e.NdJ("onChange",function(a){return t.setPrecio(a)}),e.qZA()(),e.TgZ(9,"label",5),e._uU(10,"Cliente"),e.qZA(),e.TgZ(11,"div",6),e._UZ(12,"p-dropdown",8),e.qZA()(),e.TgZ(13,"div",4)(14,"label",5),e._uU(15,"Fecha venta"),e.qZA(),e.TgZ(16,"div",6),e._UZ(17,"input",9),e.qZA(),e.TgZ(18,"label",5),e._uU(19,"Precio total"),e.qZA(),e.TgZ(20,"div",6)(21,"input",10),e.NdJ("change",function(){return t.setValorFinal()}),e.qZA()()(),e.TgZ(22,"div",4)(23,"label",5),e._uU(24,"Prima"),e.qZA(),e.TgZ(25,"div",6)(26,"input",11),e.NdJ("change",function(){return t.setValorFinal()}),e.qZA()(),e.TgZ(27,"label",5),e._uU(28,"Valor final"),e.qZA(),e.TgZ(29,"div",6),e._UZ(30,"input",12),e.qZA()(),e.TgZ(31,"div",4)(32,"label",5),e._uU(33,"Tasa interes anual"),e.qZA(),e.TgZ(34,"div",6)(35,"input",13),e.NdJ("change",function(){return t.setCuotraMensual()}),e.qZA()(),e.TgZ(36,"label",5),e._uU(37,"Numero de meses"),e.qZA(),e.TgZ(38,"div",6)(39,"input",14),e.NdJ("change",function(){return t.setCuotraMensual()}),e.qZA()()(),e.TgZ(40,"div",4)(41,"label",5),e._uU(42,"Dia de pago"),e.qZA(),e.TgZ(43,"div",6),e._UZ(44,"input",15),e.qZA(),e.TgZ(45,"label",5),e._uU(46,"Dia m\xe1ximo de pago"),e.qZA(),e.TgZ(47,"div",6),e._UZ(48,"input",16),e.qZA()(),e.TgZ(49,"div",4)(50,"label",5),e._uU(51,"Cuaota mensual"),e.qZA(),e.TgZ(52,"div",6),e._UZ(53,"input",17),e.qZA(),e.TgZ(54,"label",5),e._uU(55,"Fecha primer pago"),e.qZA(),e.TgZ(56,"div",6),e._UZ(57,"input",18),e.qZA()(),e.TgZ(58,"div",4)(59,"label",5),e._uU(60,"Observaciones"),e.qZA(),e.TgZ(61,"div",6),e._UZ(62,"input",19),e.qZA()(),e._UZ(63,"hr"),e.TgZ(64,"div",4)(65,"div",20)(66,"span",21),e._UZ(67,"button",22),e.TgZ(68,"button",23),e.NdJ("click",function(){return t.limpiarForm()}),e.qZA()()()()()()()()),2&n&&(e.xp6(3),e.Q6J("formGroup",t.createForm),e.xp6(5),e.ekj("ng-invalid",(null==t.lote_nid?null:t.lote_nid.invalid)&&(null==t.lote_nid?null:t.lote_nid.touched))("ng-dirty",(null==t.lote_nid?null:t.lote_nid.invalid)&&(null==t.lote_nid?null:t.lote_nid.touched))("ng-valid",(null==t.lote_nid?null:t.lote_nid.valid)&&((null==t.lote_nid?null:t.lote_nid.touched)||(null==t.lote_nid?null:t.lote_nid.dirty))),e.Q6J("options",t.lotes)("filter",!0)("virtualScroll",t.lotes.length>5)("virtualScrollItemSize",38),e.xp6(4),e.ekj("ng-invalid",(null==t.cli_nid?null:t.cli_nid.invalid)&&(null==t.cli_nid?null:t.cli_nid.touched))("ng-dirty",(null==t.cli_nid?null:t.cli_nid.invalid)&&(null==t.cli_nid?null:t.cli_nid.touched))("ng-valid",(null==t.cli_nid?null:t.cli_nid.valid)&&((null==t.cli_nid?null:t.cli_nid.touched)||(null==t.cli_nid?null:t.cli_nid.dirty))),e.Q6J("options",t.clientes)("filter",!0)("virtualScroll",t.clientes.length>5)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==t.venlot_dfecha?null:t.venlot_dfecha.invalid)&&(null==t.venlot_dfecha?null:t.venlot_dfecha.touched))("ng-dirty",(null==t.venlot_dfecha?null:t.venlot_dfecha.invalid)&&(null==t.venlot_dfecha?null:t.venlot_dfecha.touched))("ng-valid",(null==t.venlot_dfecha?null:t.venlot_dfecha.valid)&&((null==t.venlot_dfecha?null:t.venlot_dfecha.touched)||(null==t.venlot_dfecha?null:t.venlot_dfecha.dirty))),e.xp6(4),e.ekj("ng-invalid",(null==t.venlot_fprecio?null:t.venlot_fprecio.invalid)&&(null==t.venlot_fprecio?null:t.venlot_fprecio.touched))("ng-dirty",(null==t.venlot_fprecio?null:t.venlot_fprecio.invalid)&&(null==t.venlot_fprecio?null:t.venlot_fprecio.touched))("ng-valid",(null==t.venlot_fprecio?null:t.venlot_fprecio.valid)&&((null==t.venlot_fprecio?null:t.venlot_fprecio.touched)||(null==t.venlot_fprecio?null:t.venlot_fprecio.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.venlot_fprima?null:t.venlot_fprima.invalid)&&(null==t.venlot_fprima?null:t.venlot_fprima.touched))("ng-dirty",(null==t.venlot_fprima?null:t.venlot_fprima.invalid)&&(null==t.venlot_fprima?null:t.venlot_fprima.touched))("ng-valid",(null==t.venlot_fprima?null:t.venlot_fprima.valid)&&((null==t.venlot_fprima?null:t.venlot_fprima.touched)||(null==t.venlot_fprima?null:t.venlot_fprima.dirty))),e.xp6(4),e.ekj("ng-invalid",(null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.invalid)&&(null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.touched))("ng-dirty",(null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.invalid)&&(null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.touched))("ng-valid",(null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.valid)&&((null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.touched)||(null==t.venlot_fvalorfinal?null:t.venlot_fvalorfinal.dirty))),e.Q6J("readonly",!0),e.xp6(5),e.ekj("ng-invalid",(null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.invalid)&&(null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.touched))("ng-dirty",(null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.invalid)&&(null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.touched))("ng-valid",(null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.valid)&&((null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.touched)||(null==t.venlot_ftasainteresanual?null:t.venlot_ftasainteresanual.dirty))),e.xp6(4),e.ekj("ng-invalid",(null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.invalid)&&(null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.touched))("ng-dirty",(null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.invalid)&&(null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.touched))("ng-valid",(null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.valid)&&((null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.touched)||(null==t.venlot_nnumeromeses?null:t.venlot_nnumeromeses.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.venlot_ndiapago?null:t.venlot_ndiapago.invalid)&&(null==t.venlot_ndiapago?null:t.venlot_ndiapago.touched))("ng-dirty",(null==t.venlot_ndiapago?null:t.venlot_ndiapago.invalid)&&(null==t.venlot_ndiapago?null:t.venlot_ndiapago.touched))("ng-valid",(null==t.venlot_ndiapago?null:t.venlot_ndiapago.valid)&&((null==t.venlot_ndiapago?null:t.venlot_ndiapago.touched)||(null==t.venlot_ndiapago?null:t.venlot_ndiapago.dirty))),e.xp6(4),e.ekj("ng-invalid",(null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.invalid)&&(null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.touched))("ng-dirty",(null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.invalid)&&(null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.touched))("ng-valid",(null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.valid)&&((null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.touched)||(null==t.venlot_ndiamaxpago?null:t.venlot_ndiamaxpago.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.invalid)&&(null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.touched))("ng-dirty",(null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.invalid)&&(null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.touched))("ng-valid",(null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.valid)&&((null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.touched)||(null==t.venlot_fcuotanivelada?null:t.venlot_fcuotanivelada.dirty))),e.Q6J("readonly",!0),e.xp6(4),e.ekj("ng-invalid",(null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.invalid)&&(null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.touched))("ng-dirty",(null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.invalid)&&(null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.touched))("ng-valid",(null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.valid)&&((null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.touched)||(null==t.venlot_dfechaprimerpago?null:t.venlot_dfechaprimerpago.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.invalid)&&(null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.touched))("ng-dirty",(null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.invalid)&&(null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.touched))("ng-valid",(null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.valid)&&((null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.touched)||(null==t.venlot_vobservaciones?null:t.venlot_vobservaciones.dirty))),e.xp6(5),e.Q6J("disabled",!t.createForm.valid)("loading",t.guardando)("label",t.ventaLote&&t.ventaLote.venlot_nid?"Editar":"Guardar"))},dependencies:[u._Y,u.Fj,u.wV,u.JJ,u.JL,u.Q7,u.sg,u.u,y.Hq,A.H,L.o,M.Lt]})),o})();function H(o,r){1&o&&(e.TgZ(0,"div",22)(1,"h3",23),e._uU(2,"Listado de ventas de lotes"),e.qZA()())}function R(o,r){if(1&o){const n=e.EpF();e._UZ(0,"p-fileUpload",24),e.TgZ(1,"button",25),e.NdJ("click",function(){e.CHM(n),e.oxw();const l=e.MAs(8);return e.KtG(l.exportCSV())}),e.qZA()}2&o&&e.Q6J("maxFileSize",1e6)}const B=function(){return{float:"right"}};function P(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"div",26)(1,"span",27)(2,"input",28),e.NdJ("input",function(l){e.CHM(n);const a=e.oxw(),_=e.MAs(8);return e.KtG(a.onGlobalFilter(_,l))}),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.getData())}),e.qZA(),e.TgZ(4,"button",30),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.openNew())}),e.qZA(),e.TgZ(5,"p-selectButton",31),e.NdJ("ngModelChange",function(l){e.CHM(n);const a=e.oxw();return e.KtG(a.dataValue=l)})("click",function(){e.CHM(n);const l=e.oxw();return l.getData(),e.KtG(l.clearDataSelected())}),e.qZA()()()}if(2&o){const n=e.oxw();e.xp6(5),e.Q6J("options",n.dataOptions)("ngModel",n.dataValue)("ngStyle",e.DdM(3,B))}}function Y(o,r){if(1&o&&(e.TgZ(0,"th",34),e._uU(1),e._UZ(2,"p-sortIcon",35),e.qZA()),2&o){const n=r.$implicit;e.ekj("rowStyle","ID"!==n.header)("rowStyleId","ID"===n.header),e.Q6J("pSortableColumn",n.field),e.xp6(1),e.hij(" ",n.header," "),e.xp6(1),e.Q6J("field",n.field)}}function Q(o,r){if(1&o&&(e.TgZ(0,"tr")(1,"th",32),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Acciones"),e.qZA(),e.YNc(5,Y,3,7,"th",33),e.qZA()),2&o){const n=e.oxw();e.xp6(5),e.Q6J("ngForOf",n.cols)}}function j(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",42),e.NdJ("click",function(){e.CHM(n);const l=e.oxw().$implicit,a=e.oxw();return e.KtG(a.editRow(l))}),e.qZA()}}function G(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",43),e.NdJ("click",function(){e.CHM(n);const l=e.oxw().$implicit,a=e.oxw();return e.KtG(a.deleteRow(l))}),e.qZA()}}function O(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",44),e.NdJ("click",function(){e.CHM(n);const l=e.oxw().$implicit,a=e.oxw();return e.KtG(a.restartRow(l))}),e.qZA()}}function K(o,r){if(1&o&&(e.TgZ(0,"td")(1,"span",45),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&o){const n=r.$implicit,t=e.oxw().$implicit;e.xp6(2),e.Oqu(n.header),e.xp6(1),e.hij(" ",t[n.field]," ")}}function $(o,r){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"p-tableCheckbox",36),e.qZA(),e.TgZ(3,"td")(4,"div",37),e.YNc(5,j,1,0,"button",38),e.YNc(6,G,1,0,"button",39),e.YNc(7,O,1,0,"button",40),e.qZA()(),e.YNc(8,K,4,2,"td",41),e.qZA()),2&o){const n=r.$implicit,t=e.oxw();e.xp6(2),e.Q6J("value",n),e.xp6(3),e.Q6J("ngIf",n.lote_nsts>0),e.xp6(1),e.Q6J("ngIf",n.lote_nsts>0),e.xp6(1),e.Q6J("ngIf",n.lote_nsts<1),e.xp6(1),e.Q6J("ngForOf",t.cols)}}function z(o,r){if(1&o&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres eliminar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&o){const n=e.oxw();e.xp6(3),e.Oqu(n.item.venlot_dfecha)}}function X(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.deleteItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",47),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.confirmDelete())}),e.qZA()}}function W(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.deleteItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",47),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.confirmDeleteSelected())}),e.qZA()}}function x(o,r){if(1&o&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres restaurar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&o){const n=e.oxw();e.xp6(3),e.Oqu(n.item.venlot_dfecha)}}function ee(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.restartItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",48),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.confirmRestart())}),e.qZA()}}function te(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.restartItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",48),e.NdJ("click",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.confirmRestartSelected())}),e.qZA()}}const ne=function(){return[10,20,30]},S=function(){return{width:"950px"}},m=function(){return{width:"450px"}};let le=(()=>{class o{constructor(n,t,l,a,_,D){(0,i.Z)(this,"dbapi",void 0),(0,i.Z)(this,"messageService",void 0),(0,i.Z)(this,"authS",void 0),(0,i.Z)(this,"currencyPipe",void 0),(0,i.Z)(this,"datePipe",void 0),(0,i.Z)(this,"skNsCore",void 0),(0,i.Z)(this,"createDialog",!1),(0,i.Z)(this,"editDialog",!1),(0,i.Z)(this,"deleteItemDialog",!1),(0,i.Z)(this,"deleteItemsDialog",!1),(0,i.Z)(this,"restartItemDialog",!1),(0,i.Z)(this,"restartItemsDialog",!1),(0,i.Z)(this,"isLoadingTable",!1),(0,i.Z)(this,"data",[]),(0,i.Z)(this,"item",{}),(0,i.Z)(this,"selectedData",[]),(0,i.Z)(this,"submitted",!1),(0,i.Z)(this,"cols",[]),(0,i.Z)(this,"statuses",[]),(0,i.Z)(this,"dataOptions",[]),(0,i.Z)(this,"dataValue",[1]),(0,i.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,i.Z)(this,"$destroy",new Z.x),this.dbapi=n,this.messageService=t,this.authS=l,this.currencyPipe=a,this.datePipe=_,this.skNsCore=D,D.fromEvent("/proyectos/ventaLotes").pipe((0,h.R)(this.$destroy)).subscribe(se=>{this.skNsCore.socketId!=se&&(console.log("Event socket: ventas lotes"),this.getData())}),this.cols=[{field:"venlot_nid",header:"ID"},{field:"lote_vnombre",header:"Lote"},{field:"cli_vnombre",header:"Cliente"},{field:"venlot_fpreciopipe",header:"Precio"},{field:"venlot_fprimapipe",header:"Prima"},{field:"venlot_fvalorfinalpipe",header:"Valor final"},{field:"venlot_fcuotaniveladapipe",header:"Cuota mensual"},{field:"venlot_dfechapipe",header:"Fecha"},{field:"venlot_dfechaprimerpagopipe",header:"Fecha primer pago"},{field:"venlot_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}],this.getData()}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,k.U)(n=>(n.forEach(t=>{t.lote_vnombre=t._tlotes?t._tlotes.lote_vnombre:"",t.cli_vnombre=t._tclis?t._tclis.cli_vnombre:"",t.venlot_fpreciopipe=this.currencyPipe.transform(t.venlot_fprecio," "),t.venlot_fprimapipe=this.currencyPipe.transform(t.venlot_fprima," "),t.venlot_fvalorfinalpipe=this.currencyPipe.transform(t.venlot_fvalorfinal," "),t.venlot_fcuotaniveladapipe=this.currencyPipe.transform(t.venlot_fcuotanivelada," "),t.venlot_dfechapipe=this.datePipe.transform(t.venlot_dfecha,"dd-MM-yyyy"),t.venlot_dfechaprimerpagopipe=this.datePipe.transform(t.venlot_dfechaprimerpago,"dd-MM-yyyy"),t.venlot_vsts=1==t.venlot_nsts?"ACTIVO":"ELIMINADO"}),n)),(0,d.q)(1)).subscribe({next:n=>{console.log(n),this.data=[...n],this.isLoadingTable=!1},error:n=>{console.log(n),this.isLoadingTable=!1,this.editEvent({type:"error",title:"Ha ocurrido un error",message:n})}})}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}restartSelectedItems(){this.restartItemsDialog=!0}editRow(n){this.item={...n},this.editDialog=!0}deleteRow(n){this.deleteItemDialog=!0,this.item={...n}}restartRow(n){this.restartItemDialog=!0,this.item={...n}}confirmDeleteSelected(){const n=[];this.selectedData.forEach(t=>{n.push({venlot_nid:t.venlot_nid,venlot_nsts:0})}),this.dbapi.setBulkSts(n).pipe((0,d.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmDelete(){this.dbapi.setSts({venlot_nid:this.item.venlot_nid,venlot_nsts:0}).pipe((0,d.q)(1)).subscribe({next:t=>{this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmRestart(){this.item.venlot_nsts=1,this.dbapi.setSts(this.item).pipe((0,d.q)(1)).subscribe({next:n=>{this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:n.type,summary:n.title,detail:n.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:n=>{console.log(n),this.editEvent({type:"error",title:"Ha ocurrido un error",message:n})}})}confirmRestartSelected(){this.selectedData.forEach(n=>{n.venlot_nsts=1}),this.item.venlot_nsts=1,this.dbapi.setBulkSts(this.selectedData).pipe((0,d.q)(1)).subscribe({next:n=>{this.messageService.add({severity:n.type,summary:n.title,detail:n.message,life:3e3}),"success"==n.type&&(this.skNsCore.notificarUpsert("/proyectos/lotes",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:n=>{console.log(n),this.editEvent({type:"error",title:"Ha ocurrido un error",message:n})}})}findIndexById(n){let t=-1;for(let l=0;l<this.data.length;l++)if(this.data[l].venlot_nid===n){t=l;break}return t}onGlobalFilter(n,t){n.filterGlobal(t.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}editEvent(n){this.messageService.add({severity:n.type,summary:n.title,detail:n.message,life:3e3}),"success"==n.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}clearDataSelected(){this.selectedData=[]}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,i.Z)(o,"\u0275fac",function(n){return new(n||o)(e.Y36(C),e.Y36(c.ez),e.Y36(g.e),e.Y36(p.H9),e.Y36(p.uU),e.Y36(T.pP))}),(0,i.Z)(o,"\u0275cmp",e.Xpm({type:o,selectors:[["ng-component"]],features:[e._Bn([c.ez])],decls:38,vars:45,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","unimed_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear lote",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar lote",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"ventaLote","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1",3,"click"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],[2,"width","3rem"],["style","width: 100rem",3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[2,"width","100rem",3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"p-toast",3),e.TgZ(4,"p-toolbar",4),e.YNc(5,H,3,0,"ng-template",5),e.YNc(6,R,2,1,"ng-template",6),e.qZA(),e.TgZ(7,"p-table",7,8),e.NdJ("selectionChange",function(a){return t.selectedData=a}),e.YNc(9,P,6,4,"ng-template",9),e.YNc(10,Q,6,1,"ng-template",10),e.YNc(11,$,9,5,"ng-template",11),e.qZA()(),e.TgZ(12,"p-dialog",12),e.NdJ("visibleChange",function(a){return t.createDialog=a}),e.TgZ(13,"app-create-ventas-lotes",13),e.NdJ("edit",function(a){return t.editEvent(a)}),e.qZA()(),e.TgZ(14,"p-dialog",14),e.NdJ("visibleChange",function(a){return t.editDialog=a}),e.TgZ(15,"app-create-ventas-lotes",15),e.NdJ("edit",function(a){return t.editEvent(a)}),e.qZA()(),e.TgZ(16,"p-dialog",16),e.NdJ("visibleChange",function(a){return t.deleteItemDialog=a}),e.TgZ(17,"div",17),e._UZ(18,"i",18),e.YNc(19,z,5,1,"span",19),e.qZA(),e.YNc(20,X,2,0,"ng-template",20),e.qZA(),e.TgZ(21,"p-dialog",21),e.NdJ("visibleChange",function(a){return t.deleteItemsDialog=a}),e.TgZ(22,"div",17),e._UZ(23,"i",18),e.TgZ(24,"span"),e._uU(25,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),e.qZA()(),e.YNc(26,W,2,0,"ng-template",20),e.qZA(),e.TgZ(27,"p-dialog",16),e.NdJ("visibleChange",function(a){return t.restartItemDialog=a}),e.TgZ(28,"div",17),e._UZ(29,"i",18),e.YNc(30,x,5,1,"span",19),e.qZA(),e.YNc(31,ee,2,0,"ng-template",20),e.qZA(),e.TgZ(32,"p-dialog",21),e.NdJ("visibleChange",function(a){return t.restartItemsDialog=a}),e.TgZ(33,"div",17),e._UZ(34,"i",18),e.TgZ(35,"span"),e._uU(36,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),e.qZA()(),e.YNc(37,te,2,0,"ng-template",20),e.qZA()()()),2&n&&(e.xp6(7),e.Q6J("value",t.data)("columns",t.cols)("rows",10)("globalFilterFields",t.cols)("rows",10)("paginator",!0)("loading",t.isLoadingTable)("rowsPerPageOptions",e.DdM(38,ne))("showCurrentPageReport",!0)("selection",t.selectedData)("rowHover",!0),e.xp6(5),e.Akn(e.DdM(39,S)),e.Q6J("visible",t.createDialog)("modal",!0),e.xp6(2),e.Akn(e.DdM(40,S)),e.Q6J("visible",t.editDialog)("modal",!0),e.xp6(1),e.Q6J("ventaLote",t.item),e.xp6(1),e.Akn(e.DdM(41,m)),e.Q6J("visible",t.deleteItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",t.item),e.xp6(2),e.Akn(e.DdM(42,m)),e.Q6J("visible",t.deleteItemsDialog)("modal",!0),e.xp6(6),e.Akn(e.DdM(43,m)),e.Q6J("visible",t.restartItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",t.item),e.xp6(2),e.Akn(e.DdM(44,m)),e.Q6J("visible",t.restartItemsDialog)("modal",!0))},dependencies:[p.sg,p.O5,p.PC,u.JJ,u.On,v.iA,c.jx,v.lQ,v.fz,v.UA,v.Mo,F.p,y.Hq,J.UN,A.H,U.FN,V.o,L.o,w.V,E]})),o})();var oe=s(2661);const ie=[{path:"",component:le}];let ae=(()=>{class o{}return(0,i.Z)(o,"\u0275fac",function(n){return new(n||o)}),(0,i.Z)(o,"\u0275mod",e.oAB({type:o})),(0,i.Z)(o,"\u0275inj",e.cJS({providers:[p.uU,p.H9],imports:[I.m,oe.Y4,b.Bz.forChild(ie)]})),o})()}}]);