"use strict";(self.webpackChunkmyadminhn=self.webpackChunkmyadminhn||[]).push([[2575],{2575:(re,h,a)=>{a.r(h),a.d(h,{RegistroFiscalesModule:()=>oe});var o=a(1180),D=a(7246),v=a(1380),_=a(805),b=a(7579),Z=a(2722),S=a(4004),c=a(5698),e=a(4650),I=a(2340),k=a(529),f=a(629);let C=(()=>{class s{constructor(t,i,n){(0,o.Z)(this,"http",void 0),(0,o.Z)(this,"authS",void 0),(0,o.Z)(this,"router",void 0),(0,o.Z)(this,"_prefix",I.H+"/api/registrosfiscales"),this.http=t,this.authS=i,this.router=n}getAll(t=[1,2]){this.authS.refreshToken();const i={cia_nids:this.authS.isValidCia(!1),regfis_nsts:t};return this.http.post(this._prefix+"/getall",i)}save(t){const i={...t,...this.authS.getUsuarioLog()};return this.http.post(this._prefix+"/save",i)}setSts(t){return this.http.post(this._prefix+"/setsts/"+t.regfis_nid,{regfis_nsts:t.regfis_nsts,...this.authS.getUsuarioLog()})}setBulkSts(t){return this.http.post(this._prefix+"/setbullksts",{data:t,...this.authS.getUsuarioLog()})}getPuntosEmison(){const t={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getallpuntosemision",t)}getDocumentosFiscales(){const t={cia_nids:this.authS.isValidCia(!1)};return this.http.post(this._prefix+"/getalldocumentosfiscales",t)}}return(0,o.Z)(s,"\u0275fac",function(t){return new(t||s)(e.LFG(k.eN),e.LFG(f.e),e.LFG(v.F0))}),(0,o.Z)(s,"\u0275prov",e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})),s})();var F=a(1168),p=a(6895),u=a(433),d=a(99),N=a(3388),T=a(5593),q=a(5362),A=a(1795),J=a(2453),w=a(1383),R=a(1740),x=a(1493),E=a(2210);let U=(()=>{class s{constructor(t,i,n,l){(0,o.Z)(this,"dbapi",void 0),(0,o.Z)(this,"_builder",void 0),(0,o.Z)(this,"authS",void 0),(0,o.Z)(this,"skNsCore",void 0),(0,o.Z)(this,"createForm",void 0),(0,o.Z)(this,"guardando",!1),(0,o.Z)(this,"itemDialog",!1),(0,o.Z)(this,"submitted",!1),(0,o.Z)(this,"puntosEmision",[]),(0,o.Z)(this,"DocumentosFiscales",[]),(0,o.Z)(this,"$destroy",new b.x),(0,o.Z)(this,"RegistroFiscal",{}),(0,o.Z)(this,"edit",new e.vpe),this.dbapi=t,this._builder=i,this.authS=n,this.skNsCore=l,this.createForm=i.group({regfis_nid:[0],punemi_nid:["",u.kI.required],docfis_nid:["",u.kI.required],regfis_vcai:["",u.kI.required],regfis_vnumeroautorizacion:["",u.kI.required],regfis_ninicio:["",u.kI.required],regfis_nfin:["",u.kI.required],regfis_dfechamaxemision:["",u.kI.required],regfis_nsts:[""]}),n.\u00f8bserverCompanySelected.pipe((0,Z.R)(this.$destroy)).subscribe(m=>{this.getPuntosEmison(),this.getDocumentosFiscales()})}ngOnInit(){}getPuntosEmison(){this.puntosEmision=[],this.punemi_nid?.setValue(""),this.dbapi.getPuntosEmison().pipe((0,c.q)(1)).subscribe({next:t=>{if(t&&null!=t&&""!==t){for(const i in t)this.puntosEmision=[...this.puntosEmision,{id:t[i].punemi_nid,text:t[i].punemi_vcodigo+" - "+t[i].punemi_vdescripcion,obj:t[i]}];1==this.puntosEmision.length&&this.punemi_nid?.setValue(this.puntosEmision[0])}else console.log("Error consultando compa\xf1\xedas")},error:t=>{console.log(t),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}})}getDocumentosFiscales(){this.DocumentosFiscales=[],this.docfis_nid?.setValue(""),this.dbapi.getDocumentosFiscales().pipe((0,c.q)(1)).subscribe({next:t=>{if(t&&null!=t&&""!==t){for(const i in t)this.DocumentosFiscales=[...this.DocumentosFiscales,{id:t[i].docfis_nid,text:t[i].docfis_vdescripcion,obj:t[i]}];1==this.DocumentosFiscales.length&&this.docfis_nid?.setValue(this.DocumentosFiscales[0])}else console.log("Error consultando compa\xf1\xedas")},error:t=>{console.log(t),this.edit.emit({type:"error",title:"Ha ocurrido un error",message:t})}})}ngOnChanges(){this.RegistroFiscal&&this.RegistroFiscal?.docfis_nid&&this.RegistroFiscal?.docfis_nid>0&&(this.regfis_nid?.setValue(this.RegistroFiscal?.regfis_nid),this.punemi_nid?.setValue(this.searchById(this.RegistroFiscal?.punemi_nid,this.puntosEmision)),this.docfis_nid?.setValue(this.searchById(this.RegistroFiscal?.docfis_nid,this.DocumentosFiscales)),this.regfis_vcai?.setValue(this.RegistroFiscal?.regfis_vcai),this.regfis_vnumeroautorizacion?.setValue(this.RegistroFiscal?.regfis_vnumeroautorizacion),this.regfis_ninicio?.setValue(this.RegistroFiscal?.regfis_ninicio),this.regfis_nfin?.setValue(this.RegistroFiscal?.regfis_nfin),this.regfis_dfechamaxemision?.setValue(this.RegistroFiscal?.regfis_dfechamaxemision),this.regfis_nsts?.setValue(this.RegistroFiscal?.regfis_nsts))}save(){if(this.createForm.valid&&!this.guardando){this.guardando=!0;const t={regfis_nid:this.regfis_nid?.value>0?this.regfis_nid?.value:null,punemi_nid:this.punemi_nid?.value.id,docfis_nid:this.docfis_nid?.value.id,regfis_vcai:this.regfis_vcai?.value.trim().toUpperCase(),regfis_vnumeroautorizacion:this.regfis_vnumeroautorizacion?.value.trim().toUpperCase(),regfis_ninicio:this.regfis_ninicio?.value,regfis_nfin:this.regfis_nfin?.value,regfis_dfechamaxemision:this.regfis_dfechamaxemision?.value,regfis_nsts:1};this.dbapi.save(t).pipe((0,c.q)(1)).subscribe({next:i=>{"success"==i.type&&(this.skNsCore.notificarUpsert("/ventas/documentosfiscales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.limpiarForm()),this.edit.emit(i),this.guardando=!1},error:i=>{console.log(i),this.guardando=!1,this.edit.emit({type:"error",title:"Ha ocurrido un error",message:i})}})}}limpiarForm(){this.createForm.reset(),this.docfis_nid?.setValue(0)}hideDialog(){this.itemDialog=!1,this.submitted=!1}searchById(t,i){for(let n=0;n<i.length;n++){const l=i[n];if(l.id==t)return l}return""}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}get regfis_nid(){return this.createForm.get("regfis_nid")}get punemi_nid(){return this.createForm.get("punemi_nid")}get docfis_nid(){return this.createForm.get("docfis_nid")}get regfis_vcai(){return this.createForm.get("regfis_vcai")}get regfis_vnumeroautorizacion(){return this.createForm.get("regfis_vnumeroautorizacion")}get regfis_ninicio(){return this.createForm.get("regfis_ninicio")}get regfis_nfin(){return this.createForm.get("regfis_nfin")}get regfis_dfechamaxemision(){return this.createForm.get("regfis_dfechamaxemision")}get regfis_nsts(){return this.createForm.get("regfis_nsts")}}return(0,o.Z)(s,"\u0275fac",function(t){return new(t||s)(e.Y36(C),e.Y36(u.qu),e.Y36(f.e),e.Y36(F.pP))}),(0,o.Z)(s,"\u0275cmp",e.Xpm({type:s,selectors:[["app-create-registros-fiscales"]],inputs:{RegistroFiscal:"RegistroFiscal"},outputs:{edit:"edit"},features:[e.TTD],decls:45,vars:54,consts:[[1,"row"],[1,"col-12"],[1,"card"],[1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"field","grid"],["htmlFor","name3",1,"col-12","mb-2","md:col-2","md:mb-0","text-900"],[1,"col-12","md:col-10"],["optionLabel","text","formControlName","punemi_nid",3,"options","filter","virtualScroll","virtualScrollItemSize"],["optionLabel","text","formControlName","docfis_nid",3,"options","filter","virtualScroll","virtualScrollItemSize"],["pInputText","","formControlName","regfis_vcai","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","regfis_vnumeroautorizacion","type","text","required","",2,"text-transform","uppercase"],["pInputText","","formControlName","regfis_ninicio","type","number","required",""],["pInputText","","formControlName","regfis_nfin","type","number","required",""],["pInputText","","formControlName","regfis_dfechamaxemision","type","date","required",""],[1,"col-5"],[1,"p-buttonset"],["pButton","","pRipple","","icon","pi pi-save","type","submit",1,"p-button-success","mr-1","btn-sm",3,"disabled","loading","label"],["pButton","","pRipple","","label","Limpiar","icon","pi pi-trash","type","button",1,"p-button-danger","btn-sm",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),e.NdJ("ngSubmit",function(){return i.save()}),e.TgZ(4,"div",4)(5,"label",5),e._uU(6,"Punto emisi\xf3n"),e.qZA(),e.TgZ(7,"div",6),e._UZ(8,"p-dropdown",7),e.qZA()(),e.TgZ(9,"div",4)(10,"label",5),e._uU(11,"Documento fiscal"),e.qZA(),e.TgZ(12,"div",6),e._UZ(13,"p-dropdown",8),e.qZA()(),e.TgZ(14,"div",4)(15,"label",5),e._uU(16,"CAI"),e.qZA(),e.TgZ(17,"div",6),e._UZ(18,"input",9),e.qZA()(),e.TgZ(19,"div",4)(20,"label",5),e._uU(21,"Numero autorizaci\xf3n"),e.qZA(),e.TgZ(22,"div",6),e._UZ(23,"input",10),e.qZA()(),e.TgZ(24,"div",4)(25,"label",5),e._uU(26,"Rango inicial"),e.qZA(),e.TgZ(27,"div",6),e._UZ(28,"input",11),e.qZA()(),e.TgZ(29,"div",4)(30,"label",5),e._uU(31,"Rango final"),e.qZA(),e.TgZ(32,"div",6),e._UZ(33,"input",12),e.qZA()(),e.TgZ(34,"div",4)(35,"label",5),e._uU(36,"Fecha m\xe1xmia emisi\xf3n"),e.qZA(),e.TgZ(37,"div",6),e._UZ(38,"input",13),e.qZA()(),e._UZ(39,"hr"),e.TgZ(40,"div",4)(41,"div",14)(42,"span",15),e._UZ(43,"button",16),e.TgZ(44,"button",17),e.NdJ("click",function(){return i.limpiarForm()}),e.qZA()()()()()()()()),2&t&&(e.xp6(3),e.Q6J("formGroup",i.createForm),e.xp6(5),e.ekj("ng-invalid",(null==i.punemi_nid?null:i.punemi_nid.invalid)&&(null==i.punemi_nid?null:i.punemi_nid.touched))("ng-dirty",(null==i.punemi_nid?null:i.punemi_nid.invalid)&&(null==i.punemi_nid?null:i.punemi_nid.touched))("ng-valid",(null==i.punemi_nid?null:i.punemi_nid.valid)&&((null==i.punemi_nid?null:i.punemi_nid.touched)||(null==i.punemi_nid?null:i.punemi_nid.dirty))),e.Q6J("options",i.puntosEmision)("filter",!1)("virtualScroll",i.puntosEmision.length>5)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==i.docfis_nid?null:i.docfis_nid.invalid)&&(null==i.docfis_nid?null:i.docfis_nid.touched))("ng-dirty",(null==i.docfis_nid?null:i.docfis_nid.invalid)&&(null==i.docfis_nid?null:i.docfis_nid.touched))("ng-valid",(null==i.docfis_nid?null:i.docfis_nid.valid)&&((null==i.docfis_nid?null:i.docfis_nid.touched)||(null==i.docfis_nid?null:i.docfis_nid.dirty))),e.Q6J("options",i.DocumentosFiscales)("filter",!1)("virtualScroll",i.DocumentosFiscales.length>5)("virtualScrollItemSize",38),e.xp6(5),e.ekj("ng-invalid",(null==i.regfis_vcai?null:i.regfis_vcai.invalid)&&(null==i.regfis_vcai?null:i.regfis_vcai.touched))("ng-dirty",(null==i.regfis_vcai?null:i.regfis_vcai.invalid)&&(null==i.regfis_vcai?null:i.regfis_vcai.touched))("ng-valid",(null==i.regfis_vcai?null:i.regfis_vcai.valid)&&((null==i.regfis_vcai?null:i.regfis_vcai.touched)||(null==i.regfis_vcai?null:i.regfis_vcai.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.invalid)&&(null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.touched))("ng-dirty",(null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.invalid)&&(null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.touched))("ng-valid",(null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.valid)&&((null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.touched)||(null==i.regfis_vnumeroautorizacion?null:i.regfis_vnumeroautorizacion.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==i.regfis_ninicio?null:i.regfis_ninicio.invalid)&&(null==i.regfis_ninicio?null:i.regfis_ninicio.touched))("ng-dirty",(null==i.regfis_ninicio?null:i.regfis_ninicio.invalid)&&(null==i.regfis_ninicio?null:i.regfis_ninicio.touched))("ng-valid",(null==i.regfis_ninicio?null:i.regfis_ninicio.valid)&&((null==i.regfis_ninicio?null:i.regfis_ninicio.touched)||(null==i.regfis_ninicio?null:i.regfis_ninicio.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==i.regfis_nfin?null:i.regfis_nfin.invalid)&&(null==i.regfis_nfin?null:i.regfis_nfin.touched))("ng-dirty",(null==i.regfis_nfin?null:i.regfis_nfin.invalid)&&(null==i.regfis_nfin?null:i.regfis_nfin.touched))("ng-valid",(null==i.regfis_nfin?null:i.regfis_nfin.valid)&&((null==i.regfis_nfin?null:i.regfis_nfin.touched)||(null==i.regfis_nfin?null:i.regfis_nfin.dirty))),e.xp6(5),e.ekj("ng-invalid",(null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.invalid)&&(null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.touched))("ng-dirty",(null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.invalid)&&(null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.touched))("ng-valid",(null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.valid)&&((null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.touched)||(null==i.regfis_dfechamaxemision?null:i.regfis_dfechamaxemision.dirty))),e.xp6(5),e.Q6J("disabled",!i.createForm.valid)("loading",i.guardando)("label",i.RegistroFiscal&&i.RegistroFiscal.regfis_nid?"Editar":"Guardar"))},dependencies:[u._Y,u.Fj,u.wV,u.JJ,u.JL,u.Q7,u.sg,u.u,T.Hq,A.H,R.o,E.Lt],styles:[".ng-valid[_ngcontent-%COMP%]{border-color:#2ecc71!important}"]})),s})();function M(s,r){1&s&&(e.TgZ(0,"div",22)(1,"h3",23),e._uU(2,"Listado de registros fiscales"),e.qZA()())}function z(s,r){if(1&s){const t=e.EpF();e._UZ(0,"p-fileUpload",24),e.TgZ(1,"button",25),e.NdJ("click",function(){e.CHM(t),e.oxw();const n=e.MAs(8);return e.KtG(n.exportCSV())}),e.qZA()}2&s&&e.Q6J("maxFileSize",1e6)}function V(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",34),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.deleteSelectedItems())}),e.qZA()}if(2&s){const t=e.oxw(2);e.Q6J("disabled",!t.selectedData||!t.selectedData.length)}}function H(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",35),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.restartSelectedItems())}),e.qZA()}if(2&s){const t=e.oxw(2);e.Q6J("disabled",!t.selectedData||!t.selectedData.length)}}const B=function(){return{float:"right"}};function Q(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"div",26)(1,"span",27)(2,"input",28),e.NdJ("input",function(n){e.CHM(t);const l=e.oxw(),m=e.MAs(8);return e.KtG(l.onGlobalFilter(m,n))}),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.getData())}),e.qZA(),e.TgZ(4,"button",30),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.openNew())}),e.qZA(),e.YNc(5,V,1,1,"button",31),e.YNc(6,H,1,1,"button",32),e.TgZ(7,"p-selectButton",33),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.dataValue=n)})("click",function(){e.CHM(t);const n=e.oxw();return n.getData(),e.KtG(n.clearDataSelected())}),e.qZA()()()}if(2&s){const t=e.oxw();e.xp6(5),e.Q6J("ngIf",t.dataValue&&t.dataValue[0]>0),e.xp6(1),e.Q6J("ngIf",t.dataValue&&0===t.dataValue[0]),e.xp6(1),e.Q6J("options",t.dataOptions)("ngModel",t.dataValue)("ngStyle",e.DdM(5,B))}}function O(s,r){if(1&s&&(e.TgZ(0,"th",38),e._uU(1),e._UZ(2,"p-sortIcon",39),e.qZA()),2&s){const t=r.$implicit;e.ekj("rowStyle","ID"!==t.header)("rowStyleId","ID"===t.header),e.Q6J("pSortableColumn",t.field),e.xp6(1),e.hij(" ",t.header," "),e.xp6(1),e.Q6J("field",t.field)}}function Y(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"th",36),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Acciones"),e.qZA(),e.YNc(5,O,3,7,"th",37),e.qZA()),2&s){const t=e.oxw();e.xp6(5),e.Q6J("ngForOf",t.cols)}}function G(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,l=e.oxw();return e.KtG(l.editRow(n))}),e.qZA()}}function P(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",47),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,l=e.oxw();return e.KtG(l.deleteRow(n))}),e.qZA()}}function L(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",48),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,l=e.oxw();return e.KtG(l.restartRow(n))}),e.qZA()}}function K(s,r){if(1&s&&(e.TgZ(0,"td")(1,"span",49),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&s){const t=r.$implicit,i=e.oxw().$implicit;e.xp6(2),e.Oqu(t.header),e.xp6(1),e.hij(" ",i[t.field]," ")}}function j(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"p-tableCheckbox",40),e.qZA(),e.TgZ(3,"td")(4,"div",41),e.YNc(5,G,1,0,"button",42),e.YNc(6,P,1,0,"button",43),e.YNc(7,L,1,0,"button",44),e.qZA()(),e.YNc(8,K,4,2,"td",45),e.qZA()),2&s){const t=r.$implicit,i=e.oxw();e.xp6(2),e.Q6J("value",t),e.xp6(3),e.Q6J("ngIf",t.regfis_nsts>0),e.xp6(1),e.Q6J("ngIf",t.regfis_nsts>0),e.xp6(1),e.Q6J("ngIf",t.regfis_nsts<1),e.xp6(1),e.Q6J("ngForOf",i.cols)}}function $(s,r){if(1&s&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres eliminar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(t.item.regfis_vcai)}}function X(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.deleteItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",51),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirmDelete())}),e.qZA()}}function W(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.deleteItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",51),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirmDeleteSelected())}),e.qZA()}}function ee(s,r){if(1&s&&(e.TgZ(0,"span"),e._uU(1,"Estas seguro que quieres restaurar "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4,"?"),e.qZA()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(t.item.regfis_vcai)}}function ie(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.restartItemDialog=!1)}),e.qZA(),e.TgZ(1,"button",52),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirmRestart())}),e.qZA()}}function te(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.restartItemsDialog=!1)}),e.qZA(),e.TgZ(1,"button",52),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirmRestartSelected())}),e.qZA()}}const se=function(){return[10,20,30]},y=function(){return{width:"750px"}},g=function(){return{width:"450px"}},ne=[{path:"",component:(()=>{class s{constructor(t,i,n,l,m){(0,o.Z)(this,"dbapi",void 0),(0,o.Z)(this,"messageService",void 0),(0,o.Z)(this,"authS",void 0),(0,o.Z)(this,"skNsCore",void 0),(0,o.Z)(this,"datePipe",void 0),(0,o.Z)(this,"createDialog",!1),(0,o.Z)(this,"editDialog",!1),(0,o.Z)(this,"deleteItemDialog",!1),(0,o.Z)(this,"deleteItemsDialog",!1),(0,o.Z)(this,"restartItemDialog",!1),(0,o.Z)(this,"restartItemsDialog",!1),(0,o.Z)(this,"isLoadingTable",!1),(0,o.Z)(this,"data",[]),(0,o.Z)(this,"item",{}),(0,o.Z)(this,"selectedData",[]),(0,o.Z)(this,"submitted",!1),(0,o.Z)(this,"cols",[]),(0,o.Z)(this,"statuses",[]),(0,o.Z)(this,"dataOptions",[]),(0,o.Z)(this,"dataValue",[1]),(0,o.Z)(this,"rowsPerPageOptions",[5,10,20]),(0,o.Z)(this,"$destroy",new b.x),this.dbapi=t,this.messageService=i,this.authS=n,this.skNsCore=l,this.datePipe=m,l.fromEvent("/ventas/registrosfiscales").pipe((0,Z.R)(this.$destroy)).subscribe(le=>{this.skNsCore.socketId!=le&&(console.log("Event socket: registros fiscales"),this.getData())}),this.cols=[{field:"regfis_nid",header:"ID"},{field:"punemi_vdescripcion",header:"Punto emisi\xf3n"},{field:"docfis_vdescripcion",header:"Doc. Fiscal"},{field:"regfis_vcai",header:"CAI"},{field:"regfis_vnumeroautorizacion",header:"No. Autorizaci\xf3n"},{field:"regfis_ninicio",header:"Rango inicial"},{field:"regfis_nfin",header:"Rango final"},{field:"regfis_vfechamaxemision",header:"Fecha max emisi\xf3n"},{field:"regfis_vsts",header:"Estado"}],this.dataOptions=[{name:"ACTIVOS",value:[1]},{name:"ELIMINADOS",value:[0]},{name:"TODOS",value:[-1,0,1]}],this.getData()}getData(){this.isLoadingTable=!0,this.dbapi.getAll(this.dataValue).pipe((0,S.U)(t=>(t.forEach(i=>{i.punemi_vdescripcion=i.punemis?i.punemis.punemi_vcodigo+" - "+i.punemis.punemi_vdescripcion:"",i.docfis_vdescripcion=i.docfiss?i.docfiss.docfis_vdescripcion:"",i.regfis_vsts=1==i.regfis_nsts?"ACTIVO":"ELIMINADO",i.regfis_vfechamaxemision=this.datePipe.transform(i.regfis_dfechamaxemision,"dd-MM-yyyy")}),t)),(0,c.q)(1)).subscribe({next:t=>{this.data=[...t],this.isLoadingTable=!1},error:t=>{console.log(t),this.isLoadingTable=!1,this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}ngOnInit(){}openNew(){this.item={},this.submitted=!1,this.createDialog=!0}deleteSelectedData(){this.deleteItemsDialog=!0}restartSelectedItems(){this.restartItemsDialog=!0}editRow(t){this.item={...t},this.editDialog=!0}deleteRow(t){this.deleteItemDialog=!0,this.item={...t}}restartRow(t){this.restartItemDialog=!0,this.item={...t}}confirmDeleteSelected(){const t=[];this.selectedData.forEach(i=>{t.push({regfis_nid:i.regfis_nid,regfis_nsts:0})}),this.dbapi.setBulkSts(t).pipe((0,c.q)(1)).subscribe({next:i=>{this.messageService.add({severity:i.type,summary:i.title,detail:i.message,life:3e3}),"success"==i.type&&(this.skNsCore.notificarUpsert("/ventas/registrosfiscales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.deleteItemsDialog=!1,this.selectedData=[],this.getData())},error:i=>{console.log(i),this.editEvent({type:"error",title:"Ha ocurrido un error",message:i})}})}confirmDelete(){this.dbapi.setSts({regfis_nid:this.item.regfis_nid,regfis_nsts:0}).pipe((0,c.q)(1)).subscribe({next:i=>{this.skNsCore.notificarUpsert("/ventas/registrosfiscales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString(),!0),this.messageService.add({severity:i.type,summary:i.title,detail:i.message,life:3e3}),this.deleteItemDialog=!1,this.item={},this.getData()},error:i=>{console.log(i),this.editEvent({type:"error",title:"Ha ocurrido un error",message:i})}})}confirmRestart(){this.item.regfis_nsts=1,this.dbapi.setSts(this.item).pipe((0,c.q)(1)).subscribe({next:t=>{this.skNsCore.notificarUpsert("/ventas/registrosfiscales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),this.restartItemDialog=!1,this.item={},this.getData()},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}confirmRestartSelected(){this.selectedData.forEach(t=>{t.regfis_nsts=1}),this.item.regfis_nsts=1,this.dbapi.setBulkSts(this.selectedData).pipe((0,c.q)(1)).subscribe({next:t=>{this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.skNsCore.notificarUpsert("/ventas/registrosfiscales",this.authS.isValidCia(!1).toString(),this.authS.usuario.user_nid.toString()),this.restartItemsDialog=!1,this.selectedData=[],this.getData())},error:t=>{console.log(t),this.editEvent({type:"error",title:"Ha ocurrido un error",message:t})}})}findIndexById(t){let i=-1;for(let n=0;n<this.data.length;n++)if(this.data[n].regfis_nid===t){i=n;break}return i}onGlobalFilter(t,i){t.filterGlobal(i.target.value,"contains")}deleteSelectedItems(){this.deleteItemsDialog=!0}editEvent(t){this.messageService.add({severity:t.type,summary:t.title,detail:t.message,life:3e3}),"success"==t.type&&(this.getData(),this.createDialog=!1,this.editDialog=!1)}clearDataSelected(){this.selectedData=[]}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete()}}return(0,o.Z)(s,"\u0275fac",function(t){return new(t||s)(e.Y36(C),e.Y36(_.ez),e.Y36(f.e),e.Y36(F.pP),e.Y36(p.uU))}),(0,o.Z)(s,"\u0275cmp",e.Xpm({type:s,selectors:[["ng-component"]],features:[e._Bn([_.ez])],decls:38,vars:45,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["position","bottom-right"],["styleClass","mb-4"],["pTemplate","left"],["pTemplate","right"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","selectionMode","multiple","dataKey","regfis_nid",3,"value","columns","rows","globalFilterFields","paginator","loading","rowsPerPageOptions","showCurrentPageReport","selection","rowHover","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Crear registro fiscal",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"edit"],["header","Editar registro fiscal",1,"p-fluid",3,"visible","modal","visibleChange"],[3,"RegistroFiscal","edit"],["header","Confirmar...",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],["header","Confirmar",3,"visible","modal","visibleChange"],[1,"my-2"],[1,"mb-2"],["mode","basic","accept","image/*","label","Import","chooseLabel","Import",1,"mr-2","inline-block",3,"maxFileSize"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"p-button-help",3,"click"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-rigth"],["pInputText","","type","text","placeholder","Buscar...",1,"w-full","sm:w-auto","mr-1",3,"input"],["pButton","","pRipple","","label","","icon","pi pi-sync",1,"p-button-secondary","mr-1","ml-1",3,"click"],["pButton","","pRipple","","label","Crear","icon","pi pi-plus",1,"p-button-success","mr-1","ml-1",3,"click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash","class","p-button-danger mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay","class","p-button-help mr-1 ml-1 mt-1",3,"disabled","click",4,"ngIf"],["optionLabel","name","optionValue","value",1,"ml-3","mt-1",3,"options","ngModel","ngStyle","ngModelChange","click"],["pButton","","pRipple","","label","Eliminar","icon","pi pi-trash",1,"p-button-danger","mr-1","ml-1","mt-1",3,"disabled","click"],["pButton","","pRipple","","label","Restaurar","icon","pi pi-replay",1,"p-button-help","mr-1","ml-1","mt-1",3,"disabled","click"],[2,"width","3rem"],["style","width: 100rem",3,"pSortableColumn","rowStyle","rowStyleId",4,"ngFor","ngForOf"],[2,"width","100rem",3,"pSortableColumn"],[3,"field"],[3,"value"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-success mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar","class","p-button-help",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-success","mr-1",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","title","Eliminar",1,"p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-replay","title","Restaurar",1,"p-button-help",3,"click"],[1,"p-column-title"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-danger",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Si",1,"p-button-outlined","p-button-help",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"p-toast",3),e.TgZ(4,"p-toolbar",4),e.YNc(5,M,3,0,"ng-template",5),e.YNc(6,z,2,1,"ng-template",6),e.qZA(),e.TgZ(7,"p-table",7,8),e.NdJ("selectionChange",function(l){return i.selectedData=l}),e.YNc(9,Q,8,6,"ng-template",9),e.YNc(10,Y,6,1,"ng-template",10),e.YNc(11,j,9,5,"ng-template",11),e.qZA()(),e.TgZ(12,"p-dialog",12),e.NdJ("visibleChange",function(l){return i.createDialog=l}),e.TgZ(13,"app-create-registros-fiscales",13),e.NdJ("edit",function(l){return i.editEvent(l)}),e.qZA()(),e.TgZ(14,"p-dialog",14),e.NdJ("visibleChange",function(l){return i.editDialog=l}),e.TgZ(15,"app-create-registros-fiscales",15),e.NdJ("edit",function(l){return i.editEvent(l)}),e.qZA()(),e.TgZ(16,"p-dialog",16),e.NdJ("visibleChange",function(l){return i.deleteItemDialog=l}),e.TgZ(17,"div",17),e._UZ(18,"i",18),e.YNc(19,$,5,1,"span",19),e.qZA(),e.YNc(20,X,2,0,"ng-template",20),e.qZA(),e.TgZ(21,"p-dialog",21),e.NdJ("visibleChange",function(l){return i.deleteItemsDialog=l}),e.TgZ(22,"div",17),e._UZ(23,"i",18),e.TgZ(24,"span"),e._uU(25,"\xbfEst\xe1 seguro de que desea eliminar los elementos seleccionados?"),e.qZA()(),e.YNc(26,W,2,0,"ng-template",20),e.qZA(),e.TgZ(27,"p-dialog",16),e.NdJ("visibleChange",function(l){return i.restartItemDialog=l}),e.TgZ(28,"div",17),e._UZ(29,"i",18),e.YNc(30,ee,5,1,"span",19),e.qZA(),e.YNc(31,ie,2,0,"ng-template",20),e.qZA(),e.TgZ(32,"p-dialog",21),e.NdJ("visibleChange",function(l){return i.restartItemsDialog=l}),e.TgZ(33,"div",17),e._UZ(34,"i",18),e.TgZ(35,"span"),e._uU(36,"\xbfEst\xe1 seguro de que desea restaurar los elementos seleccionados?"),e.qZA()(),e.YNc(37,te,2,0,"ng-template",20),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("value",i.data)("columns",i.cols)("rows",10)("globalFilterFields",i.cols)("rows",10)("paginator",!0)("loading",i.isLoadingTable)("rowsPerPageOptions",e.DdM(38,se))("showCurrentPageReport",!0)("selection",i.selectedData)("rowHover",!0),e.xp6(5),e.Akn(e.DdM(39,y)),e.Q6J("visible",i.createDialog)("modal",!0),e.xp6(2),e.Akn(e.DdM(40,y)),e.Q6J("visible",i.editDialog)("modal",!0),e.xp6(1),e.Q6J("RegistroFiscal",i.item),e.xp6(1),e.Akn(e.DdM(41,g)),e.Q6J("visible",i.deleteItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",i.item),e.xp6(2),e.Akn(e.DdM(42,g)),e.Q6J("visible",i.deleteItemsDialog)("modal",!0),e.xp6(6),e.Akn(e.DdM(43,g)),e.Q6J("visible",i.restartItemDialog)("modal",!0),e.xp6(3),e.Q6J("ngIf",i.item),e.xp6(2),e.Akn(e.DdM(44,g)),e.Q6J("visible",i.restartItemsDialog)("modal",!0))},dependencies:[p.sg,p.O5,p.PC,u.JJ,u.On,d.iA,_.jx,d.lQ,d.fz,d.UA,d.Mo,N.p,T.Hq,q.UN,A.H,J.FN,w.o,R.o,x.V,U],styles:[".rowStyle[_ngcontent-%COMP%]{width:14%;min-width:10rem}.rowStyleId[_ngcontent-%COMP%]{width:10%;min-width:6rem}"]})),s})()}];let oe=(()=>{class s{}return(0,o.Z)(s,"\u0275fac",function(t){return new(t||s)}),(0,o.Z)(s,"\u0275mod",e.oAB({type:s})),(0,o.Z)(s,"\u0275inj",e.cJS({imports:[D.m,v.Bz.forChild(ne)]})),s})()}}]);